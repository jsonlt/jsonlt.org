<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>JSON Lines Table (JSONLT) 1.0</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in § N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *     -> ins/del.c### for candidate and proposed changes (amendments)
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *   - .correction for "candidate corrections"       (div, aside, details, section)
 *   - .addition   for "candidate additions"         (div, aside, details, section)
 *   - .correction.proposed for "proposed corrections" (div, aside, details, section)
 *   - .addition.proposed   for "proposed additions"   (div, aside, details, section)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Outdated warning for old specs
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/* color variables included separately for reliability */

/******************************************************************************/
/*                                    Body                                    */
/******************************************************************************/

	html {
	}

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;			  /* limit line length to 50em for readability   */
		margin: 0 auto;				/* center text within page                    */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag    */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		color: black;
		color: var(--text);
		background: white top left fixed no-repeat;
		background: var(--bg) top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em; }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border: solid var(--logo-bg);
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		background: var(--logo-bg);
		color: white;
		color: var(--logo-text);
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		background: var(--logo-active-bg);
		border-color: #c00;
		border-color: var(--logo-active-bg);
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small; }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 3;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;

			color: #707070;
			color: var(--tocnav-normal-text);
			background: white;
			background: var(--tocnav-normal-bg);
		}
		#toc-nav > a:hover,
		#toc-nav > a:focus {
			color: black;
			color: var(--tocnav-hover-text);
			background: #f8f8f8;
			background: var(--tocnav-hover-bg);
		}
		#toc-nav > a:active {
			color: #c00;
			color: var(--tocnav-active-text);
			background: white;
			background: var(--tocnav-active-bg);
		}

		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;	/* Inherit the font family. */
		line-height: 1.2;		/* Keep wrapped headings compact */
		hyphens: manual;		/* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		color: var(--heading-text);
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#profile-and-date {
		/* #profile-and-date is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > :not(.head) + hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		color: black;
		color: var(--hr-text);
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	border-left: 0.5em solid #DEF;
	border-left: 0.5em solid var(--algo-border);
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	 padding: .5em;
	 border: thin solid #ddd;
	 border: thin solid var(--algo-border);
	 border-radius: .5em;
	 margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	 margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	 margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	margin-left: -2em;
	}
	dl.switch {
	padding-left: 2em;
	}
	dl.switch > dt {
	text-indent: -1.5em;
	margin-top: 1em;
	}
	dl.switch > dt + dt {
	margin-top: 0;
	}
	dl.switch > dt::before {
	content: '\21AA';
	padding: 0 0.5em 0 0;
	display: inline-block;
	width: 1em;
	text-align: right;
	line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: inherit;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del {
		color: #aa0000;
		color: var(--del-text);
		background: transparent;
		background: var(--del-bg);
		text-decoration: line-through;
	}
	ins {
		color: #006100;
		color: var(--ins-text);
		background: transparent;
		background: var(--ins-bg);
		text-decoration: underline;
	}

	/* for amendments (candidate/proposed changes) */

	.amendment ins, .correction ins, .addition ins,
	ins[class^=c] {
		text-decoration-style: dotted;
	}
	.amendment del, .correction del, .addition del,
	del[class^=c] {
		text-decoration-style: dotted;
	}
	.amendment.proposed ins, .correction.proposed ins, .addition.proposed ins,
	ins[class^=c].proposed {
		text-decoration-style: double;
	}
	.amendment.proposed del, .correction.proposed del, .addition.proposed del,
	del[class^=c].proposed {
		text-decoration-style: double;
	}

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		hyphens: none;
		text-transform: none;
		text-align: left;
		text-align: start;
		font-variant: normal;
		orphans: 3;
		widows: 3;
		page-break-before: avoid;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

	/* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		color: var(--a-normal-text);
		text-decoration: underline #707070;
		text-decoration: underline var(--a-normal-underline);
		text-decoration-skip-ink: none;
	}
	a:visited {
		color: #034575;
		color: var(--a-visited-text);
		text-decoration-color: #bbb;
		text-decoration-color: var(--a-visited-underline);
	}

	/* Indicate interaction with the link */
	a[href]:focus,
	a[href]:hover {
		text-decoration-thickness: 2px;
	}
	a[href]:active {
		color: #c00;
		color: var(--a-active-text);
		text-decoration-color: #c00;
		text-decoration-color: var(--a-active-underline);
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	img, svg {
		/* Intentionally not color-scheme aware. */
		background: white;
	}

	/* For autogen numbers, add
	  .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,	.sidefigure img,	figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
		height: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em;
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em; }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote,
	.amendment, .correction, .addition {
		margin: 1em auto;
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	blockquote > :first-child,
	.note  > p:first-child,
	.issue > p:first-child,
	.amendment > p:first-child,
	.correction > p:first-child,
	.addition > p:first-child {
		margin-top: 0;
	}
	blockquote > :last-child,
	.note  > p:last-child,
	.issue > p:last-child,
	.amendment > p:last-child,
	.correction > p:last-child,
	.addition > p:last-child {
		margin-bottom: 0;
	}


	.issue::before, .issue > .marker,
	.example::before, .example > .marker,
	.note::before, .note > .marker,
	details.note > summary > .marker,
	.amendment::before, .amendment > .marker,
	details.amendment > summary > .marker,
	.addition::before, .addition > .marker,
	addition.amendment > summary > .marker,
	.correction::before, .correction > .marker,
	correction.amendment > summary > .marker
	{
		text-transform: uppercase;
		padding-right: 1em;
	}

	.example::before, .example > .marker {
		display: block;
		padding-right: 0em;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
		border-color: var(--blockquote-border);
		background: transparent;
		background: var(--blockquote-bg);
		color: currentcolor;
		color: var(--blockquote-text);
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #e05252;
		border-color: var(--issue-border);
		background: #fbe9e9;
		background: var(--issue-bg);
		color: black;
		color: var(--issue-text);
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		color: #831616;
		color: var(--issueheading-text);
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	  or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #e0cb52;
		border-color: var(--example-border);
		background: #fcfaee;
		background: var(--example-bg);
		color: black;
		color: var(--example-text);
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		color: #574b0f;
		color: var(--exampleheading-text);
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	  or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52e052;
		border-color: var(--note-border);
		background: #e9fbe9;
		background: var(--note-bg);
		color: black;
		color: var(--note-text);
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary {
		color: hsl(120, 70%, 30%);
		color: var(--noteheading-text);
	}
	/* Add .note::before { content: "Note "; } for autogen label,
	  or use class="marker" to mark up the label in source. */

	details.note[open] > summary {
		border-bottom: 1px silver solid;
		border-bottom: 1px var(--notesummary-underline) solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		border-color: var(--assertion-border);
		background: #EEE;
		background: var(--assertion-bg);
		color: black;
		color: var(--assertion-text);
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-color: var(--advisement-border);
		border-style: none solid;
		background: #fec;
		background: var(--advisement-bg);
		color: black;
		color: var(--advisement-text);
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement::before, .advisement > .marker {
		color: #b35f00;
		color: var(--advisementheading-text);
	}

/** Amendment Box *************************************************************/

	.amendment, .correction, .addition {
		border-color: #330099;
		border-color: var(--amendment-border);
		background: #F5F0FF;
		background: var(--amendment-bg);
		color: black;
		color: var(--amendment-text);
	}
	.amendment.proposed, .correction.proposed, .addition.proposed {
		border-style: solid;
		border-block-width: 0.25em;
	}
	.amendment::before, .amendment > .marker,
	details.amendment > summary::before, details.amendment > summary > .marker,
	.correction::before, .correction > .marker,
	details.correction > summary::before, details.correction > summary > .marker,
	.addition::before, .addition > .marker,
	details.addition > summary::before, details.addition > summary > .marker {
		color: #220066;
		color: var(--amendmentheading-text);
	}
	.amendment.proposed::before, .amendment.proposed > .marker,
	details.amendment.proposed > summary::before, details.amendment.proposed > summary > .marker,
	.correction.proposed::before, .correction.proposed > .marker,
	details.correction.proposed > summary::before, details.correction.proposed > summary > .marker,
	.addition.proposed::before, .addition.proposed > .marker,
	details.addition.proposed > summary::before, details.addition.proposed > summary > .marker {
		font-weight: bold;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: hsla(40,100%,50%,0.95);
		background: var(--warning-bg);
		color: black;
		color: var(--warning-text);
		padding: .75em 1em;
		border: red;
		border: var(--warning-border);
		border-style: solid none;
		box-shadow: 0 2px 8px black;
		text-align: center;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 0;
		right: 0;
		bottom: 2em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #def;
		background: var(--def-bg);
		margin: 1.2em 0;
		border-left: 0.5em solid #8ccbf2;
		border-left: 0.5em solid var(--def-border);
		color: black;
		color: var(--def-text);
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
		border-bottom: 1px solid var(--defrow-border);
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def td.footnote {
		padding-top: 0.6em;
	}
	table.def td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		<table class="data"> highlights structural relationships in a table
		when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		Use class="complex data" for particularly complicated tables --
		(This will draw more lines: busier, but clearer.)

		Use class="long" on table cells with paragraph-like contents
		(This will adjust text alignment accordingly.)
		Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-color: var(--datacell-border);
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		border-top: 1px solid var(--datacell-border);
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		border: 1px solid var(--datacell-border);
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
		vertical-align: baseline;
		text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding: 0.1rem 1px 0;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Switch to using border-bottom for underlines */
		text-decoration: none;
		border-bottom: 1px solid;
		/* Reverse color scheme */
		color: black;
		color: var(--toclink-text);
		border-color: #3980b5;
		border-color: var(--toclink-underline);
	}
	.toc a:visited {
		color: black;
		color: var(--toclink-visited-text);
		border-color: #054572;
		border-color: var(--toclink-visited-underline);
	}
	.toc a:focus,
	.toc a:hover {
		background: rgba(75%, 75%, 75%, .25);
		background: var(--a-hover-bg);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
	}
	.toc {
		line-height: 1.1em;
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li			{ font-weight: bold;   }
	.toc > li li		 { font-weight: normal; }
	.toc > li li li	  { font-size:   95%;	}
	.toc > li li li li	{ font-size:   90%;	}
	.toc > li li li li li { font-size:   85%;	}

	/* @supports not (display:grid) { */
		.toc > li			{ margin: 1.5rem 0;	}
		.toc > li li		 { margin: 0.3rem 0;	}
		.toc > li li li	  { margin-left: 2rem;   }

		/* Section numbers in a column of their own */
		.toc .secno {
			float: left;
			width: 4rem;
			white-space: nowrap;
		}
		.toc > li li li li .secno { font-size: 85%; }
		.toc > li li li li li .secno { font-size: 100%; }

		.toc li {
			clear: both;
		}

		:not(li) > .toc			 { margin-left:  5rem; }
		.toc .secno				 { margin-left: -5rem; }
		.toc > li li li .secno	  { margin-left: -7rem; }
		.toc > li li li li .secno	{ margin-left: -9rem; }
		.toc > li li li li li .secno { margin-left: -11rem; }

		/* Tighten up indentation in narrow ToCs */
		@media (max-width: 30em) {
			:not(li) > .toc			 { margin-left:  4rem; }
			.toc .secno				 { margin-left: -4rem; }
			.toc > li li li			 { margin-left:  1rem; }
			.toc > li li li .secno	  { margin-left: -5rem; }
			.toc > li li li li .secno	{ margin-left: -6rem; }
			.toc > li li li li li .secno { margin-left: -7rem; }
		}
		/* Loosen it on wide screens */
		@media screen and (min-width: 78em) {
			body:not(.toc-inline) :not(li) > .toc			 { margin-left:  4rem; }
			body:not(.toc-inline) .toc .secno				 { margin-left: -4rem; }
			body:not(.toc-inline) .toc > li li li			 { margin-left:  1rem; }
			body:not(.toc-inline) .toc > li li li .secno	  { margin-left: -5rem; }
			body:not(.toc-inline) .toc > li li li li .secno	{ margin-left: -6rem; }
			body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	/* } */

	@supports (display:grid) and (display:contents) {
		/* Use #toc over .toc to override non-@supports rules. */
		#toc {
			display: grid;
			align-content: start;
			grid-template-columns: auto 1fr;
			grid-column-gap: 1rem;
			column-gap: 1rem;
			grid-row-gap: .6rem;
			row-gap: .6rem;
		}
		#toc h2 {
			grid-column: 1 / -1;
			margin-bottom: 0;
		}
		#toc ol,
		#toc li,
		#toc a {
			display: contents;
			/* Switch <a> to subgrid when supported */
		}
		#toc span {
			margin: 0;
		}
		#toc > .toc > li > a > span {
			/* The spans of the top-level list,
			  comprising the first items of each top-level section. */
			margin-top: 1.1rem;
		}
		#toc#toc .secno { /* Ugh, need more specificity to override base.css */
			grid-column: 1;
			width: auto;
			margin-left: 0;
		}
		#toc .content {
			grid-column: 2;
			width: auto;
			margin-right: 1rem;
			border-bottom: 3px solid transparent;
			margin-bottom: -3px;
		}
		#toc .content:hover,
		#toc .content:focus {
			background: rgba(75%, 75%, 75%, .25);
			background: var(--a-hover-bg);
			border-bottom-color: #054572;
			border-bottom-color: var(--toclink-underline);
		}
		#toc li li li .content {
			margin-left: 1rem;
		}
		#toc li li li li .content {
			margin-left: 2rem;
		}
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index	  { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li	{ margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em; }
	ul.index dl	{ margin-top: 0; }
	ul.index dt	{ margin: .2em 0 .2em 20px;}
	ul.index dd	{ margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li a + span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
			color: var(--indexinfo-text);
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		color: black;
		color: var(--indextable-hover-text);
		background: #f7f8f9;
		background: var(--indextable-hover-bg);
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/** Outdated warning **********************************************************/

.outdated-spec {
	color: black;
	color: var(--outdatedspec-text);
	background-color: rgba(0,0,0,0.5);
	background-color: var(--outdatedspec-bg);
}

.outdated-warning {
	position: fixed;
	bottom: 50%;
	left: 0;
	right: 0;
	margin: 0 auto;
	width: 50%;
	background: maroon;
	background: var(--outdated-bg);
	color: white;
	color: var(--outdated-text);
	border-radius: 1em;
	box-shadow: 0 0 1em red;
	box-shadow: 0 0 1em var(--outdated-shadow);
	padding: 2em;
	text-align: center;
	z-index: 2;
}

.outdated-warning a {
	color: currentcolor;
	background: transparent;
}

.edited-rec-warning {
	background: darkorange;
	background: var(--editedrec-bg);
	box-shadow: 0 0 1em;
}

.outdated-warning button {
	color: var(--outdated-text);
	border-radius: 1em;
	box-shadow: 0 0 1em red;
	box-shadow: 0 0 1em var(--outdated-shadow);
	padding: 2em;
	text-align: center;
	z-index: 2;
}

.outdated-warning a {
	color: currentcolor;
	background: transparent;
}

.edited-rec-warning {
	background: darkorange;
	background: var(--editedrec-bg);
	box-shadow: 0 0 1em;
}

.outdated-warning button {
	position: absolute;
	top: 0;
	right:0;
	margin: 0;
	border: 0;
	padding: 0.25em 0.5em;
	background: transparent;
	color: white;
	color: var(--outdated-text);
	font:1em sans-serif;
	text-align:center;
}

.outdated-warning span {
	display: block;
}

.outdated-collapsed {
	bottom: 0;
	border-radius: 0;
	width: 100%;
	padding: 0;
}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}

		.outdated-warning {
			position: absolute;
			border-style: solid;
			border-color: red;
		}

		.outdated-warning input {
			display: none;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge {
		/* Magic to create good item positioning:
		  "content column" is 50ems wide at max; less on smaller screens.
		  Extra space (after ToC + content) is empty on the right.

		  1. When item < content column, centers item in column.
		  2. When content < item < available, left-aligns.
		  3. When item > available, fills available + scroll bar.
		*/
		display: grid;
		grid-template-columns: minmax(0, 50em);
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			* http://lea.verou.me/2012/04/background-attachment-local/
			*
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
						top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
						top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
						top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
						white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed version caf0aeb39, updated Mon Dec 15 22:51:46 2025 +0000" name="generator">
  <link href="https://jsonlt.org/latest/" rel="canonical">
  <meta content="dark light" name="color-scheme">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example " counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="no-ref p-name" id="title">JSON Lines Table (JSONLT) 1.0</h1>
   <h2 class="heading no-num no-ref no-toc settled" id="profile-and-date"><span class="content">Living Standard,
    <time class="dt-updated" datetime="2025-12-22">22 December 2025</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://jsonlt.org/latest/">https://jsonlt.org/latest/</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/jsonlt/jsonlt/issues/">GitHub</a>
     <dt class="editor">Editor:
     <dd class="editor h-card p-author vcard"><a class="email fn p-name u-email" href="mailto:tony@tonyburns.net">Tony Burns</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright">Copyright © 2025 <a href="https://github.com/tbhb">Tony Burns</a>. Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a><img alt="Creative Commons" height="16" src="images/cc.svg" style="max-width: 1em;max-height:1em;margin-left: .2em;" width="16"><img alt="Attribution" height="16" src="images/by.svg" style="max-width: 1em;max-height:1em;margin-left: .2em;" width="16">
</p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="heading no-num no-ref no-toc settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines JSONLT, a format and interface for storing keyed records in a single file using an append-only operation log. The format uses JSON Lines <a data-link-type="biblio" href="#biblio-jsonl" title="JSON Lines">[JSONL]</a> as its physical representation, producing files that are both human-readable and optimized for version control systems.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-ref no-toc" id="contents">Table of Contents</h2>
   <ol class="toc">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#purpose"><span class="secno">1.1</span> <span class="content">Purpose</span></a>
      <li><a href="#scope"><span class="secno">1.2</span> <span class="content">Scope</span></a>
     </ol>
    <li>
     <a href="#terminology"><span class="secno">2</span> <span class="content">Terminology</span></a>
     <ol class="toc">
      <li><a href="#notation"><span class="secno">2.1</span> <span class="content">Notation</span></a>
     </ol>
    <li>
     <a href="#conformance-requirements"><span class="secno">3</span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#conformance-parser"><span class="secno">3.1</span> <span class="content">Parser</span></a>
      <li><a href="#conformance-generator"><span class="secno">3.2</span> <span class="content">Generator</span></a>
      <li><a href="#claiming-conformance"><span class="secno">3.3</span> <span class="content">Claiming conformance</span></a>
     </ol>
    <li>
     <a href="#constructs"><span class="secno">4</span> <span class="content">Constructs</span></a>
     <ol class="toc">
      <li>
       <a href="#key"><span class="secno">4.1</span> <span class="content">Key</span></a>
       <ol class="toc">
        <li><a href="#key-equality"><span class="secno">4.1.1</span> <span class="content">Key equality</span></a>
        <li><a href="#key-ordering"><span class="secno">4.1.2</span> <span class="content">Key ordering</span></a>
       </ol>
      <li><a href="#key-specifier"><span class="secno">4.2</span> <span class="content">Key specifier</span></a>
      <li><a href="#record"><span class="secno">4.3</span> <span class="content">Record</span></a>
      <li><a href="#tombstone"><span class="secno">4.4</span> <span class="content">Tombstone</span></a>
      <li><a href="#operation"><span class="secno">4.5</span> <span class="content">Operation</span></a>
      <li><a href="#header"><span class="secno">4.6</span> <span class="content">Header</span></a>
      <li><a href="#logical-state"><span class="secno">4.7</span> <span class="content">Logical state</span></a>
      <li><a href="#table"><span class="secno">4.8</span> <span class="content">Table</span></a>
      <li><a href="#transaction"><span class="secno">4.9</span> <span class="content">Transaction</span></a>
     </ol>
    <li>
     <a href="#physical-format"><span class="secno">5</span> <span class="content">Physical format</span></a>
     <ol class="toc">
      <li><a href="#encoding"><span class="secno">5.1</span> <span class="content">Encoding</span></a>
      <li><a href="#media-type"><span class="secno">5.2</span> <span class="content">Media type</span></a>
      <li><a href="#line-structure"><span class="secno">5.3</span> <span class="content">Line structure</span></a>
      <li><a href="#deterministic-serialization"><span class="secno">5.4</span> <span class="content">Deterministic serialization</span></a>
      <li><a href="#string-values"><span class="secno">5.5</span> <span class="content">String values</span></a>
      <li><a href="#operation-encoding"><span class="secno">5.6</span> <span class="content">Operation encoding</span></a>
     </ol>
    <li>
     <a href="#exceptions"><span class="secno">6</span> <span class="content">Exceptions</span></a>
     <ol class="toc">
      <li><a href="#exception-parse"><span class="secno">6.1</span> <span class="content">Parse errors (ParseError)</span></a>
      <li><a href="#exception-key"><span class="secno">6.2</span> <span class="content">Key errors (KeyError)</span></a>
      <li><a href="#exception-io"><span class="secno">6.3</span> <span class="content">File errors (IOError)</span></a>
      <li><a href="#exception-lock"><span class="secno">6.4</span> <span class="content">Lock errors (LockError)</span></a>
      <li><a href="#exception-limit"><span class="secno">6.5</span> <span class="content">Limit errors (LimitError)</span></a>
      <li><a href="#exception-transaction"><span class="secno">6.6</span> <span class="content">Transaction errors (TransactionError)</span></a>
     </ol>
    <li>
     <a href="#api"><span class="secno">7</span> <span class="content">API</span></a>
     <ol class="toc">
      <li><a href="#api-table"><span class="secno">7.1</span> <span class="content">Table constructor</span></a>
      <li><a href="#api-options"><span class="secno">7.2</span> <span class="content">TableOptions</span></a>
      <li><a href="#api-read"><span class="secno">7.3</span> <span class="content">Read operations</span></a>
      <li><a href="#api-write"><span class="secno">7.4</span> <span class="content">Write operations</span></a>
      <li><a href="#api-transaction"><span class="secno">7.5</span> <span class="content">Transaction operations</span></a>
      <li><a href="#api-maintenance"><span class="secno">7.6</span> <span class="content">Maintenance operations</span></a>
     </ol>
    <li>
     <a href="#algorithms"><span class="secno">8</span> <span class="content">Algorithms</span></a>
     <ol class="toc">
      <li><a href="#algo-extract-key"><span class="secno">8.1</span> <span class="content">Extracting a key</span></a>
      <li><a href="#algo-operation-type"><span class="secno">8.2</span> <span class="content">Determining the operation type</span></a>
      <li><a href="#algo-logical-state"><span class="secno">8.3</span> <span class="content">Computing the logical state</span></a>
      <li><a href="#algo-open"><span class="secno">8.4</span> <span class="content">Opening a table</span></a>
      <li><a href="#algo-read"><span class="secno">8.5</span> <span class="content">Reading a table file</span></a>
      <li><a href="#algo-transaction"><span class="secno">8.6</span> <span class="content">Transaction operations</span></a>
     </ol>
    <li>
     <a href="#table-operations"><span class="secno">9</span> <span class="content">Table operations</span></a>
     <ol class="toc">
      <li><a href="#algo-get"><span class="secno">9.1</span> <span class="content">Getting a record</span></a>
      <li><a href="#algo-has"><span class="secno">9.2</span> <span class="content">Checking for a record</span></a>
      <li><a href="#algo-all"><span class="secno">9.3</span> <span class="content">Getting all records</span></a>
      <li><a href="#algo-keys"><span class="secno">9.4</span> <span class="content">Getting all keys</span></a>
      <li><a href="#algo-count"><span class="secno">9.5</span> <span class="content">Counting records</span></a>
      <li><a href="#algo-find"><span class="secno">9.6</span> <span class="content">Finding records</span></a>
      <li><a href="#algo-find-one"><span class="secno">9.7</span> <span class="content">Finding one record</span></a>
      <li><a href="#algo-put"><span class="secno">9.8</span> <span class="content">Putting a record</span></a>
      <li><a href="#algo-delete"><span class="secno">9.9</span> <span class="content">Deleting a record</span></a>
      <li><a href="#algo-clear"><span class="secno">9.10</span> <span class="content">Clearing all records</span></a>
      <li><a href="#algo-compact"><span class="secno">9.11</span> <span class="content">Compacting a table</span></a>
     </ol>
    <li>
     <a href="#concurrency"><span class="secno">10</span> <span class="content">Concurrency</span></a>
     <ol class="toc">
      <li><a href="#file-locking"><span class="secno">10.1</span> <span class="content">File locking</span></a>
      <li><a href="#auto-reload"><span class="secno">10.2</span> <span class="content">Auto-reload behavior</span></a>
     </ol>
    <li><a href="#size-complexity"><span class="secno">11</span> <span class="content">Size and complexity</span></a>
    <li><a href="#security"><span class="secno">12</span> <span class="content">Security considerations</span></a>
    <li><a href="#privacy"><span class="secno">13</span> <span class="content">Privacy considerations</span></a>
    <li><a href="#i18n"><span class="secno">14</span> <span class="content">Internationalization considerations</span></a>
    <li><a href="#a11y"><span class="secno">15</span> <span class="content">Accessibility considerations</span></a>
    <li><a href="#extensions"><span class="secno">16</span> <span class="content">Extension mechanism</span></a>
    <li>
     <a href="#appendix-implementation"><span class="secno">17</span> <span class="content">Implementation mapping</span></a>
     <ol class="toc">
      <li><a href="#impl-basic-types"><span class="secno">17.1</span> <span class="content">Basic types</span></a>
      <li><a href="#impl-compound-types"><span class="secno">17.2</span> <span class="content">Compound types</span></a>
      <li><a href="#impl-null"><span class="secno">17.3</span> <span class="content">Null and optional values</span></a>
      <li><a href="#impl-predicates"><span class="secno">17.4</span> <span class="content">Predicates</span></a>
      <li><a href="#impl-thread-safety"><span class="secno">17.5</span> <span class="content">Thread safety</span></a>
     </ol>
    <li>
     <a href="#appendix-profile-requirements"><span class="secno">18</span> <span class="content">Profile requirement summary</span></a>
     <ol class="toc">
      <li><a href="#profile-parser"><span class="secno">18.1</span> <span class="content">Parser requirements</span></a>
      <li><a href="#profile-generator"><span class="secno">18.2</span> <span class="content">Generator requirements</span></a>
      <li><a href="#profile-both"><span class="secno">18.3</span> <span class="content">Both profiles</span></a>
     </ol>
    <li>
     <a href="#acks"><span class="secno">19</span> <span class="content">Acknowledgments</span></a>
     <ol class="toc">
      <li><a href="#ai-assistance"><span class="secno">19.1</span> <span class="content">AI assistance disclosure</span></a>
     </ol>
    <li><a href="#conformance"><span class="secno"></span> <span class="content">
    Conformance</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>A JSONLT file contains a sequence of operations—insertions and deletions—rather than a snapshot of current state. The <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state">logical state</a> of the table (the current set of records after all operations have been applied; see <a href="#logical-state">§ 4.7 Logical state</a>) is computed by replaying these operations in order. This append-only design ensures that modifications produce minimal diffs when the file is tracked in version control.</p>
   <h3 class="heading settled" data-level="1.1" id="purpose"><span class="secno">1.1. </span><span class="content">Purpose</span><a class="self-link" href="#purpose"></a></h3>
   <p>JSONLT provides a lightweight, portable format for storing keyed records that:</p>
   <ul>
    <li data-md>
     <p>Is human-readable and editable with standard text tools</p>
    <li data-md>
     <p>Produces clean diffs in version control systems</p>
    <li data-md>
     <p>Supports concurrent access through file locking</p>
    <li data-md>
     <p>Requires no external database or service</p>
   </ul>
   <h3 class="heading settled" data-level="1.2" id="scope"><span class="secno">1.2. </span><span class="content">Scope</span><a class="self-link" href="#scope"></a></h3>
   <p>This specification defines:</p>
   <ul>
    <li data-md>
     <p>The physical file format (encoding, line structure, JSON representation)</p>
    <li data-md>
     <p>The logical data model (keys, records, operations, state)</p>
    <li data-md>
     <p>Processing algorithms (parsing, serialization, compaction)</p>
    <li data-md>
     <p>An abstract interface for implementations</p>
    <li data-md>
     <p>Concurrency and transaction semantics</p>
   </ul>
   <h2 class="heading settled" data-level="2" id="terminology"><span class="secno">2. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h2>
   <p>This specification uses terminology from the Infra Standard <a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a> where applicable, including <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">string</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence">byte sequence</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a>, and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The Infra Standard defines "string" as a sequence of code points, which can include surrogate code points. JSONLT uses this definition, but <a href="#string-values">§ 5.5 String values</a> recommends against unpaired surrogates for interoperability. Implementations can use Infra’s "scalar value string" (which excludes surrogates) if they reject strings with unpaired surrogates.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="json-object">JSON object</dfn> is an unordered collection of property names (strings) and JSON values, as defined in <a data-link-type="biblio" href="#biblio-rfc8259" title="The JavaScript Object Notation (JSON) Data Interchange Format">[RFC8259]</a>.</p>
   <h3 class="heading settled" data-level="2.1" id="notation"><span class="secno">2.1. </span><span class="content">Notation</span><a class="self-link" href="#notation"></a></h3>
   <p>This specification uses a language-agnostic notation to describe abstract interfaces. The notation conventions are inspired by <a data-link-type="biblio" href="#biblio-rfc9622" title="A TAPS Interface to Transport Services">[RFC9622]</a>.</p>
   <p><strong>Object creation</strong> is written as:</p>
<pre>object := Constructor(param, optionalParam?)
</pre>
   <p>This creates an object by invoking a constructor with the given parameters. Parameters marked with <code>?</code> are optional.</p>
   <p><strong>Method invocation</strong> is written as:</p>
<pre>result := object.method(param)
</pre>
   <p>This invokes a method on an object and assigns the return value. When a method returns no meaningful value, the assignment is omitted:</p>
<pre>object.action()
</pre>
   <p>The <strong>basic types</strong> used in this specification are:</p>
   <ul>
    <li data-md>
     <p><strong>Boolean</strong>: <code>true</code> or <code>false</code></p>
    <li data-md>
     <p><strong>Integer</strong>: a whole number within the range −(2<sup>53</sup>)+1 to (2<sup>53</sup>)−1</p>
    <li data-md>
     <p><strong>String</strong>: a sequence of Unicode code points</p>
    <li data-md>
     <p><strong>Key</strong>: a <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key">key</a> as defined in <a href="#key">§ 4.1 Key</a></p>
    <li data-md>
     <p><strong>Record</strong>: a <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record">record</a> as defined in <a href="#record">§ 4.3 Record</a></p>
   </ul>
   <p>The <strong>compound types</strong> are:</p>
   <ul>
    <li data-md>
     <p><strong>List&lt;T></strong>: an ordered sequence of values of type T</p>
    <li data-md>
     <p><strong>T | Null</strong>: a value of type T, or null indicating absence</p>
   </ul>
   <p>Implementations SHOULD map these abstract types to idiomatic constructs in their target language. See <a href="#appendix-implementation">§ 17 Implementation mapping</a> for guidance.</p>
   <h2 class="heading settled" data-level="3" id="conformance-requirements"><span class="secno">3. </span><span class="content">Conformance</span><a class="self-link" href="#conformance-requirements"></a></h2>
   <p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> <a data-link-type="biblio" href="#biblio-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.</p>
   <p>Implementations MAY conform as a parser, generator, or both, as defined in the following subsections. A conforming implementation MAY provide additional functionality not described here, provided such functionality does not alter the behavior of operations defined in this specification.</p>
   <h3 class="heading settled" data-level="3.1" id="conformance-parser"><span class="secno">3.1. </span><span class="content">Parser</span><a class="self-link" href="#conformance-parser"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="conforming-parser">conforming parser</dfn> is an implementation that reads JSONLT files.</p>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser">conforming parser</a> SHALL:</p>
   <ol>
    <li data-md>
     <p>Accept any file that conforms to <a href="#physical-format">§ 5 Physical format</a>.</p>
    <li data-md>
     <p>Implement the <a data-link-type="dfn" href="#read-a-table-file" id="ref-for-read-a-table-file">read a table file</a> and <a data-link-type="dfn" href="#compute-the-logical-state" id="ref-for-compute-the-logical-state">compute the logical state</a> algorithms.</p>
    <li data-md>
     <p>Signal errors as defined in <a href="#exceptions">§ 6 Exceptions</a>.</p>
   </ol>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser①">conforming parser</a> SHOULD preserve unrecognized fields whose names begin with <code>$</code> to support forward compatibility with future specification versions.</p>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser②">conforming parser</a> MAY accept non-conforming input, provided that it produces a diagnostic indicating the non-conformance and processes valid lines normally. The following deviations are candidates for lenient recovery:</p>
   <ul>
    <li data-md>
     <p>Files missing a trailing newline (process final line if valid JSON)</p>
    <li data-md>
     <p>Empty lines (skip them)</p>
    <li data-md>
     <p>Lines with trailing whitespace (strip before parsing)</p>
    <li data-md>
     <p>CRLF line endings (strip CR before LF)</p>
    <li data-md>
     <p>BOM at file start (strip it)</p>
    <li data-md>
     <p>Tombstones with extra fields (ignore the extra fields)</p>
   </ul>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser③">conforming parser</a> SHOULD NOT attempt recovery for:</p>
   <ul>
    <li data-md>
     <p>Invalid JSON syntax (cannot determine record boundaries)</p>
    <li data-md>
     <p>Invalid UTF-8 encoding (cannot decode content)</p>
    <li data-md>
     <p>Unsupported version numbers (cannot interpret semantics)</p>
   </ul>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser④">conforming parser</a> MAY omit write operations.</p>
   <h3 class="heading settled" data-level="3.2" id="conformance-generator"><span class="secno">3.2. </span><span class="content">Generator</span><a class="self-link" href="#conformance-generator"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="conforming-generator">conforming generator</dfn> is an implementation that writes JSONLT files.</p>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator">conforming generator</a> SHALL:</p>
   <ol>
    <li data-md>
     <p>Produce output that conforms to <a href="#physical-format">§ 5 Physical format</a>.</p>
    <li data-md>
     <p>Use <a data-link-type="dfn" href="#dfn-deterministic-serialization" id="ref-for-dfn-deterministic-serialization">deterministic serialization</a> for all output.</p>
    <li data-md>
     <p>Reject records that violate <a href="#record">§ 4.3 Record</a>, including records with field names beginning with <code>$</code>.</p>
   </ol>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser⑤">conforming parser</a> SHALL accept any file produced by a <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator①">conforming generator</a>.</p>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator②">conforming generator</a> MAY omit read operations.</p>
   <h3 class="heading settled" data-level="3.3" id="claiming-conformance"><span class="secno">3.3. </span><span class="content">Claiming conformance</span><a class="self-link" href="#claiming-conformance"></a></h3>
   <p>An implementation claiming conformance to this specification SHOULD document:</p>
   <ul>
    <li data-md>
     <p>Which profile(s) it conforms to (<a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser⑥">conforming parser</a>, <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator③">conforming generator</a>, or both)</p>
    <li data-md>
     <p>Which optional features it supports</p>
    <li data-md>
     <p>Any implementation-specific limits (<a data-link-type="dfn" href="#key-length" id="ref-for-key-length">key length</a>, <a data-link-type="dfn" href="#record-size" id="ref-for-record-size">record size</a>, nesting depth)</p>
    <li data-md>
     <p>Any extensions or deviations from this specification</p>
   </ul>
   <p>Optional features that implementations MAY support include:</p>
   <ul>
    <li data-md>
     <p><a data-link-type="dfn" href="#dfn-transaction" id="ref-for-dfn-transaction">Transaction</a> operations (<a href="#api-transaction">§ 7.5 Transaction operations</a>)</p>
    <li data-md>
     <p>Unicode normalization of keys (<a href="#key-equality">§ 4.1.1 Key equality</a>)</p>
    <li data-md>
     <p>Lenient recovery from non-conforming input (<a href="#conformance-parser">§ 3.1 Parser</a>)</p>
    <li data-md>
     <p>JSON Schema validation of records (<a href="#header">§ 4.6 Header</a>)</p>
    <li data-md>
     <p>Compaction (<a href="#algo-compact">§ 9.11 Compacting a table</a>)</p>
   </ul>
   <p>A conformance claim MAY use the form: "This implementation conforms to JSONLT 1.0 as a [parser|generator|parser and generator]."</p>
   <h2 class="heading settled" data-level="4" id="constructs"><span class="secno">4. </span><span class="content">Constructs</span><a class="self-link" href="#constructs"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="key"><span class="secno">4.1. </span><span class="content">Key</span><a class="self-link" href="#key"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dfn-key">key</dfn> identifies a <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record①">record</a> within a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table">table</a>. A <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key①">key</a> is one of:</p>
   <ul>
    <li data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①">string</a></p>
    <li data-md>
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="integer">integer</dfn> (a JSON number with no fractional component, in the range [−(2<sup>53</sup>)+1, (2<sup>53</sup>)−1]; this "interoperable" range from <a data-link-type="biblio" href="#biblio-rfc8259" title="The JavaScript Object Notation (JSON) Data Interchange Format">[RFC8259]</a> Section 6 corresponds to integers that IEEE 754 double-precision floating-point can represent exactly)</p>
    <li data-md>
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="tuple">tuple</dfn> of strings and/or integers</p>
   </ul>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="key element|key elements" data-noexport id="key-element">key element</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string②">string</a> or <a data-link-type="dfn" href="#integer" id="ref-for-integer">integer</a> that may appear as a component of a <a data-link-type="dfn" href="#tuple" id="ref-for-tuple">tuple</a> key.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="valid-key">valid key</dfn> is a <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key②">key</a> that is either a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③">string</a>, an <a data-link-type="dfn" href="#integer" id="ref-for-integer①">integer</a> within the range [−(2<sup>53</sup>)+1, (2<sup>53</sup>)−1], or a non-empty <a data-link-type="dfn" href="#tuple" id="ref-for-tuple①">tuple</a> of <a data-link-type="dfn" href="#valid-key-element" id="ref-for-valid-key-element">valid key elements</a>. A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="valid-key-element">valid key element</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string④">string</a> or an <a data-link-type="dfn" href="#integer" id="ref-for-integer②">integer</a> within the range [−(2<sup>53</sup>)+1, (2<sup>53</sup>)−1].</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="scalar-key">scalar key</dfn> is a <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key③">key</a> that is either a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑤">string</a> or an <a data-link-type="dfn" href="#integer" id="ref-for-integer③">integer</a> (but not a <a data-link-type="dfn" href="#tuple" id="ref-for-tuple②">tuple</a>).</p>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator④">conforming generator</a> SHALL NOT produce <a data-link-type="dfn" href="#tuple" id="ref-for-tuple③">tuple</a> keys with zero elements; a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser⑦">conforming parser</a> SHALL reject empty arrays where a <a data-link-type="dfn" href="#tuple" id="ref-for-tuple④">tuple</a> key is expected. A <a data-link-type="dfn" href="#tuple" id="ref-for-tuple⑤">tuple</a> key SHALL NOT exceed 16 elements; a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser⑧">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator⑤">conforming generator</a> SHALL signal a <a data-link-type="dfn" href="#limit-error" id="ref-for-limit-error">limit error</a> when this limit is exceeded.</p>
   <p>A JSON number is considered an <a data-link-type="dfn" href="#integer" id="ref-for-integer④">integer</a> if, when converted to an IEEE 754 double-precision value, it has no fractional component and falls within the specified range. The numbers <code>1</code>, <code>1.0</code>, and <code>1e0</code> are all considered the integer 1. The number <code>1.5</code> is not an integer. The number <code>9007199254740992</code> (2<sup>53</sup>) is not a valid integer key because it exceeds the range; IEEE 754 double-precision can represent integers exactly only within the range [−(2<sup>53</sup>)+1, (2<sup>53</sup>)−1].</p>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser⑨">conforming parser</a> SHALL normalize integer keys to their canonical numeric value before comparison. Implementations SHALL NOT distinguish between equivalent numeric representations (for example, <code>1</code>, <code>1.0</code>, <code>1e0</code> SHALL all map to the same key).</p>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator⑥">conforming generator</a> SHALL NOT produce keys that are null, boolean, array (except as a <a data-link-type="dfn" href="#tuple" id="ref-for-tuple⑥">tuple</a> of valid <a data-link-type="dfn" href="#key-element" id="ref-for-key-element">key elements</a>), or object. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser①⓪">conforming parser</a> SHALL treat such values as errors when encountered where a key is expected.</p>
   <p>An empty string (<code>""</code>) is a valid <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑥">string</a> key.</p>
   <div class="example" id="example-07f83693">
    <a class="self-link" href="#example-07f83693"></a>
Table using an empty string as a key:


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- u>"id"</c-><c- p>}}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- u>""</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Default record"</c-><c- p>}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- u>"alice"</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Alice"</c-><c- p>}</c->
</pre>
    <p>The empty string <code>""</code> and <code>"alice"</code> are distinct keys.</p>
   </div>
   <h4 class="heading settled" data-level="4.1.1" id="key-equality"><span class="secno">4.1.1. </span><span class="content">Key equality</span><a class="self-link" href="#key-equality"></a></h4>
   <p>Keys are compared for equality as follows:</p>
   <ul>
    <li data-md>
     <p>String keys are equal if they consist of the same sequence of Unicode code points.</p>
    <li data-md>
     <p>Integer keys are equal if they have the same numeric value.</p>
    <li data-md>
     <p>Tuple keys are equal if they have the same length and each corresponding element is equal. (Note: Empty tuples are not valid keys, so tuple equality always involves at least one element.)</p>
    <li data-md>
     <p>Keys of different types are never equal.</p>
   </ul>
   <p>Unicode normalization is not performed during key comparison. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser①①">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator⑦">conforming generator</a> MAY normalize keys to NFC before comparison and storage; if so, the implementation SHALL document this behavior and apply it consistently.</p>
   <div class="example" id="example-cde01628">
    <a class="self-link" href="#example-cde01628"></a>
Unicode normalization affects key equality. Consider this file:


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- u>"name"</c-><c- p>}}</c->
<c- p>{</c-><c- f>"name"</c-><c- p>:</c-> <c- u>"caf\u00E9"</c-><c- p>,</c-> <c- f>"order"</c-><c- p>:</c-> <c- mi>1</c-><c- p>}</c->
<c- p>{</c-><c- f>"name"</c-><c- p>:</c-> <c- u>"cafe\u0301"</c-><c- p>,</c-> <c- f>"order"</c-><c- p>:</c-> <c- mi>2</c-><c- p>}</c->
</pre>
    <p>The first key uses U+00E9 (precomposed é: <code>caf\u00E9</code>), while the second uses U+0065 U+0301 (e + combining acute: <code>cafe\u0301</code>). Both render as "café" but are different code point sequences. Without normalization, the table would contain two distinct records; with NFC normalization, the second would replace the first.</p>
   </div>
   <h4 class="heading settled" data-level="4.1.2" id="key-ordering"><span class="secno">4.1.2. </span><span class="content">Key ordering</span><a class="self-link" href="#key-ordering"></a></h4>
   <p>Keys are ordered as follows for operations that require ordering (such as compaction and iteration):</p>
   <ul>
    <li data-md>
     <p>Integers are ordered numerically.</p>
    <li data-md>
     <p>Strings are ordered lexicographically by Unicode code point.</p>
    <li data-md>
     <p>Tuples are ordered lexicographically by element. Shorter tuples are ordered before longer tuples when all elements of the shorter tuple match the corresponding elements of the longer tuple. When comparing tuple elements of different types (for example, an integer in one tuple and a string in the other at the same position), integers are ordered before strings, consistent with top-level key ordering.</p>
   </ul>
   <p>When comparing keys of different types, integers are ordered before strings, and strings are ordered before tuples.</p>
   <p>When this specification refers to keys "in ascending order" or "in ascending key order," it means sorted from lowest to highest according to the ordering defined in this section.</p>
   <div class="example" id="example-0ec45a64">
    <a class="self-link" href="#example-0ec45a64"></a>
    Key ordering examples:


    <ul>
     <li data-md>
      <p>Integers: <code>1</code> &lt; <code>2</code> &lt; <code>100</code> (numeric order)</p>
     <li data-md>
      <p>Strings: <code>"apple"</code> &lt; <code>"banana"</code> &lt; <code>"cherry"</code> (lexicographic by code point)</p>
     <li data-md>
      <p>Tuples: <code>["a", 1]</code> &lt; <code>["a", 2]</code> &lt; <code>["b", 1]</code> (element-by-element comparison)</p>
     <li data-md>
      <p>Cross-type: <code>42</code> &lt; <code>"42"</code> &lt; <code>["42"]</code> (integer &lt; string &lt; tuple)</p>
    </ul>
   </div>
   <h3 class="heading settled" data-level="4.2" id="key-specifier"><span class="secno">4.2. </span><span class="content">Key specifier</span><a class="self-link" href="#key-specifier"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dfn-key-specifier">key specifier</dfn> defines how to extract a <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key④">key</a> from a <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record②">record</a>. A <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier">key specifier</a> is one of:</p>
   <ul>
    <li data-md>
     <p>A string naming a single field (for single-field keys)</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#tuple" id="ref-for-tuple⑦">tuple</a> of strings naming multiple fields (for compound keys)</p>
   </ul>
   <p>A <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier①">key specifier</a> is <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="valid">valid</dfn> if it is either a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑦">string</a>, or a <a data-link-type="dfn" href="#tuple" id="ref-for-tuple⑧">tuple</a> containing at least one field name with no duplicate field names.</p>
   <p>Two <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier②">key specifiers</a> <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="key specifier match|key specifiers match" data-noexport id="key-specifier-match">match</dfn> if, after normalizing single-element tuples to strings, they are structurally identical and each field name consists of the same sequence of Unicode code points. For example, <code>"id"</code> and <code>["id"]</code> match because <code>["id"]</code> normalizes to <code>"id"</code>, while <code>["org", "id"]</code> matches only <code>["org", "id"]</code> (or the equivalent single-element-normalized form, which in this case is unchanged).</p>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator⑧">conforming generator</a> SHALL NOT produce <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier③">key specifier</a> tuples with zero field names; a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser①②">conforming parser</a> SHALL reject empty arrays where a <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier④">key specifier</a> is expected.</p>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator⑨">conforming generator</a> SHALL NOT produce <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier⑤">key specifier</a> tuples with duplicate field names; a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser①③">conforming parser</a> SHALL reject such tuples.</p>
   <p>Given a <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier⑥">key specifier</a>, the <a data-link-type="dfn" href="#extract-a-key" id="ref-for-extract-a-key">extract a key</a> algorithm extracts the corresponding <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key⑤">key</a> from a <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record③">record</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> A single-element <a data-link-type="dfn" href="#tuple" id="ref-for-tuple⑨">tuple</a> key specifier (for example, <code>["id"]</code>) produces <a data-link-type="dfn" href="#scalar-key" id="ref-for-scalar-key">scalar keys</a>, not tuple keys. This normalization ensures that <code>"id"</code> and <code>["id"]</code> are interchangeable key specifiers—both extract the same <a data-link-type="dfn" href="#scalar-key" id="ref-for-scalar-key①">scalar key</a> from a record. Tuple keys are only produced when the key specifier contains two or more field names.</p>
   <div class="example" id="example-4ba965a6">
    <a class="self-link" href="#example-4ba965a6"></a>
Single-element tuple key specifier normalization:


<pre>// These two headers are equivalent:
{"$jsonlt": {"version": 1, "key": "id"}}
{"$jsonlt": {"version": 1, "key": ["id"]}}

// Both extract the scalar key "alice" from:
{"id": "alice", "name": "Alice"}

// The key is the string "alice", NOT the tuple ["alice"]
</pre>
    <p>In contrast, a two-element key specifier produces tuple keys:</p>
<pre>{"$jsonlt": {"version": 1, "key": ["org", "id"]}}
{"org": "acme", "id": "alice", "name": "Alice"}
// The key is the tuple ["acme", "alice"]
</pre>
   </div>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="key field|key fields" data-noexport id="key-field">key field</dfn> is a field whose name is specified by the table’s <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier⑦">key specifier</a>.</p>
   <h3 class="heading settled" data-level="4.3" id="record"><span class="secno">4.3. </span><span class="content">Record</span><a class="self-link" href="#record"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dfn-record">record</dfn> is a <a data-link-type="dfn" href="#json-object" id="ref-for-json-object">JSON object</a> that contains at minimum the fields REQUIRED by the table’s <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier⑧">key specifier</a>, with values that are valid <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key⑥">keys</a> or <a data-link-type="dfn" href="#key-element" id="ref-for-key-element①">key elements</a>. A record containing only the key fields (with no additional data fields) is valid.</p>
   <p>A <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record④">record</a> SHALL NOT contain fields whose names begin with <code>$</code>. Field names beginning with <code>$</code> are reserved for use by this specification and future extensions. A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator①⓪">conforming generator</a> SHALL NOT produce records containing such fields. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser①④">conforming parser</a> encountering a record with unrecognized <code>$</code>-prefixed fields SHOULD preserve them for forward compatibility with future specification versions.</p>
   <h3 class="heading settled" data-level="4.4" id="tombstone"><span class="secno">4.4. </span><span class="content">Tombstone</span><a class="self-link" href="#tombstone"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dfn-tombstone">tombstone</dfn> is a <a data-link-type="dfn" href="#json-object" id="ref-for-json-object①">JSON object</a> that marks the deletion of a <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record⑤">record</a>. A <a data-link-type="dfn" href="#dfn-tombstone" id="ref-for-dfn-tombstone">tombstone</a> contains:</p>
   <ul>
    <li data-md>
     <p>The fields REQUIRED by the table’s <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier⑨">key specifier</a>, with values identifying the deleted record</p>
    <li data-md>
     <p>A field named <code>$deleted</code> with the value <code>true</code> (the JSON boolean, not a string or other truthy value)</p>
   </ul>
   <p>A <a data-link-type="dfn" href="#dfn-tombstone" id="ref-for-dfn-tombstone①">tombstone</a> contains only the <a data-link-type="dfn" href="#key-field" id="ref-for-key-field">key fields</a> and <code>$deleted</code>. A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator①①">conforming generator</a> SHALL NOT produce tombstones with additional fields.</p>
   <p>When reading a file, if an object contains <code>$deleted</code> with a value other than the boolean <code>true</code>, a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser①⑤">conforming parser</a> SHALL treat this as a <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error">parse error</a>. If an object contains <code>$deleted: true</code> along with fields other than the <a data-link-type="dfn" href="#key-field" id="ref-for-key-field①">key fields</a>, a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser①⑥">conforming parser</a> SHOULD treat it as a valid tombstone (ignoring extra fields).</p>
   <div class="example" id="example-0dcb3644">
    <a class="self-link" href="#example-0dcb3644"></a>
Tombstone with extra fields (accepted by lenient parsers):


<pre class="highlight language-json"><c- p>{</c-><c- f>"$deleted"</c-><c- p>:</c-> <c- kc>true</c-><c- p>,</c-> <c- f>"id"</c-><c- p>:</c-> <c- u>"alice"</c-><c- p>,</c-> <c- f>"reason"</c-><c- p>:</c-> <c- u>"user requested deletion"</c-><c- p>}</c->
</pre>
    <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser①⑦">conforming parser</a> SHOULD accept this tombstone, treating <code>"reason"</code> as extraneous and ignoring it. A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator①②">conforming generator</a> SHALL NOT produce tombstones with extra fields.</p>
   </div>
   <h3 class="heading settled" data-level="4.5" id="operation"><span class="secno">4.5. </span><span class="content">Operation</span><a class="self-link" href="#operation"></a></h3>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dfn-operation">operation</dfn> is a transformation that modifies the <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state①">logical state</a> of a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table①">table</a>. Operations are either an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="upsert">upsert</dfn> or a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="delete">delete</dfn>:</p>
   <ul>
    <li data-md>
     <p>An <a data-link-type="dfn" href="#upsert" id="ref-for-upsert">upsert</a> operation inserts a new record or replaces an existing record with the same key. It is represented by a <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record⑥">record</a>.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#delete" id="ref-for-delete">delete</a> operation removes a record from the logical state. It is represented by a <a data-link-type="dfn" href="#dfn-tombstone" id="ref-for-dfn-tombstone②">tombstone</a>.</p>
   </ul>
   <p>When <a data-link-type="dfn" href="#compute-the-logical-state" id="ref-for-compute-the-logical-state①">replayed</a> in sequence, operations determine the current contents of the table.</p>
   <p>The <a data-link-type="dfn" href="#determine-the-operation-type" id="ref-for-determine-the-operation-type">determine the operation type</a> algorithm inspects a parsed JSON object to determine whether it represents an <a data-link-type="dfn" href="#upsert" id="ref-for-upsert①">upsert</a> or <a data-link-type="dfn" href="#delete" id="ref-for-delete①">delete</a>.</p>
   <h3 class="heading settled" data-level="4.6" id="header"><span class="secno">4.6. </span><span class="content">Header</span><a class="self-link" href="#header"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dfn-header">header</dfn> is an optional first line in a JSONLT file that provides metadata about the file. A <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header">header</a> is a <a data-link-type="dfn" href="#json-object" id="ref-for-json-object②">JSON object</a> containing a single field <code>$jsonlt</code> whose value is an object with the following fields:</p>
   <dl>
    <dt><code>version</code> (REQUIRED)
    <dd>An integer specifying the JSONLT specification version. For this specification, the value SHALL be <code>1</code>. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser①⑧">conforming parser</a> SHALL reject the file with a <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error①">parse error</a> indicating an unsupported version if the version field contains a value other than <code>1</code>.
    <dt><code>key</code> (optional)
    <dd>The <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier①⓪">key specifier</a> for the table, as a string or array of strings.
    <dt><code>$schema</code> (optional)
    <dd>A string containing a URL reference to a <a data-link-type="biblio" href="#biblio-json-schema" title="JSON Schema: A Media Type for Describing JSON Documents">[JSON-SCHEMA]</a> that validates records in this table.
    <dt><code>schema</code> (optional)
    <dd>A <a data-link-type="biblio" href="#biblio-json-schema" title="JSON Schema: A Media Type for Describing JSON Documents">[JSON-SCHEMA]</a> object that validates records in this table. Mutually exclusive with <code>$schema</code>; if both are present, a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser①⑨">conforming parser</a> SHALL treat this as a <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error②">parse error</a>.
    <dt><code>meta</code> (optional)
    <dd>An arbitrary JSON object containing user-defined metadata.
   </dl>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser②⓪">conforming parser</a> SHOULD preserve unknown fields in the <code>$jsonlt</code> object for forward compatibility.</p>
   <div class="example" id="example-ea38dc00">
    <a class="self-link" href="#example-ea38dc00"></a>
Minimal header (version only):


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>}}</c->
</pre>
   </div>
   <div class="example" id="example-0cf242e9">
    <a class="self-link" href="#example-0cf242e9"></a>
Header with key specifier:


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- u>"id"</c-><c- p>}}</c->
</pre>
   </div>
   <div class="example" id="example-ab8878e2">
    <a class="self-link" href="#example-ab8878e2"></a>
Header with external schema:


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- u>"id"</c-><c- p>,</c-> <c- f>"$schema"</c-><c- p>:</c-> <c- u>"https://example.com/users.schema.json"</c-><c- p>}}</c->
</pre>
   </div>
   <div class="example" id="example-c2e53361">
    <a class="self-link" href="#example-c2e53361"></a>
Header with inline schema and compound key:


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- p>[</c-><c- u>"org"</c-><c- p>,</c-> <c- u>"id"</c-><c- p>],</c-> <c- f>"schema"</c-><c- p>:</c-> <c- p>{</c-><c- f>"type"</c-><c- p>:</c-> <c- u>"object"</c-><c- p>,</c-> <c- f>"properties"</c-><c- p>:</c-> <c- p>{</c-><c- f>"org"</c-><c- p>:</c-> <c- p>{</c-><c- f>"type"</c-><c- p>:</c-> <c- u>"string"</c-><c- p>},</c-> <c- f>"id"</c-><c- p>:</c-> <c- p>{</c-><c- f>"type"</c-><c- p>:</c-> <c- u>"integer"</c-><c- p>},</c-> <c- f>"name"</c-><c- p>:</c-> <c- p>{</c-><c- f>"type"</c-><c- p>:</c-> <c- u>"string"</c-><c- p>}}},</c-> <c- f>"meta"</c-><c- p>:</c-> <c- p>{</c-><c- f>"created"</c-><c- p>:</c-> <c- u>"2025-01-15"</c-><c- p>}}}</c->
</pre>
   </div>
   <div class="example" id="example-4e2da3d7">
    <a class="self-link" href="#example-4e2da3d7"></a>
Table with integer keys (numeric identifiers):


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- u>"id"</c-><c- p>}}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- mi>1001</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Widget"</c-><c- p>,</c-> <c- f>"price"</c-><c- p>:</c-> <c- mf>9.99</c-><c- p>}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- mi>1002</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Gadget"</c-><c- p>,</c-> <c- f>"price"</c-><c- p>:</c-> <c- mf>19.99</c-><c- p>}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- mi>1003</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Sprocket"</c-><c- p>,</c-> <c- f>"price"</c-><c- p>:</c-> <c- mf>4.99</c-><c- p>}</c->
</pre>
    <p>The keys are the integers 1001, 1002, and 1003.</p>
   </div>
   <div class="example" id="example-57667480">
    <a class="self-link" href="#example-57667480"></a>
Table with compound (tuple) keys:


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- p>[</c-><c- u>"org"</c-><c- p>,</c-> <c- u>"id"</c-><c- p>]}}</c->
<c- p>{</c-><c- f>"org"</c-><c- p>:</c-> <c- u>"acme"</c-><c- p>,</c-> <c- f>"id"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Alice"</c-><c- p>,</c-> <c- f>"role"</c-><c- p>:</c-> <c- u>"admin"</c-><c- p>}</c->
<c- p>{</c-><c- f>"org"</c-><c- p>:</c-> <c- u>"acme"</c-><c- p>,</c-> <c- f>"id"</c-><c- p>:</c-> <c- mi>2</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Bob"</c-><c- p>,</c-> <c- f>"role"</c-><c- p>:</c-> <c- u>"user"</c-><c- p>}</c->
<c- p>{</c-><c- f>"org"</c-><c- p>:</c-> <c- u>"globex"</c-><c- p>,</c-> <c- f>"id"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Carol"</c-><c- p>,</c-> <c- f>"role"</c-><c- p>:</c-> <c- u>"admin"</c-><c- p>}</c->
<c- p>{</c-><c- f>"$deleted"</c-><c- p>:</c-> <c- kc>true</c-><c- p>,</c-> <c- f>"org"</c-><c- p>:</c-> <c- u>"acme"</c-><c- p>,</c-> <c- f>"id"</c-><c- p>:</c-> <c- mi>2</c-><c- p>}</c->
</pre>
    <p>The keys are the tuples ["acme", 1], ["acme", 2], and ["globex", 1]. After the delete operation, only ["acme", 1] and ["globex", 1] remain. Note that ["acme", 1] and ["globex", 1] are distinct keys because their first elements differ.</p>
   </div>
   <div class="example" id="example-1812db6f">
    <a class="self-link" href="#example-1812db6f"></a>
Table with a three-element compound key:


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- p>[</c-><c- u>"region"</c-><c- p>,</c-> <c- u>"org"</c-><c- p>,</c-> <c- u>"id"</c-><c- p>]}}</c->
<c- p>{</c-><c- f>"region"</c-><c- p>:</c-> <c- u>"us-east"</c-><c- p>,</c-> <c- f>"org"</c-><c- p>:</c-> <c- u>"acme"</c-><c- p>,</c-> <c- f>"id"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Alice"</c-><c- p>}</c->
<c- p>{</c-><c- f>"region"</c-><c- p>:</c-> <c- u>"us-east"</c-><c- p>,</c-> <c- f>"org"</c-><c- p>:</c-> <c- u>"acme"</c-><c- p>,</c-> <c- f>"id"</c-><c- p>:</c-> <c- mi>2</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Bob"</c-><c- p>}</c->
<c- p>{</c-><c- f>"region"</c-><c- p>:</c-> <c- u>"eu-west"</c-><c- p>,</c-> <c- f>"org"</c-><c- p>:</c-> <c- u>"acme"</c-><c- p>,</c-> <c- f>"id"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Carol"</c-><c- p>}</c->
</pre>
    <p>The keys are the tuples ["us-east", "acme", 1], ["us-east", "acme", 2], and ["eu-west", "acme", 1]. All three are distinct because they differ in at least one element position.</p>
   </div>
   <div class="example" id="example-d177e1cb">
    <a class="self-link" href="#example-d177e1cb"></a>
Table with integer keys at boundary values:


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- u>"id"</c-><c- p>}}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- mi>9007199254740991</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Maximum valid integer key"</c-><c- p>}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- mi>-9007199254740991</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Minimum valid integer key"</c-><c- p>}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- mi>0</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Zero is valid"</c-><c- p>}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- mi>-1</c-><c- p>,</c-> <c- f>"name"</c-><c- p>:</c-> <c- u>"Negative integers are valid"</c-><c- p>}</c->
</pre>
    <p>The values 9007199254740991 ((2<sup>53</sup>)−1) and -9007199254740991 (−(2<sup>53</sup>)+1) are the maximum and minimum valid integer keys. The value 9007199254740992 (2<sup>53</sup>) would NOT be a valid integer key because it exceeds the interoperable integer range.</p>
   </div>
   <p>If a file’s first line is a valid JSON object containing the field <code>$jsonlt</code>, a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser②①">conforming parser</a> SHALL interpret that line as a <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header①">header</a>, not as an <a data-link-type="dfn" href="#dfn-operation" id="ref-for-dfn-operation">operation</a>. If the first line is any other valid JSON object, the file has no header.</p>
   <p>A file containing only a <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header②">header</a> (no operations) is valid and represents a table with no records.</p>
   <p>When opening a table, if both the header and the caller provide a <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier①①">key specifier</a>, they SHALL <a data-link-type="dfn" href="#key-specifier-match" id="ref-for-key-specifier-match">match</a>. If they do not <a data-link-type="dfn" href="#key-specifier-match" id="ref-for-key-specifier-match①">match</a>, a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser②②">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator①③">conforming generator</a> SHALL treat this as an error.</p>
   <p>Files without headers are valid; a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser②③">conforming parser</a> SHALL treat them as version 1.</p>
   <h3 class="heading settled" data-level="4.7" id="logical-state"><span class="secno">4.7. </span><span class="content">Logical state</span><a class="self-link" href="#logical-state"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dfn-logical-state">logical state</dfn> of a table is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a> from keys to records, representing the current contents of the table after all operations have been applied.</p>
   <p>The <a data-link-type="dfn" href="#compute-the-logical-state" id="ref-for-compute-the-logical-state②">compute the logical state</a> algorithm replays a list of operations to produce the logical state.</p>
   <h3 class="heading settled" data-level="4.8" id="table"><span class="secno">4.8. </span><span class="content">Table</span><a class="self-link" href="#table"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dfn-table">table</dfn> is the central construct in JSONLT. A <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table②">table</a> has:</p>
   <ul>
    <li data-md>
     <p>A file path identifying the underlying storage</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier①②">key specifier</a> defining how records are keyed</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state②">logical state</a> computed from the file contents</p>
   </ul>
   <p>A <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table③">table</a> provides operations to read, write, and query records. All write operations append to the underlying file; the file is never modified in place during normal operation. Only compaction replaces the file.</p>
   <h3 class="heading settled" data-level="4.9" id="transaction"><span class="secno">4.9. </span><span class="content">Transaction</span><a class="self-link" href="#transaction"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dfn-snapshot">snapshot</dfn> is a copy of a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table④">table</a>’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state③">logical state</a> at a specific point in time. Within a <a data-link-type="dfn" href="#dfn-transaction" id="ref-for-dfn-transaction①">transaction</a>, the snapshot includes any modifications made within that transaction.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dfn-buffer">buffer</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a> of pending <a data-link-type="dfn" href="#dfn-operation" id="ref-for-dfn-operation①">operations</a> that have not yet been written to the underlying file.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dfn-transaction">transaction</dfn> is a context for performing multiple operations atomically. A <a data-link-type="dfn" href="#dfn-transaction" id="ref-for-dfn-transaction②">transaction</a> has:</p>
   <ul>
    <li data-md>
     <p>An associated <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table⑤">table</a></p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-snapshot" id="ref-for-dfn-snapshot">snapshot</a> of the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state④">logical state</a> at transaction start, plus any modifications made within the transaction</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-buffer" id="ref-for-dfn-buffer">buffer</a> of pending operations to be written when the transaction commits</p>
   </ul>
   <p>While a <a data-link-type="dfn" href="#dfn-transaction" id="ref-for-dfn-transaction③">transaction</a> is active:</p>
   <ul>
    <li data-md>
     <p>Read operations return data from the transaction’s <a data-link-type="dfn" href="#dfn-snapshot" id="ref-for-dfn-snapshot①">snapshot</a></p>
    <li data-md>
     <p>Write operations modify the transaction’s <a data-link-type="dfn" href="#dfn-snapshot" id="ref-for-dfn-snapshot②">snapshot</a> and append to the <a data-link-type="dfn" href="#dfn-buffer" id="ref-for-dfn-buffer①">buffer</a></p>
    <li data-md>
     <p>The underlying file is not modified</p>
   </ul>
   <p>When a <a data-link-type="dfn" href="#dfn-transaction" id="ref-for-dfn-transaction④">transaction</a> commits:</p>
   <ol>
    <li data-md>
     <p>Acquire the exclusive file lock.</p>
    <li data-md>
     <p>Reload the file if it has been modified since the transaction started.</p>
    <li data-md>
     <p>For each key written by the transaction, if that key has been modified in the reloaded state compared to the transaction’s starting state, the commit SHALL fail with a <a data-link-type="dfn" href="#conflict-error" id="ref-for-conflict-error">conflict error</a>.</p>
    <li data-md>
     <p>If no conflicts, append all buffered operations to the file as a single write operation.</p>
    <li data-md>
     <p>Release the lock.</p>
   </ol>
   <p>When a <a data-link-type="dfn" href="#dfn-transaction" id="ref-for-dfn-transaction⑤">transaction</a> aborts:</p>
   <ul>
    <li data-md>
     <p>The <a data-link-type="dfn" href="#dfn-buffer" id="ref-for-dfn-buffer②">buffer</a> is discarded</p>
    <li data-md>
     <p>The table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state⑤">logical state</a> is unchanged</p>
   </ul>
   <p>Transactions SHALL NOT nest. Attempting to start a transaction while one is already active SHALL result in an error.</p>
   <p>An implementation supporting <a data-link-type="dfn" href="#dfn-transaction" id="ref-for-dfn-transaction⑥">transactions</a> SHALL conform to both <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser②④">conforming parser</a> and <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator①④">conforming generator</a> requirements. An implementation that conforms to only one profile MAY omit transaction operations.</p>
   <p>JSONLT uses an optimistic concurrency model: transactions do not hold locks during execution, only at commit time. Conflict detection is based on write-write conflicts only—if two transactions write to the same key, the second to commit fails. Read-write conflicts (where a transaction reads a value that another transaction subsequently modifies) are not detected. Applications requiring stronger isolation guarantees SHOULD implement additional coordination at the application level.</p>
   <div class="example" id="example-9f62f741">
    <a class="self-link" href="#example-9f62f741"></a>
Transaction workflow—successful commit:


<pre>tx := table.transaction()          // Capture snapshot
record := tx.get("alice")          // Read from snapshot
record.balance := record.balance + 100
tx.put(record)                     // Buffer the write
tx.commit()                        // Acquire lock, check conflicts, write
</pre>
    <p>Transaction workflow—conflict scenario:</p>
<pre>// Process A                       // Process B
txA := table.transaction()         txB := table.transaction()
recA := txA.get("alice")           recB := txB.get("alice")
recA.balance := recA.balance + 50  recB.balance := recB.balance + 25
txA.put(recA)                      txB.put(recB)
txA.commit()  // succeeds
                                   txB.commit()  // fails: conflict error
                                   // Process B needs to retry with new transaction
</pre>
    <p>In the conflict scenario, both transactions read the same starting state and modify the same key. When Process A commits first, it succeeds. When Process B attempts to commit, conflict detection finds that "alice" was modified since B’s transaction started, causing a <a data-link-type="dfn" href="#conflict-error" id="ref-for-conflict-error①">conflict error</a>.</p>
   </div>
   <h2 class="heading settled" data-level="5" id="physical-format"><span class="secno">5. </span><span class="content">Physical format</span><a class="self-link" href="#physical-format"></a></h2>
   <h3 class="heading settled" data-level="5.1" id="encoding"><span class="secno">5.1. </span><span class="content">Encoding</span><a class="self-link" href="#encoding"></a></h3>
   <p>A JSONLT file is a UTF-8 encoded text file without a byte order mark (BOM), conforming to <a data-link-type="biblio" href="#biblio-rfc8259" title="The JavaScript Object Notation (JSON) Data Interchange Format">[RFC8259]</a>.</p>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator①⑤">conforming generator</a> SHALL NOT produce a BOM.</p>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser②⑤">conforming parser</a> SHOULD strip any BOM encountered at the start of the file. This allows parsers to interoperate with files produced by systems that add BOMs, even though conforming JSONLT generators do not produce them.</p>
   <h3 class="heading settled" data-level="5.2" id="media-type"><span class="secno">5.2. </span><span class="content">Media type</span><a class="self-link" href="#media-type"></a></h3>
   <p>The media type for JSONLT files is <code>application/vnd.jsonlt</code>.</p>
   <p>The file extension for JSONLT files is <code>.jsonlt</code>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> At the time of publication, this media type has not been registered with IANA. The <code>vnd.</code> prefix indicates a vendor-specific type per <a data-link-type="biblio" href="#biblio-rfc6838" title="Media Type Specifications and Registration Procedures">[RFC6838]</a>.</p>
   <h3 class="heading settled" data-level="5.3" id="line-structure"><span class="secno">5.3. </span><span class="content">Line structure</span><a class="self-link" href="#line-structure"></a></h3>
   <p>An empty file (zero bytes) is valid and represents a table with no header and no operations. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser②⑥">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator①⑥">conforming generator</a> SHALL signal an error when opening an empty file without a <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier①③">key specifier</a>.</p>
   <div class="example" id="example-7d9f6215">
    <a class="self-link" href="#example-7d9f6215"></a>
Opening an empty file:


<pre>table := Table("/path/to/empty.jsonlt", "id")
count := table.count()  // Returns 0
table.put({"id": "first", "data": "example"})
</pre>
    <p>The empty file requires a key specifier on open. After the put operation, the file contains one line.</p>
   </div>
   <p>Each line contains exactly one <a data-link-type="dfn" href="#json-object" id="ref-for-json-object③">JSON object</a> followed by a newline character (U+000A). A JSONLT file SHALL contain only JSON objects, one per line. A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator①⑦">conforming generator</a> SHALL ensure non-empty files end with a newline character.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Unlike JSON Lines which permits any JSON value per line, JSONLT restricts lines to JSON objects only. This restriction supports the key-value data model where each line represents a record or tombstone.</p>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator①⑧">conforming generator</a> SHALL NOT produce carriage return characters (U+000D). A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser②⑦">conforming parser</a> SHOULD strip CR characters preceding LF.</p>
   <p class="note" role="note"><span class="marker">Note:</span> JSONLT requires LF-only line endings for output, which is stricter than JSON Lines (which permits both LF and CRLF). This ensures consistent file hashes and diffs across platforms. Files created with CRLF (for example, on Windows systems not using JSONLT generators) are technically non-conforming output, but <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser②⑧">conforming parsers</a> can accept them by stripping CR characters.</p>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator①⑨">conforming generator</a> SHALL NOT produce empty lines (lines containing no characters before the newline). A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser②⑨">conforming parser</a> SHOULD skip empty lines.</p>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser③⓪">conforming parser</a> SHALL signal a <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error③">parse error</a> when encountering a line containing only whitespace. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser③①">conforming parser</a> MAY skip such lines and continue processing rather than halting.</p>
   <p>If the file does not end with a newline character and the final line is valid JSON, a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser③②">conforming parser</a> SHALL accept it. If the file does not end with a newline character and the final line is not valid JSON (truncated due to crash or partial write), a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser③③">conforming parser</a> SHOULD ignore the malformed final line and process all preceding valid lines.</p>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator②⓪">conforming generator</a> SHALL NOT produce JSON objects with duplicate keys. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser③④">conforming parser</a> SHALL treat JSON objects containing duplicate keys as <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error④">parse errors</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This duplicate key requirement is stricter than <a data-link-type="biblio" href="#biblio-rfc8259" title="The JavaScript Object Notation (JSON) Data Interchange Format">[RFC8259]</a>, which uses "SHOULD" rather than "MUST" for unique keys. JSONLT requires unique keys to ensure deterministic parsing and consistent key extraction.</p>
   <h3 class="heading settled" data-level="5.4" id="deterministic-serialization"><span class="secno">5.4. </span><span class="content">Deterministic serialization</span><a class="self-link" href="#deterministic-serialization"></a></h3>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dfn-deterministic-serialization">Deterministic serialization</dfn> is a JSON serialization that produces consistent output for identical logical data. A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator②①">conforming generator</a> SHALL serialize JSON objects according to the following rules:</p>
   <ul>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator②②">conforming generator</a> SHALL sort object keys lexicographically by Unicode code point, recursively for nested objects.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator②③">conforming generator</a> SHALL NOT include whitespace except within string values.</p>
   </ul>
   <p>These rules ensure consistent output but do not guarantee byte-identical results across implementations due to variations in number formatting and string escaping.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Implementations requiring byte-identical output across all implementations can conform to <a data-link-type="biblio" href="#biblio-rfc8785" title="JSON Canonicalization Scheme (JCS)">[RFC8785]</a> (JSON Canonicalization Scheme). <a data-link-type="biblio" href="#biblio-rfc8785" title="JSON Canonicalization Scheme (JCS)">[RFC8785]</a> is informative; JSONLT does not require JCS conformance.</p>
   <div class="example" id="example-d25e3155">
    <a class="self-link" href="#example-d25e3155"></a>
Deterministic serialization sorts object keys by Unicode code point:


    <p>Input (logical): <code>{"zebra": 1, "apple": 2, "Banana": 3}</code></p>
    <p>Output (serialized): <code>{"Banana":3,"apple":2,"zebra":1}</code></p>
    <p>Note that uppercase letters (U+0041-U+005A) sort before lowercase letters (U+0061-U+007A) in Unicode code point order.</p>
   </div>
   <h3 class="heading settled" data-level="5.5" id="string-values"><span class="secno">5.5. </span><span class="content">String values</span><a class="self-link" href="#string-values"></a></h3>
   <p>String values within records MAY contain any valid JSON string content, including escaped newlines (<code>\n</code>), tabs (<code>\t</code>), and other control characters. The JSON encoding ensures that literal newline characters never appear within a JSON string value, preserving the one-record-per-line property.</p>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator②④">conforming generator</a> SHALL use standard JSON string escaping and SHALL escape characters that <a data-link-type="biblio" href="#biblio-rfc8259" title="The JavaScript Object Notation (JSON) Data Interchange Format">[RFC8259]</a> requires to be escaped. A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator②⑤">conforming generator</a> SHOULD NOT escape characters that do not require escaping.</p>
   <p>String values SHALL NOT contain unpaired surrogate code points (U+D800 through U+DFFF not part of a valid surrogate pair). A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator②⑥">conforming generator</a> SHALL reject records containing unpaired surrogates. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser③⑤">conforming parser</a> encountering unpaired surrogates SHOULD accept them but MAY issue a diagnostic.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This requirement ensures cross-language interoperability. While JSON (via RFC 8259) technically permits unpaired surrogates, many programming languages (Rust, Go, Swift) cannot represent them in native string types. Requiring generators to reject unpaired surrogates ensures files can be read by implementations in any language.</p>
   <h3 class="heading settled" data-level="5.6" id="operation-encoding"><span class="secno">5.6. </span><span class="content">Operation encoding</span><a class="self-link" href="#operation-encoding"></a></h3>
   <p>Each non-header line in a JSONLT file represents one <a data-link-type="dfn" href="#dfn-operation" id="ref-for-dfn-operation②">operation</a>. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser③⑥">conforming parser</a> <a data-link-type="dfn" href="#determine-the-operation-type" id="ref-for-determine-the-operation-type①">determines the operation type</a> by inspecting the parsed object:</p>
   <ul>
    <li data-md>
     <p>If the object contains a field <code>$deleted</code> with the boolean value <code>true</code>, the line represents a <a data-link-type="dfn" href="#delete" id="ref-for-delete②">delete</a> operation (<a data-link-type="dfn" href="#dfn-tombstone" id="ref-for-dfn-tombstone③">tombstone</a>).</p>
    <li data-md>
     <p>If the object contains a field <code>$deleted</code> with any other value, the line is invalid.</p>
    <li data-md>
     <p>Otherwise, the line represents an <a data-link-type="dfn" href="#upsert" id="ref-for-upsert②">upsert</a> operation (<a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record⑦">record</a>).</p>
   </ul>
   <div class="example" id="example-3bcbfb3d">
    <a class="self-link" href="#example-3bcbfb3d"></a>
Given a table with <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier①④">key specifier</a> <code>"id"</code>, the following file content:


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- u>"id"</c-><c- p>}}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- u>"alice"</c-><c- p>,</c-> <c- f>"role"</c-><c- p>:</c-> <c- u>"user"</c-><c- p>}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- u>"bob"</c-><c- p>,</c-> <c- f>"role"</c-><c- p>:</c-> <c- u>"admin"</c-><c- p>}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- u>"alice"</c-><c- p>,</c-> <c- f>"role"</c-><c- p>:</c-> <c- u>"admin"</c-><c- p>}</c->
<c- p>{</c-><c- f>"$deleted"</c-><c- p>:</c-> <c- kc>true</c-><c- p>,</c-> <c- f>"id"</c-><c- p>:</c-> <c- u>"bob"</c-><c- p>}</c->
</pre>
    <p>The first line is a <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header③">header</a>. The subsequent lines represent this sequence of operations:</p>
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="#upsert" id="ref-for-upsert③">upsert</a> record with key "alice", value <code>{"id": "alice", "role": "user"}</code></p>
     <li data-md>
      <p><a data-link-type="dfn" href="#upsert" id="ref-for-upsert④">upsert</a> record with key "bob", value <code>{"id": "bob", "role": "admin"}</code></p>
     <li data-md>
      <p><a data-link-type="dfn" href="#upsert" id="ref-for-upsert⑤">upsert</a> record with key "alice", value <code>{"id": "alice", "role": "admin"}</code></p>
     <li data-md>
      <p><a data-link-type="dfn" href="#delete" id="ref-for-delete③">delete</a> record with key "bob"</p>
    </ol>
    <p>The resulting <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state⑥">logical state</a> contains one record:</p>
    <p>| Key | Record |
|-----|--------|
| <code>"alice"</code> | <code>{"id": "alice", "role": "admin"}</code> |</p>
    <p>Equivalently, calling <code>table.all()</code> returns:</p>
<pre class="highlight language-json"><c- p>[{</c-><c- f>"id"</c-><c- p>:</c-> <c- u>"alice"</c-><c- p>,</c-> <c- f>"role"</c-><c- p>:</c-> <c- u>"admin"</c-><c- p>}]</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="6" id="exceptions"><span class="secno">6. </span><span class="content">Exceptions</span><a class="self-link" href="#exceptions"></a></h2>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser③⑦">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator②⑦">conforming generator</a> SHALL signal errors for the following conditions. Implementations SHOULD define specific error types or codes for each category.</p>
   <h3 class="heading settled" data-level="6.1" id="exception-parse"><span class="secno">6.1. </span><span class="content">Parse errors (ParseError)</span><a class="self-link" href="#exception-parse"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parse-error">parse error</dfn> is an error that occurs when reading a JSONLT file due to malformed content. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser③⑧">conforming parser</a> SHALL signal a <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error⑤">parse error</a> for the following conditions:</p>
   <ul>
    <li data-md>
     <p>The file contains byte sequences that are not valid UTF-8.</p>
    <li data-md>
     <p>A line in the file is not valid JSON.</p>
    <li data-md>
     <p>A line in the file is valid JSON but not a JSON object.</p>
    <li data-md>
     <p>A JSON object contains duplicate keys.</p>
    <li data-md>
     <p>A line contains <code>$deleted</code> with a value other than the boolean <code>true</code>.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header④">header</a> appears at a position other than the first line.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header⑤">header</a> contains a <code>$jsonlt</code> value that is not a JSON object.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header⑥">header</a> is missing the REQUIRED <code>version</code> field.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header⑦">header</a>’s <code>version</code> field is not an integer.</p>
   </ul>
   <div class="example" id="example-63206649">
    <a class="self-link" href="#example-63206649"></a>
Examples of invalid JSONLT content that would cause parse errors:


    <p>Invalid JSON (missing closing brace):</p>
<pre>{"id": "alice", "name": "Alice"
</pre>
    <p>Valid JSON but not an object:</p>
<pre>["id", "alice"]
</pre>
    <p>Invalid <code>$deleted</code> value (requires boolean <code>true</code>):</p>
<pre>{"$deleted": "yes", "id": "alice"}
</pre>
    <p>Duplicate JSON keys:</p>
<pre>{"id": "alice", "name": "Alice", "id": "bob"}
</pre>
   </div>
   <h3 class="heading settled" data-level="6.2" id="exception-key"><span class="secno">6.2. </span><span class="content">Key errors (KeyError)</span><a class="self-link" href="#exception-key"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="key-error">key error</dfn> is an error that occurs when a key or key specifier is invalid or inconsistent. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser③⑨">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator②⑧">conforming generator</a> SHALL signal a <a data-link-type="dfn" href="#key-error" id="ref-for-key-error">key error</a> for the following conditions:</p>
   <ul>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record⑧">record</a> provided to put does not contain the REQUIRED <a data-link-type="dfn" href="#key-field" id="ref-for-key-field②">key fields</a>.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#key-field" id="ref-for-key-field③">key field</a> contains a value that is not a valid <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key⑦">key</a> (null, boolean, object, or array).</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#key-field" id="ref-for-key-field④">key field</a> contains a number outside the valid integer key range [−(2<sup>53</sup>)+1, (2<sup>53</sup>)−1].</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#key-field" id="ref-for-key-field⑤">key field</a> contains a number with a fractional component (not an integer).</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record⑨">record</a> provided to put contains a field whose name begins with <code>$</code>.</p>
    <li data-md>
     <p>The <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier①⑤">key specifier</a> provided when opening a table does not <a data-link-type="dfn" href="#key-specifier-match" id="ref-for-key-specifier-match②">match</a> the header’s key specifier.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier①⑥">key specifier</a> <a data-link-type="dfn" href="#tuple" id="ref-for-tuple①⓪">tuple</a> contains duplicate field names.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier①⑦">key specifier</a> or <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key⑧">key</a> is an empty <a data-link-type="dfn" href="#tuple" id="ref-for-tuple①①">tuple</a> (zero elements).</p>
   </ul>
   <div class="example" id="example-277c56c1">
    <a class="self-link" href="#example-277c56c1"></a>
Examples of invalid records that would cause key errors (assuming key specifier <code>"id"</code>):


    <p>Missing <a data-link-type="dfn" href="#key-field" id="ref-for-key-field⑥">key field</a>:</p>
<pre>{"name": "Alice", "role": "admin"}
</pre>
    <p>Invalid key type (null):</p>
<pre>{"id": null, "name": "Alice"}
</pre>
    <p>Invalid key type (boolean):</p>
<pre>{"id": true, "name": "Alice"}
</pre>
    <p>Reserved <code>$</code>-prefixed field in record:</p>
<pre>{"id": "alice", "name": "Alice", "$custom": "data"}
</pre>
   </div>
   <h3 class="heading settled" data-level="6.3" id="exception-io"><span class="secno">6.3. </span><span class="content">File errors (IOError)</span><a class="self-link" href="#exception-io"></a></h3>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="io-error">IO error</dfn> is an error that occurs during file system operations. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser④⓪">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator②⑨">conforming generator</a> SHALL signal an <a data-link-type="dfn" href="#io-error" id="ref-for-io-error">IO error</a> for the following conditions:</p>
   <ul>
    <li data-md>
     <p>The file cannot be read due to permissions or I/O errors.</p>
    <li data-md>
     <p>The file cannot be written due to permissions or I/O errors.</p>
    <li data-md>
     <p>Atomic file replacement fails.</p>
   </ul>
   <h3 class="heading settled" data-level="6.4" id="exception-lock"><span class="secno">6.4. </span><span class="content">Lock errors (LockError)</span><a class="self-link" href="#exception-lock"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="lock-error">lock error</dfn> is an error that occurs when file locking fails. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser④①">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator③⓪">conforming generator</a> SHALL signal a <a data-link-type="dfn" href="#lock-error" id="ref-for-lock-error">lock error</a> for the following conditions:</p>
   <ul>
    <li data-md>
     <p>A file lock cannot be acquired within the configured timeout.</p>
   </ul>
   <h3 class="heading settled" data-level="6.5" id="exception-limit"><span class="secno">6.5. </span><span class="content">Limit errors (LimitError)</span><a class="self-link" href="#exception-limit"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="limit-error">limit error</dfn> is an error signaled when content exceeds implementation limits. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser④②">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator③①">conforming generator</a> SHALL signal a <a data-link-type="dfn" href="#limit-error" id="ref-for-limit-error①">limit error</a> when:</p>
   <ul>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key⑨">key</a> exceeds the implementation’s maximum <a data-link-type="dfn" href="#key-length" id="ref-for-key-length①">key length</a>.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record①⓪">record</a> exceeds the implementation’s maximum <a data-link-type="dfn" href="#record-size" id="ref-for-record-size①">record size</a>.</p>
    <li data-md>
     <p>JSON nesting depth exceeds the implementation’s maximum depth.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#tuple" id="ref-for-tuple①②">tuple</a> key exceeds the implementation’s maximum element count.</p>
   </ul>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser④③">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator③②">conforming generator</a> MAY signal a <a data-link-type="dfn" href="#limit-error" id="ref-for-limit-error②">limit error</a> when:</p>
   <ul>
    <li data-md>
     <p>The total number of records exceeds the implementation’s capacity.</p>
   </ul>
   <p>Implementations SHALL document their limits.</p>
   <h3 class="heading settled" data-level="6.6" id="exception-transaction"><span class="secno">6.6. </span><span class="content">Transaction errors (TransactionError)</span><a class="self-link" href="#exception-transaction"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="conflict-error">conflict error</dfn> is an error that occurs when a <a data-link-type="dfn" href="#dfn-transaction" id="ref-for-dfn-transaction⑦">transaction</a> commit detects that another process has modified a key that the transaction also modified.</p>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser④④">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator③③">conforming generator</a> implementing transactions SHALL signal the following transaction errors:</p>
   <ul>
    <li data-md>
     <p>An attempt to start a nested <a data-link-type="dfn" href="#dfn-transaction" id="ref-for-dfn-transaction⑧">transaction</a>.</p>
    <li data-md>
     <p>A commit fails due to a <a data-link-type="dfn" href="#conflict-error" id="ref-for-conflict-error②">conflict error</a> (write-write conflict).</p>
   </ul>
   <h2 class="heading settled" data-level="7" id="api"><span class="secno">7. </span><span class="content">API</span><a class="self-link" href="#api"></a></h2>
   <p>This section defines the abstract interface that a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser④⑤">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator③④">conforming generator</a> SHALL provide (for operations applicable to each profile). The notation follows the conventions defined in <a href="#notation">§ 2.1 Notation</a>.</p>
   <h3 class="heading settled" data-level="7.1" id="api-table"><span class="secno">7.1. </span><span class="content">Table constructor</span><a class="self-link" href="#api-table"></a></h3>
<pre>table := Table(path, key?, options?)
</pre>
   <p>Creates or opens a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table⑥">table</a> backed by the file at <var>path</var>. The <var>path</var> parameter is a String. The <var>key</var> parameter is the <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier①⑧">key specifier</a>; if the file has a <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header⑧">header</a> with a key specifier, the provided <var>key</var> MUST match or be omitted. The <var>options</var> parameter is a TableOptions object; if <var>options</var> is not provided, default values are used. A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser④⑥">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator③⑤">conforming generator</a> SHALL execute the <a data-link-type="dfn" href="#open-a-table" id="ref-for-open-a-table">open a table</a> algorithm. If the file exists, its contents are loaded. If the file does not exist, it will be created on first write.</p>
   <h3 class="heading settled" data-level="7.2" id="api-options"><span class="secno">7.2. </span><span class="content">TableOptions</span><a class="self-link" href="#api-options"></a></h3>
   <dl>
    <dt><code>autoReload</code>
    <dd>Boolean, default true. If true, check for external file modifications before read operations by comparing the file’s modification time (mtime) to the last known value.
    <dt><code>lockTimeout</code>
    <dd>Integer (milliseconds), optional. Maximum time to wait when acquiring file locks.
   </dl>
   <p class="note" role="note"><span class="marker">Note:</span> Option names use camelCase to match common JSON naming conventions. Prose in this specification uses hyphenated forms (for example, "auto-reload") when referring to the behavior.</p>
   <h3 class="heading settled" data-level="7.3" id="api-read"><span class="secno">7.3. </span><span class="content">Read operations</span><a class="self-link" href="#api-read"></a></h3>
<pre>record := table.get(key)
</pre>
   <p>Executes the <a data-link-type="dfn" href="#get-a-record" id="ref-for-get-a-record">get a record</a> algorithm. The <var>key</var> parameter is a <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key①⓪">key</a>. Returns the <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record①①">record</a> for <var>key</var>, or null if no such record exists.</p>
<pre>exists := table.has(key)
</pre>
   <p>Executes the <a data-link-type="dfn" href="#check-for-a-record" id="ref-for-check-for-a-record">check for a record</a> algorithm. The <var>key</var> parameter is a <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key①①">key</a>. Returns true if a <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record①②">record</a> for <var>key</var> exists, false otherwise.</p>
<pre>records := table.all()
</pre>
   <p>Executes the <a data-link-type="dfn" href="#get-all-records" id="ref-for-get-all-records">get all records</a> algorithm. Returns a List&lt;Record> of all records in the <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table⑦">table</a>, in ascending key order.</p>
<pre>keys := table.keys()
</pre>
   <p>Executes the <a data-link-type="dfn" href="#get-all-keys" id="ref-for-get-all-keys">get all keys</a> algorithm. Returns a List&lt;Key> of all keys in the <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table⑧">table</a>, in ascending key order.</p>
<pre>count := table.count()
</pre>
   <p>Executes the <a data-link-type="dfn" href="#count-records" id="ref-for-count-records">count records</a> algorithm. Returns the number of records in the <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table⑨">table</a> as an Integer.</p>
<pre>records := table.find(predicate)
</pre>
   <p>Executes the <a data-link-type="dfn" href="#find-records" id="ref-for-find-records">find records</a> algorithm. The <var>predicate</var> parameter is a function that takes a Record and returns a Boolean. Returns a List&lt;Record> of all records for which <var>predicate</var> returns true, in ascending key order.</p>
<pre>record := table.findOne(predicate)
</pre>
   <p>Executes the <a data-link-type="dfn" href="#find-one-record" id="ref-for-find-one-record">find one record</a> algorithm. The <var>predicate</var> parameter is a function that takes a Record and returns a Boolean. Returns the first record (by ascending key order) for which <var>predicate</var> returns true, or null if none match.</p>
   <h3 class="heading settled" data-level="7.4" id="api-write"><span class="secno">7.4. </span><span class="content">Write operations</span><a class="self-link" href="#api-write"></a></h3>
<pre>table.put(record)
</pre>
   <p>Executes the <a data-link-type="dfn" href="#put-a-record" id="ref-for-put-a-record">put a record</a> algorithm. The <var>record</var> parameter is a <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record①③">record</a>. Inserts or updates <var>record</var> in the table. The <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key①②">key</a> is extracted from <var>record</var> using the table’s <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier①⑨">key specifier</a>.</p>
<pre>deleted := table.delete(key)
</pre>
   <p>Executes the <a data-link-type="dfn" href="#delete-a-record" id="ref-for-delete-a-record">delete a record</a> algorithm. The <var>key</var> parameter is a <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key①③">key</a>. Deletes the <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record①④">record</a> for <var>key</var>. Returns true if the record existed, false otherwise.</p>
<pre>table.clear()
</pre>
   <p>Executes the <a data-link-type="dfn" href="#clear-all-records" id="ref-for-clear-all-records">clear all records</a> algorithm. Deletes all records from the <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table①⓪">table</a> by compacting to an empty state.</p>
   <h3 class="heading settled" data-level="7.5" id="api-transaction"><span class="secno">7.5. </span><span class="content">Transaction operations</span><a class="self-link" href="#api-transaction"></a></h3>
<pre>tx := table.transaction()
</pre>
   <p>Executes the <a data-link-type="dfn" href="#begin-a-transaction" id="ref-for-begin-a-transaction">begin a transaction</a> algorithm and returns a transaction context. The transaction provides snapshot isolation: read operations within the transaction <a data-link-type="dfn" href="#perform-a-read-operation-within-a-transaction" id="ref-for-perform-a-read-operation-within-a-transaction">use the transaction’s snapshot</a>, and write operations <a data-link-type="dfn" href="#perform-a-write-operation-within-a-transaction" id="ref-for-perform-a-write-operation-within-a-transaction">buffer changes</a> until the transaction is committed or aborted.</p>
<pre>tx.commit()
</pre>
   <p>Executes the <a data-link-type="dfn" href="#commit-a-transaction" id="ref-for-commit-a-transaction">commit a transaction</a> algorithm. Writes all buffered operations to the file atomically.</p>
<pre>tx.abort()
</pre>
   <p>Executes the <a data-link-type="dfn" href="#abort-a-transaction" id="ref-for-abort-a-transaction">abort a transaction</a> algorithm. Discards all buffered operations without modifying the file.</p>
   <h3 class="heading settled" data-level="7.6" id="api-maintenance"><span class="secno">7.6. </span><span class="content">Maintenance operations</span><a class="self-link" href="#api-maintenance"></a></h3>
<pre>table.compact()
</pre>
   <p>Executes the <a data-link-type="dfn" href="#compact-a-table" id="ref-for-compact-a-table">compact a table</a> algorithm. Rewrites the file as a minimal snapshot, sorted by key.</p>
   <h2 class="heading settled" data-level="8" id="algorithms"><span class="secno">8. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
   <p>Algorithms in this specification use three forms of error indication:</p>
   <ul>
    <li data-md>
     <p>"<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="return-failure">return failure</dfn>" indicates an internal algorithm result that is expected to be handled by calling algorithms, not exposed directly to users.</p>
    <li data-md>
     <p>"return an error" indicates a general implementation error to be reported to the caller.</p>
    <li data-md>
     <p>"return a <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error⑥">parse error</a>" (or other specific error types) indicates an error that maps to a defined exception category in <a href="#exceptions">§ 6 Exceptions</a>.</p>
   </ul>
   <h3 class="heading settled" data-level="8.1" id="algo-extract-key"><span class="secno">8.1. </span><span class="content">Extracting a key</span><a class="self-link" href="#algo-extract-key"></a></h3>
   <div class="algorithm" data-algorithm="extract a key">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="extract-a-key">extract a key</dfn> from a <var>record</var> given a <var>key specifier</var>:


    <ol>
     <li data-md>
      <p>If <var>key specifier</var> is a string:</p>
      <ol>
       <li data-md>
        <p>Let <var>field</var> be <var>key specifier</var>.</p>
       <li data-md>
        <p>If <var>record</var> does not have a field named <var>field</var>, <a data-link-type="dfn" href="#return-failure" id="ref-for-return-failure">return failure</a>.</p>
       <li data-md>
        <p>Let <var>value</var> be the value of <var>record</var>[<var>field</var>].</p>
       <li data-md>
        <p>If <var>value</var> is not a valid <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key①④">key</a> (string or <a data-link-type="dfn" href="#integer" id="ref-for-integer⑤">integer</a> within the range specified in <a href="#key">§ 4.1 Key</a>), return failure.</p>
       <li data-md>
        <p>Return <var>value</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>key specifier</var> is a <a data-link-type="dfn" href="#tuple" id="ref-for-tuple①③">tuple</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>key specifier</var> contains duplicate field names, return failure.</p>
       <li data-md>
        <p>Let <var>result</var> be an empty tuple.</p>
       <li data-md>
        <p>For each <var>field</var> in <var>key specifier</var>:</p>
        <ol>
         <li data-md>
          <p>If <var>record</var> does not have a field named <var>field</var>, return failure.</p>
         <li data-md>
          <p>Let <var>value</var> be the value of <var>record</var>[<var>field</var>].</p>
         <li data-md>
          <p>If <var>value</var> is not a valid <a data-link-type="dfn" href="#key-element" id="ref-for-key-element②">key element</a>, return failure.</p>
         <li data-md>
          <p>Append <var>value</var> to <var>result</var>.</p>
        </ol>
       <li data-md>
        <p>If <var>result</var> contains exactly one element, return that element.</p>
       <li data-md>
        <p>Return <var>result</var>.</p>
      </ol>
     <li data-md>
      <p>Otherwise, return failure.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.2" id="algo-operation-type"><span class="secno">8.2. </span><span class="content">Determining the operation type</span><a class="self-link" href="#algo-operation-type"></a></h3>
   <div class="algorithm" data-algorithm="determine the operation type">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="determine-the-operation-type">determine the operation type</dfn> from a parsed JSON <var>object</var>:


    <ol>
     <li data-md>
      <p>If <var>object</var> contains a field named <code>$deleted</code>:</p>
      <ol>
       <li data-md>
        <p>If the value of <code>$deleted</code> is the boolean <code>true</code>, return <a data-link-type="dfn" href="#delete" id="ref-for-delete④">delete</a>.</p>
       <li data-md>
        <p>Otherwise, return a <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error⑦">parse error</a>.</p>
      </ol>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="#upsert" id="ref-for-upsert⑥">upsert</a>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.3" id="algo-logical-state"><span class="secno">8.3. </span><span class="content">Computing the logical state</span><a class="self-link" href="#algo-logical-state"></a></h3>
   <div class="algorithm" data-algorithm="compute the logical state">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="compute-the-logical-state">compute the logical state</dfn> from a <var>list</var> of operations using <var>key specifier</var>:


    <ol>
     <li data-md>
      <p>Let <var>state</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">map</a>.</p>
     <li data-md>
      <p>For each <var>operation</var> in <var>list</var>, in order:</p>
      <ol>
       <li data-md>
        <p>Let <var>key</var> be the result of <a data-link-type="dfn" href="#extract-a-key" id="ref-for-extract-a-key①">extracting a key</a> from <var>operation</var> using <var>key specifier</var>.</p>
       <li data-md>
        <p>If key extraction fails, return a <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error⑧">parse error</a>.</p>
       <li data-md>
        <p>Let <var>type</var> be the result of <a data-link-type="dfn" href="#determine-the-operation-type" id="ref-for-determine-the-operation-type②">determine the operation type</a> from <var>operation</var>.</p>
       <li data-md>
        <p>If <var>type</var> is a <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error⑨">parse error</a>, return <var>type</var>.</p>
       <li data-md>
        <p>If <var>type</var> is <a data-link-type="dfn" href="#delete" id="ref-for-delete⑤">delete</a>:</p>
        <ol>
         <li data-md>
          <p>Remove <var>key</var> from <var>state</var> if present.</p>
        </ol>
       <li data-md>
        <p>Otherwise (<var>type</var> is <a data-link-type="dfn" href="#upsert" id="ref-for-upsert⑦">upsert</a>):</p>
        <ol>
         <li data-md>
          <p>Set <var>state</var>[<var>key</var>] to <var>operation</var> (the record).</p>
        </ol>
      </ol>
     <li data-md>
      <p>Return <var>state</var>.</p>
    </ol>
   </div>
   <p>When the same key appears in multiple operations, the last operation in file order determines the key’s final state. This "last write wins" semantic means that later upserts replace earlier ones, and a delete removes any prior record regardless of how many times the key was previously written.</p>
   <h3 class="heading settled" data-level="8.4" id="algo-open"><span class="secno">8.4. </span><span class="content">Opening a table</span><a class="self-link" href="#algo-open"></a></h3>
   <div class="algorithm" data-algorithm="open a table">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="open-a-table">open a table</dfn> at <var>path</var> with <var>key specifier</var> and <var>options</var>:


    <ol>
     <li data-md>
      <p>If the file at <var>path</var> exists:</p>
      <ol>
       <li data-md>
        <p>Read and parse the file using the <a data-link-type="dfn" href="#read-a-table-file" id="ref-for-read-a-table-file①">read a table file</a> algorithm.</p>
       <li data-md>
        <p>If the file has a <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header⑨">header</a> and <var>key specifier</var> was provided:</p>
        <ol>
         <li data-md>
          <p>If the header’s key specifier does not <a data-link-type="dfn" href="#key-specifier-match" id="ref-for-key-specifier-match③">match</a> <var>key specifier</var>, return an error.</p>
         <li data-md>
          <p>Let <var>effective key specifier</var> be the header’s key specifier.</p>
        </ol>
       <li data-md>
        <p>If the file has a <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header①⓪">header</a> and <var>key specifier</var> was not provided:</p>
        <ol>
         <li data-md>
          <p>Let <var>effective key specifier</var> be the header’s key specifier.</p>
        </ol>
       <li data-md>
        <p>If the file has no <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header①①">header</a> and <var>key specifier</var> was not provided:</p>
        <ol>
         <li data-md>
          <p>Return an error (key specifier is REQUIRED).</p>
        </ol>
       <li data-md>
        <p>If the file has no <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header①②">header</a> and <var>key specifier</var> was provided:</p>
        <ol>
         <li data-md>
          <p>Let <var>effective key specifier</var> be <var>key specifier</var>.</p>
        </ol>
       <li data-md>
        <p>If <var>effective key specifier</var> is not a <a data-link-type="dfn" href="#valid" id="ref-for-valid">valid</a> <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier②⓪">key specifier</a>, return an error.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#compute-the-logical-state" id="ref-for-compute-the-logical-state③">Compute the logical state</a> from the operations using <var>effective key specifier</var>.</p>
      </ol>
     <li data-md>
      <p>If the file does not exist:</p>
      <ol>
       <li data-md>
        <p>If <var>key specifier</var> was not provided, return an error.</p>
       <li data-md>
        <p>If <var>key specifier</var> is not a <a data-link-type="dfn" href="#valid" id="ref-for-valid①">valid</a> <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier②①">key specifier</a>, return an error.</p>
       <li data-md>
        <p>Initialize with an empty <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state⑦">logical state</a>.</p>
      </ol>
     <li data-md>
      <p>Return the <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table①①">table</a>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.5" id="algo-read"><span class="secno">8.5. </span><span class="content">Reading a table file</span><a class="self-link" href="#algo-read"></a></h3>
   <div class="algorithm" data-algorithm="read a table file">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="read-a-table-file">read a table file</dfn> at <var>path</var>:


    <ol>
     <li data-md>
      <p>If the file at <var>path</var> does not exist, return an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②">list</a> of operations and no header.</p>
     <li data-md>
      <p>Let <var>bytes</var> be the contents of the file at <var>path</var> as a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①">byte sequence</a>.</p>
     <li data-md>
      <p>Let <var>text</var> be <var>bytes</var> decoded as UTF-8. If decoding fails, return an error.</p>
     <li data-md>
      <p>If <var>text</var> begins with a BOM (U+FEFF), strip the BOM.</p>
     <li data-md>
      <p>Let <var>endsWithNewline</var> be true if <var>text</var> ends with a newline character (U+000A), false otherwise.</p>
     <li data-md>
      <p>Let <var>lines</var> be <var>text</var> split by newline characters (U+000A).</p>
     <li data-md>
      <p>Strip any trailing CR (U+000D) from each line.</p>
     <li data-md>
      <p>Let <var>header</var> be null.</p>
     <li data-md>
      <p>Let <var>operations</var> be an empty list.</p>
     <li data-md>
      <p>Let <var>index</var> be 0.</p>
     <li data-md>
      <p>For each <var>line</var> in <var>lines</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>line</var> is empty:</p>
        <ol>
         <li data-md>
          <p>If this is the last element and <var>endsWithNewline</var> is true, continue (this is the expected trailing empty string from splitting).</p>
         <li data-md>
          <p>Otherwise, skip this line and continue.</p>
        </ol>
       <li data-md>
        <p>If <var>line</var> consists only of whitespace characters, signal a <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error①⓪">parse error</a>. Skip this line and continue processing.</p>
       <li data-md>
        <p>Let <var>object</var> be the result of parsing <var>line</var> as JSON. The parser SHALL enforce the implementation’s maximum nesting depth; if the depth is exceeded, return a <a data-link-type="dfn" href="#limit-error" id="ref-for-limit-error③">limit error</a>.</p>
       <li data-md>
        <p>If parsing fails:</p>
        <ol>
         <li data-md>
          <p>If this is the last line and <var>endsWithNewline</var> is false, ignore this line and stop processing.</p>
         <li data-md>
          <p>Otherwise, return an error.</p>
        </ol>
       <li data-md>
        <p>If <var>object</var> is not a JSON object, return an error.</p>
       <li data-md>
        <p>If <var>object</var> contains duplicate keys, return an error.</p>
       <li data-md>
        <p>If <var>object</var> contains the field <code>$jsonlt</code>:</p>
        <ol>
         <li data-md>
          <p>If <var>index</var> is not 0, return a <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error①①">parse error</a> (header can only appear on first line).</p>
         <li data-md>
          <p>Validate the header structure. If invalid, return an error.</p>
         <li data-md>
          <p>Set <var>header</var> to the parsed header metadata.</p>
        </ol>
       <li data-md>
        <p>Otherwise:</p>
        <ol>
         <li data-md>
          <p>Validate that <var>object</var> is a valid <a data-link-type="dfn" href="#dfn-operation" id="ref-for-dfn-operation③">operation</a> (<a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record①⑤">record</a> or <a data-link-type="dfn" href="#dfn-tombstone" id="ref-for-dfn-tombstone④">tombstone</a>).</p>
         <li data-md>
          <p>If validation fails (for example, <code>$deleted</code> with non-boolean value), return an error.</p>
         <li data-md>
          <p>Append <var>object</var> to <var>operations</var>.</p>
        </ol>
       <li data-md>
        <p>Increment <var>index</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>header</var> and <var>operations</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.6" id="algo-transaction"><span class="secno">8.6. </span><span class="content">Transaction operations</span><a class="self-link" href="#algo-transaction"></a></h3>
   <div class="algorithm" data-algorithm="begin a transaction">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="begin-a-transaction">begin a transaction</dfn> on a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table①②">table</a>:


    <ol>
     <li data-md>
      <p>If a <a data-link-type="dfn" href="#dfn-transaction" id="ref-for-dfn-transaction⑨">transaction</a> is already active on this <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table①③">table</a> instance, return an error.</p>
     <li data-md>
      <p>If auto-reload is enabled, reload the file (acquiring a shared lock if the platform supports it, or briefly an exclusive lock otherwise, to ensure a consistent read).</p>
     <li data-md>
      <p>Let <var>snapshot</var> be a copy of the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state⑧">logical state</a>.</p>
     <li data-md>
      <p>Let <var>startState</var> be a copy of the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state⑨">logical state</a> (for conflict detection at commit).</p>
     <li data-md>
      <p>Let <var>buffer</var> be an empty list.</p>
     <li data-md>
      <p>Return a transaction context with <var>snapshot</var>, <var>startState</var>, and <var>buffer</var>.</p>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> See <a href="#concurrency">§ 10 Concurrency</a> for details on the optimistic concurrency model and locking behavior.</p>
   </div>
   <div class="algorithm" data-algorithm="perform a read operation within a transaction">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="perform-a-read-operation-within-a-transaction">perform a read operation within a transaction</dfn> (used by <a data-link-type="dfn" href="#get-a-record" id="ref-for-get-a-record①">get a record</a>, <a data-link-type="dfn" href="#check-for-a-record" id="ref-for-check-for-a-record①">check for a record</a>, <a data-link-type="dfn" href="#get-all-records" id="ref-for-get-all-records①">get all records</a>, <a data-link-type="dfn" href="#get-all-keys" id="ref-for-get-all-keys①">get all keys</a>, <a data-link-type="dfn" href="#count-records" id="ref-for-count-records①">count records</a>, <a data-link-type="dfn" href="#find-records" id="ref-for-find-records①">find records</a>, and <a data-link-type="dfn" href="#find-one-record" id="ref-for-find-one-record①">find one record</a>):


    <ol>
     <li data-md>
      <p>Use the transaction’s <a data-link-type="dfn" href="#dfn-snapshot" id="ref-for-dfn-snapshot③">snapshot</a> (as modified by writes within the transaction) instead of the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state①⓪">logical state</a>.</p>
     <li data-md>
      <p>Return the result based on the snapshot state.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="perform a write operation within a transaction">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="perform-a-write-operation-within-a-transaction">perform a write operation within a transaction</dfn> (used by <a data-link-type="dfn" href="#put-a-record" id="ref-for-put-a-record①">put a record</a> and <a data-link-type="dfn" href="#delete-a-record" id="ref-for-delete-a-record①">delete a record</a>):


    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="#extract-a-key" id="ref-for-extract-a-key②">Extract a key</a> from the record or construct the key for deletion.</p>
     <li data-md>
      <p>Validate the operation as normal (for example, check for <code>$</code>-prefixed fields in records).</p>
     <li data-md>
      <p>Append the operation to the transaction’s <a data-link-type="dfn" href="#dfn-buffer" id="ref-for-dfn-buffer③">buffer</a>.</p>
     <li data-md>
      <p>Update the transaction’s <a data-link-type="dfn" href="#dfn-snapshot" id="ref-for-dfn-snapshot④">snapshot</a> to reflect the write.</p>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> No file lock is acquired and no file modification occurs during this algorithm. File operations are deferred to the <a data-link-type="dfn" href="#commit-a-transaction" id="ref-for-commit-a-transaction①">commit a transaction</a> algorithm.</p>
   </div>
   <div class="algorithm" data-algorithm="commit a transaction">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="commit-a-transaction">commit a transaction</dfn>:


    <ol>
     <li data-md>
      <p>If the transaction’s <a data-link-type="dfn" href="#dfn-buffer" id="ref-for-dfn-buffer④">buffer</a> is empty, return successfully (no file modifications needed).</p>
     <li data-md>
      <p>Let <var>startState</var> be the transaction’s starting state (captured at transaction begin).</p>
     <li data-md>
      <p>Acquire the exclusive file lock.</p>
     <li data-md>
      <p>Reload the file to get the current state. If the file no longer exists, release the lock and return an error.</p>
     <li data-md>
      <p>For each key that was written in the transaction:</p>
      <ol>
       <li data-md>
        <p>If the current state for that key differs from <var>startState</var> for that key, release the lock and return a <a data-link-type="dfn" href="#conflict-error" id="ref-for-conflict-error③">conflict error</a>. Two states for a key differ if: (a) one contains a record for that key and the other does not, or (b) both contain records but the records are not logically equal (that is, they have different field values when compared as JSON objects).</p>
      </ol>
     <li data-md>
      <p>Try:</p>
      <ol>
       <li data-md>
        <p>Serialize all operations in the buffer.</p>
       <li data-md>
        <p>Append all serialized lines to the file as a single write.</p>
       <li data-md>
        <p>Sync the file to disk.</p>
      </ol>
     <li data-md>
      <p>On any failure in step 6, release the lock and return an error.</p>
     <li data-md>
      <p>Update the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state①①">logical state</a> from the buffer.</p>
      <p class="note" role="note"><span class="marker">Note:</span> The logical state update occurs before releasing the lock to ensure the in-memory state reflects the committed file contents while the lock is still held.</p>
     <li data-md>
      <p>Release the lock.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="abort a transaction">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="abort-a-transaction">abort a transaction</dfn>:


    <ol>
     <li data-md>
      <p>Discard the buffer.</p>
     <li data-md>
      <p>Discard the snapshot.</p>
     <li data-md>
      <p>No file lock is held, so none needs to be released.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="9" id="table-operations"><span class="secno">9. </span><span class="content">Table operations</span><a class="self-link" href="#table-operations"></a></h2>
   <h3 class="heading settled" data-level="9.1" id="algo-get"><span class="secno">9.1. </span><span class="content">Getting a record</span><a class="self-link" href="#algo-get"></a></h3>
   <div class="algorithm" data-algorithm="get a record">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-a-record">get a record</dfn> for <var>key</var> from a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table①④">table</a>:


    <ol>
     <li data-md>
      <p>Let <var>state</var> be the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state①②">logical state</a>.</p>
     <li data-md>
      <p>If <var>state</var> contains <var>key</var>, return <var>state</var>[<var>key</var>].</p>
     <li data-md>
      <p>Otherwise, return null.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="9.2" id="algo-has"><span class="secno">9.2. </span><span class="content">Checking for a record</span><a class="self-link" href="#algo-has"></a></h3>
   <div class="algorithm" data-algorithm="check for a record">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="check-for-a-record">check for a record</dfn> for <var>key</var> in a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table①⑤">table</a>:


    <ol>
     <li data-md>
      <p>Let <var>state</var> be the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state①③">logical state</a>.</p>
     <li data-md>
      <p>Return true if <var>state</var> contains <var>key</var>, false otherwise.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="9.3" id="algo-all"><span class="secno">9.3. </span><span class="content">Getting all records</span><a class="self-link" href="#algo-all"></a></h3>
   <div class="algorithm" data-algorithm="get all records">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-all-records">get all records</dfn> from a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table①⑥">table</a>:


    <ol>
     <li data-md>
      <p>Let <var>state</var> be the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state①④">logical state</a>.</p>
     <li data-md>
      <p>Let <var>keys</var> be all keys in <var>state</var>, sorted in ascending order.</p>
     <li data-md>
      <p>Let <var>result</var> be an empty list.</p>
     <li data-md>
      <p>For each <var>key</var> in <var>keys</var>:</p>
      <ol>
       <li data-md>
        <p>Append <var>state</var>[<var>key</var>] to <var>result</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>result</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="9.4" id="algo-keys"><span class="secno">9.4. </span><span class="content">Getting all keys</span><a class="self-link" href="#algo-keys"></a></h3>
   <div class="algorithm" data-algorithm="get all keys">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-all-keys">get all keys</dfn> from a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table①⑦">table</a>:


    <ol>
     <li data-md>
      <p>Let <var>state</var> be the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state①⑤">logical state</a>.</p>
     <li data-md>
      <p>Let <var>keys</var> be all keys in <var>state</var>, sorted in ascending order.</p>
     <li data-md>
      <p>Return <var>keys</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="9.5" id="algo-count"><span class="secno">9.5. </span><span class="content">Counting records</span><a class="self-link" href="#algo-count"></a></h3>
   <div class="algorithm" data-algorithm="count records">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="count-records">count records</dfn> in a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table①⑧">table</a>:


    <ol>
     <li data-md>
      <p>Let <var>state</var> be the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state①⑥">logical state</a>.</p>
     <li data-md>
      <p>Return the number of records in <var>state</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="9.6" id="algo-find"><span class="secno">9.6. </span><span class="content">Finding records</span><a class="self-link" href="#algo-find"></a></h3>
   <div class="algorithm" data-algorithm="find records">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="find-records">find records</dfn> matching <var>predicate</var> in a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table①⑨">table</a>:


    <ol>
     <li data-md>
      <p>Let <var>state</var> be the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state①⑦">logical state</a>.</p>
     <li data-md>
      <p>Let <var>keys</var> be all keys in <var>state</var>, sorted in ascending order.</p>
     <li data-md>
      <p>Let <var>results</var> be an empty list.</p>
     <li data-md>
      <p>For each <var>key</var> in <var>keys</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>record</var> be <var>state</var>[<var>key</var>].</p>
       <li data-md>
        <p>If <var>predicate</var>(<var>record</var>) is true, append <var>record</var> to <var>results</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>results</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="9.7" id="algo-find-one"><span class="secno">9.7. </span><span class="content">Finding one record</span><a class="self-link" href="#algo-find-one"></a></h3>
   <div class="algorithm" data-algorithm="find one record">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="find-one-record">find one record</dfn> matching <var>predicate</var> in a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table②⓪">table</a>:


    <ol>
     <li data-md>
      <p>Let <var>state</var> be the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state①⑧">logical state</a>.</p>
     <li data-md>
      <p>Let <var>keys</var> be all keys in <var>state</var>, sorted in ascending order.</p>
     <li data-md>
      <p>For each <var>key</var> in <var>keys</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>record</var> be <var>state</var>[<var>key</var>].</p>
       <li data-md>
        <p>If <var>predicate</var>(<var>record</var>) is true, return <var>record</var>.</p>
      </ol>
     <li data-md>
      <p>Return null.</p>
    </ol>
   </div>
   <p>If the <var>predicate</var> function throws an exception during <a data-link-type="dfn" href="#find-records" id="ref-for-find-records②">find records</a> or <a data-link-type="dfn" href="#find-one-record" id="ref-for-find-one-record②">find one record</a>, the implementation SHALL propagate the exception to the caller without returning partial results. Within a <a data-link-type="dfn" href="#dfn-transaction" id="ref-for-dfn-transaction①⓪">transaction</a>, a predicate exception does not affect the transaction’s state; the transaction remains usable after the exception is handled.</p>
   <h3 class="heading settled" data-level="9.8" id="algo-put"><span class="secno">9.8. </span><span class="content">Putting a record</span><a class="self-link" href="#algo-put"></a></h3>
   <div class="algorithm" data-algorithm="put a record">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="put-a-record">put a record</dfn> <var>record</var> into a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table②①">table</a>:


    <ol>
     <li data-md>
      <p>Let <var>key</var> be the result of <a data-link-type="dfn" href="#extract-a-key" id="ref-for-extract-a-key③">extracting a key</a> from <var>record</var> using the table’s <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier②②">key specifier</a>.</p>
     <li data-md>
      <p>If extraction fails, return an error.</p>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#key-length" id="ref-for-key-length②">key length</a> of <var>key</var> exceeds the implementation’s maximum, return a <a data-link-type="dfn" href="#limit-error" id="ref-for-limit-error④">limit error</a>.</p>
     <li data-md>
      <p>If <var>record</var> contains any field whose name begins with <code>$</code>, return an error.</p>
     <li data-md>
      <p>Serialize <var>record</var> to a JSON line using <a data-link-type="dfn" href="#dfn-deterministic-serialization" id="ref-for-dfn-deterministic-serialization①">deterministic serialization</a>.</p>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#record-size" id="ref-for-record-size②">record size</a> exceeds the implementation’s maximum, return a <a data-link-type="dfn" href="#limit-error" id="ref-for-limit-error⑤">limit error</a>.</p>
     <li data-md>
      <p>Acquire the exclusive file lock.</p>
     <li data-md>
      <p>If auto-reload is enabled and the file has been modified since last load, reload the file.</p>
     <li data-md>
      <p>Append the line (followed by newline) to the table’s file.</p>
     <li data-md>
      <p>Update the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state①⑨">logical state</a>: set state[<var>key</var>] to <var>record</var>.</p>
     <li data-md>
      <p>Release the lock.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="9.9" id="algo-delete"><span class="secno">9.9. </span><span class="content">Deleting a record</span><a class="self-link" href="#algo-delete"></a></h3>
   <div class="algorithm" data-algorithm="delete a record">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="delete-a-record">delete a record</dfn> for <var>key</var> from a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table②②">table</a>:


    <ol>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier②③">key specifier</a> is a <a data-link-type="dfn" href="#tuple" id="ref-for-tuple①④">tuple</a> with more than one element:</p>
      <ol>
       <li data-md>
        <p>If <var>key</var> is not a <a data-link-type="dfn" href="#tuple" id="ref-for-tuple①⑤">tuple</a> with the same number of elements as the <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier②④">key specifier</a>, return an error.</p>
      </ol>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier②⑤">key specifier</a> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑧">string</a> or a single-element <a data-link-type="dfn" href="#tuple" id="ref-for-tuple①⑥">tuple</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>key</var> is a <a data-link-type="dfn" href="#tuple" id="ref-for-tuple①⑦">tuple</a>, return an error.</p>
      </ol>
     <li data-md>
      <p>Let <var>existed</var> be true if the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state②⓪">logical state</a> contains <var>key</var>, false otherwise.</p>
     <li data-md>
      <p>Let <var>tombstone</var> be a new object.</p>
     <li data-md>
      <p>Set <var>tombstone</var>["$deleted"] to true.</p>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier②⑥">key specifier</a> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑨">string</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>field</var> be the <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier②⑦">key specifier</a>.</p>
       <li data-md>
        <p>Set <var>tombstone</var>[<var>field</var>] to <var>key</var>.</p>
      </ol>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier②⑧">key specifier</a> is a <a data-link-type="dfn" href="#tuple" id="ref-for-tuple①⑧">tuple</a> with exactly one element:</p>
      <ol>
       <li data-md>
        <p>Let <var>field</var> be the single element of the <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier②⑨">key specifier</a>.</p>
       <li data-md>
        <p>Set <var>tombstone</var>[<var>field</var>] to <var>key</var>.</p>
      </ol>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier③⓪">key specifier</a> is a <a data-link-type="dfn" href="#tuple" id="ref-for-tuple①⑨">tuple</a> with more than one element:</p>
      <ol>
       <li data-md>
        <p>For each <var>field</var> in the <a data-link-type="dfn" href="#dfn-key-specifier" id="ref-for-dfn-key-specifier③①">key specifier</a> and corresponding <var>value</var> in <var>key</var>:</p>
        <ol>
         <li data-md>
          <p>Set <var>tombstone</var>[<var>field</var>] to <var>value</var>.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Acquire the exclusive file lock.</p>
     <li data-md>
      <p>If auto-reload is enabled and the file has been modified since last load, reload the file.</p>
     <li data-md>
      <p>Serialize <var>tombstone</var> to a JSON line using <a data-link-type="dfn" href="#dfn-deterministic-serialization" id="ref-for-dfn-deterministic-serialization②">deterministic serialization</a>.</p>
     <li data-md>
      <p>Append the line (followed by newline) to the table’s file.</p>
     <li data-md>
      <p>Update the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state②①">logical state</a>: remove <var>key</var> from state.</p>
     <li data-md>
      <p>Release the lock.</p>
     <li data-md>
      <p>Return <var>existed</var>.</p>
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> The <var>existed</var> return value is informational and reflects the table’s state at the time the delete operation began, not at the time the tombstone was written. In concurrent scenarios with auto-reload enabled, the record could have been created or deleted by another process between the existence check and the file modification. Applications requiring an authoritative answer about whether a record was actually deleted can use a transaction, which provides snapshot isolation.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Deleting a non-existent key is valid and writes a tombstone to the file. This idempotent design allows delete operations to be safely replayed (for example, during synchronization or recovery) without requiring the caller to first check whether the key exists. The tombstone has no effect on the <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state②②">logical state</a> if the key was already absent.</p>
   <h3 class="heading settled" data-level="9.10" id="algo-clear"><span class="secno">9.10. </span><span class="content">Clearing all records</span><a class="self-link" href="#algo-clear"></a></h3>
   <div class="algorithm" data-algorithm="clear all records">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="clear-all-records">clear all records</dfn> from a <a data-link-type="dfn" href="#dfn-table" id="ref-for-dfn-table②③">table</a>:


    <ol>
     <li data-md>
      <p>Acquire the exclusive file lock.</p>
     <li data-md>
      <p>Let <var>lines</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list③">list</a>.</p>
     <li data-md>
      <p>If the table has a <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header①③">header</a>:</p>
      <ol>
       <li data-md>
        <p>Serialize the header to a JSON line.</p>
       <li data-md>
        <p>Append the header line to <var>lines</var>.</p>
      </ol>
     <li data-md>
      <p>Write <var>lines</var> to a temporary file in the same directory, with each line followed by a newline (or write an empty file if no header).</p>
     <li data-md>
      <p>Sync the temporary file to disk (fsync or equivalent).</p>
     <li data-md>
      <p>Atomically rename the temporary file to replace the table’s file.</p>
     <li data-md>
      <p>Set the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state②③">logical state</a> to an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">map</a>.</p>
     <li data-md>
      <p>Release the lock.</p>
    </ol>
   </div>
   <p>This produces an empty file (or a file containing only the <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header①④">header</a>).</p>
   <h3 class="heading settled" data-level="9.11" id="algo-compact"><span class="secno">9.11. </span><span class="content">Compacting a table</span><a class="self-link" href="#algo-compact"></a></h3>
   <div class="algorithm" data-algorithm="compact a table">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="compact-a-table">compact a table</dfn>:


    <ol>
     <li data-md>
      <p>Acquire the exclusive file lock.</p>
     <li data-md>
      <p>Reload the file to ensure the <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state②④">logical state</a> reflects any writes that occurred before the lock was acquired.</p>
     <li data-md>
      <p>Let <var>state</var> be the table’s <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state②⑤">logical state</a>.</p>
     <li data-md>
      <p>Let <var>keys</var> be all keys in <var>state</var>, sorted in ascending order.</p>
     <li data-md>
      <p>Let <var>lines</var> be an empty list.</p>
     <li data-md>
      <p>If the table has a <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header①⑤">header</a>:</p>
      <ol>
       <li data-md>
        <p>Serialize the header to a JSON line.</p>
       <li data-md>
        <p>Append the header line to <var>lines</var>.</p>
      </ol>
     <li data-md>
      <p>For each <var>key</var> in <var>keys</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>record</var> be <var>state</var>[<var>key</var>].</p>
       <li data-md>
        <p>Serialize <var>record</var> to a JSON line using <a data-link-type="dfn" href="#dfn-deterministic-serialization" id="ref-for-dfn-deterministic-serialization③">deterministic serialization</a>.</p>
       <li data-md>
        <p>Append the line to <var>lines</var>.</p>
      </ol>
     <li data-md>
      <p>Write <var>lines</var> to a temporary file in the same directory, with each line followed by a newline.</p>
     <li data-md>
      <p>Sync the temporary file to disk (fsync or equivalent).</p>
     <li data-md>
      <p>Atomically rename the temporary file to replace the table’s file.</p>
     <li data-md>
      <p>Release the lock.</p>
    </ol>
   </div>
   <p>Compaction produces a file with one line per live record (plus optional header), sorted by key, with no tombstones or historical operations.</p>
   <p class="note" role="note"><span class="marker">Note:</span> When multiple processes attempt concurrent compaction, file locking serializes the operations. The second process will reload after acquiring the lock and can find the file already compacted; implementations can detect this by comparing file size or line count before and after reload, and skip redundant compaction.</p>
   <div class="example" id="example-8079b1c9">
    <a class="self-link" href="#example-8079b1c9"></a>
Before compaction, a file might contain the full operation history with non-alphabetical key ordering in records:


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- u>"id"</c-><c- p>}}</c->
<c- p>{</c-><c- f>"role"</c-><c- p>:</c-> <c- u>"user"</c-><c- p>,</c-> <c- f>"id"</c-><c- p>:</c-> <c- u>"alice"</c-><c- p>,</c-> <c- f>"team"</c-><c- p>:</c-> <c- u>"eng"</c-><c- p>}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- u>"bob"</c-><c- p>,</c-> <c- f>"role"</c-><c- p>:</c-> <c- u>"user"</c-><c- p>}</c->
<c- p>{</c-><c- f>"role"</c-><c- p>:</c-> <c- u>"admin"</c-><c- p>,</c-> <c- f>"id"</c-><c- p>:</c-> <c- u>"alice"</c-><c- p>,</c-> <c- f>"team"</c-><c- p>:</c-> <c- u>"eng"</c-><c- p>}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- u>"charlie"</c-><c- p>,</c-> <c- f>"role"</c-><c- p>:</c-> <c- u>"user"</c-><c- p>}</c->
<c- p>{</c-><c- f>"$deleted"</c-><c- p>:</c-> <c- kc>true</c-><c- p>,</c-> <c- f>"id"</c-><c- p>:</c-> <c- u>"bob"</c-><c- p>}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- u>"charlie"</c-><c- p>,</c-> <c- f>"role"</c-><c- p>:</c-> <c- u>"moderator"</c-><c- p>}</c->
</pre>
    <p>After compaction, the file contains only the current state, sorted by key, with <a data-link-type="dfn" href="#dfn-deterministic-serialization" id="ref-for-dfn-deterministic-serialization④">deterministic serialization</a> applied (keys sorted alphabetically):</p>
<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- u>"id"</c-><c- p>}}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- u>"alice"</c-><c- p>,</c-> <c- f>"role"</c-><c- p>:</c-> <c- u>"admin"</c-><c- p>,</c-> <c- f>"team"</c-><c- p>:</c-> <c- u>"eng"</c-><c- p>}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- u>"charlie"</c-><c- p>,</c-> <c- f>"role"</c-><c- p>:</c-> <c- u>"moderator"</c-><c- p>}</c->
</pre>
    <p>The historical operations (alice’s initial role, bob’s record, charlie’s initial role) and the tombstone for bob are removed. Note how alice’s record now has fields in alphabetical order (<code>id</code>, <code>role</code>, <code>team</code>).</p>
   </div>
   <p>On systems where atomic rename is not available or fails (for example, renaming across filesystems), a <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator③⑥">conforming generator</a> SHALL use an alternative strategy that preserves atomicity, such as writing to a new file and updating a pointer, or SHALL report an error.</p>
   <h2 class="heading settled" data-level="10" id="concurrency"><span class="secno">10. </span><span class="content">Concurrency</span><a class="self-link" href="#concurrency"></a></h2>
   <h3 class="heading settled" data-level="10.1" id="file-locking"><span class="secno">10.1. </span><span class="content">File locking</span><a class="self-link" href="#file-locking"></a></h3>
   <p>When multiple processes access the same table file, concurrent write operations SHALL NOT corrupt the file or produce malformed output. A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator③⑦">conforming generator</a> SHALL ensure that each write operation produces a complete, valid line followed by a newline character, even when other processes are simultaneously reading or writing the same file.</p>
   <p>To achieve this, implementations SHOULD use advisory file locking to coordinate access. The specific mechanism is implementation-defined (for example, fcntl, flock, or platform-specific APIs). Write operations SHOULD acquire an exclusive lock before modifying the file and hold it until the write completes and the file is synced. Read operations that may trigger a reload SHOULD acquire a shared lock if the platform supports them, or briefly acquire an exclusive lock, to avoid reading a partially-written line.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The testable outcome is file integrity under concurrent access. The specific locking mechanism is implementation guidance; implementations MAY use alternative coordination mechanisms that achieve the same outcome.</p>
   <p>Transactions use optimistic concurrency: no lock is held during the transaction, but the exclusive lock is acquired at commit time to perform conflict detection and write the buffered operations atomically.</p>
   <h3 class="heading settled" data-level="10.2" id="auto-reload"><span class="secno">10.2. </span><span class="content">Auto-reload behavior</span><a class="self-link" href="#auto-reload"></a></h3>
   <p>When auto-reload is enabled, a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser④⑦">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator③⑧">conforming generator</a> SHALL check the file’s modification time (mtime) before read operations return data. If the mtime has changed since the last load, the implementation SHALL reload the file from disk before answering the read.</p>
   <p>Inside a <a data-link-type="dfn" href="#dfn-transaction" id="ref-for-dfn-transaction①①">transaction</a>, auto-reload occurs only at transaction start. Subsequent reads within the transaction see the snapshot state.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The mtime check adds one stat system call per read operation.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Some filesystems have coarse mtime resolution (for example, HFS+ has 1-second granularity). Implementations SHOULD additionally compare file size to detect changes that occur within the same mtime window. Applications requiring stronger consistency guarantees SHOULD use explicit reload calls or transactions rather than relying on auto-reload.</p>
   <h2 class="heading settled" data-level="11" id="size-complexity"><span class="secno">11. </span><span class="content">Size and complexity</span><a class="self-link" href="#size-complexity"></a></h2>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="key-length">key length</dfn> of a <a data-link-type="dfn" href="#dfn-key" id="ref-for-dfn-key①⑤">key</a> is the number of bytes in its JSON representation when encoded as UTF-8:</p>
   <ul>
    <li data-md>
     <p>For a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①⓪">string</a> key: the byte length of the JSON string including quotes and escape sequences (for example, <code>"alice"</code> is 7 bytes)</p>
    <li data-md>
     <p>For an <a data-link-type="dfn" href="#integer" id="ref-for-integer⑥">integer</a> key: the byte length of its JSON decimal representation (for example, <code>12345</code> is 5 bytes)</p>
    <li data-md>
     <p>For a <a data-link-type="dfn" href="#tuple" id="ref-for-tuple②⓪">tuple</a> key: the byte length of the complete JSON array representation (for example, <code>["a",1]</code> is 7 bytes)</p>
   </ul>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="record-size">record size</dfn> of a <a data-link-type="dfn" href="#dfn-record" id="ref-for-dfn-record①⑥">record</a> is the number of bytes in its JSON serialization using <a data-link-type="dfn" href="#dfn-deterministic-serialization" id="ref-for-dfn-deterministic-serialization⑤">deterministic serialization</a>, encoded as UTF-8.</p>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser④⑧">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator③⑨">conforming generator</a> SHALL support at minimum:</p>
   <ul>
    <li data-md>
     <p><a data-link-type="dfn" href="#key-length" id="ref-for-key-length③">Key length</a>: 1024 bytes</p>
    <li data-md>
     <p><a data-link-type="dfn" href="#record-size" id="ref-for-record-size③">Record size</a>: 1,048,576 bytes (1 MiB)</p>
    <li data-md>
     <p>JSON nesting depth: 64 levels</p>
    <li data-md>
     <p><a data-link-type="dfn" href="#tuple" id="ref-for-tuple②①">Tuple</a> elements: 16 (for compound keys)</p>
   </ul>
   <p>Implementations MAY support larger limits and SHOULD document their actual limits. Supporting larger values does not affect conformance status.</p>
   <p class="note" role="note"><span class="marker">Note:</span> These limits balance practical needs with platform feasibility. The 1024-byte key limit aligns with common database index key limits. The 1 MiB record size accommodates most practical use cases while preventing memory exhaustion. The 64-level nesting depth exceeds typical JSON usage patterns while remaining within the capabilities of most JSON parsers (some have lower defaults, such as Ruby’s default of 19). The 16-element tuple limit aligns with database compound key practices (SQL Server: 16, PostgreSQL: 32).</p>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser④⑨">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator④⓪">conforming generator</a> SHALL signal a <a data-link-type="dfn" href="#limit-error" id="ref-for-limit-error⑥">limit error</a> when a documented limit is exceeded. Implementations SHALL NOT silently truncate, corrupt, or discard data that exceeds limits.</p>
   <div class="example" id="example-74112c39">
    <a class="self-link" href="#example-74112c39"></a>
Key length calculation for a string key:


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- u>"id"</c-><c- p>}}</c->
<c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- u>"user_12345_account_settings_preferences"</c-><c- p>,</c-> <c- f>"data"</c-><c- p>:</c-> <c- u>"example"</c-><c- p>}</c->
</pre>
    <p>The key <code>"user_12345_account_settings_preferences"</code> has a <a data-link-type="dfn" href="#key-length" id="ref-for-key-length④">key length</a> of 41 bytes (39 characters + 2 quote bytes). The 1024-byte limit supports keys up to approximately 1022 characters (for ASCII strings without escape sequences).</p>
   </div>
   <div class="example" id="example-9b76ddd4">
    <a class="self-link" href="#example-9b76ddd4"></a>
Tuple key at the 16-element limit:


<pre class="highlight language-json"><c- p>{</c-><c- f>"$jsonlt"</c-><c- p>:</c-> <c- p>{</c-><c- f>"version"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-> <c- f>"key"</c-><c- p>:</c-> <c- p>[</c-><c- u>"a"</c-><c- p>,</c-><c- u>"b"</c-><c- p>,</c-><c- u>"c"</c-><c- p>,</c-><c- u>"d"</c-><c- p>,</c-><c- u>"e"</c-><c- p>,</c-><c- u>"f"</c-><c- p>,</c-><c- u>"g"</c-><c- p>,</c-><c- u>"h"</c-><c- p>,</c-><c- u>"i"</c-><c- p>,</c-><c- u>"j"</c-><c- p>,</c-><c- u>"k"</c-><c- p>,</c-><c- u>"l"</c-><c- p>,</c-><c- u>"m"</c-><c- p>,</c-><c- u>"n"</c-><c- p>,</c-><c- u>"o"</c-><c- p>,</c-><c- u>"p"</c-><c- p>]}}</c->
<c- p>{</c-><c- f>"a"</c-><c- p>:</c-><c- mi>1</c-><c- p>,</c-><c- f>"b"</c-><c- p>:</c-><c- mi>2</c-><c- p>,</c-><c- f>"c"</c-><c- p>:</c-><c- mi>3</c-><c- p>,</c-><c- f>"d"</c-><c- p>:</c-><c- mi>4</c-><c- p>,</c-><c- f>"e"</c-><c- p>:</c-><c- mi>5</c-><c- p>,</c-><c- f>"f"</c-><c- p>:</c-><c- mi>6</c-><c- p>,</c-><c- f>"g"</c-><c- p>:</c-><c- mi>7</c-><c- p>,</c-><c- f>"h"</c-><c- p>:</c-><c- mi>8</c-><c- p>,</c-><c- f>"i"</c-><c- p>:</c-><c- mi>9</c-><c- p>,</c-><c- f>"j"</c-><c- p>:</c-><c- mi>10</c-><c- p>,</c-><c- f>"k"</c-><c- p>:</c-><c- mi>11</c-><c- p>,</c-><c- f>"l"</c-><c- p>:</c-><c- mi>12</c-><c- p>,</c-><c- f>"m"</c-><c- p>:</c-><c- mi>13</c-><c- p>,</c-><c- f>"n"</c-><c- p>:</c-><c- mi>14</c-><c- p>,</c-><c- f>"o"</c-><c- p>:</c-><c- mi>15</c-><c- p>,</c-><c- f>"p"</c-><c- p>:</c-><c- mi>16</c-><c- p>,</c-><c- f>"data"</c-><c- p>:</c-><c- u>"x"</c-><c- p>}</c->
</pre>
    <p>This 16-element tuple key is at the maximum allowed limit. A 17th element would cause a <a data-link-type="dfn" href="#limit-error" id="ref-for-limit-error⑦">limit error</a>.</p>
   </div>
   <div class="example" id="example-62edd115">
    <a class="self-link" href="#example-62edd115"></a>
JSON nesting depth (counting levels):


<pre class="highlight language-json"><c- p>{</c-><c- f>"id"</c-><c- p>:</c-> <c- u>"x"</c-><c- p>,</c-> <c- f>"level1"</c-><c- p>:</c-> <c- p>{</c-><c- f>"level2"</c-><c- p>:</c-> <c- p>{</c-><c- f>"level3"</c-><c- p>:</c-> <c- p>{</c-><c- f>"value"</c-><c- p>:</c-> <c- mi>1</c-><c- p>}}}}</c->
</pre>
    <p>The nesting depth is 4 levels: the root object (1), <code>level1</code> object (2), <code>level2</code> object (3), and <code>level3</code> object (4). The 64-level limit allows substantial nesting while preventing stack overflow from deeply recursive structures.</p>
   </div>
   <p>The following are not normatively constrained:</p>
   <ul>
    <li data-md>
     <p>Maximum file size: Limited by available storage and memory</p>
    <li data-md>
     <p>Maximum records: Limited by available memory for the <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state②⑥">logical state</a></p>
   </ul>
   <p><em>The following complexity characteristics are informative guidance for typical implementations:</em></p>
   <ul>
    <li data-md>
     <p><code>get</code>, <code>has</code>: O(1) average with hash-based <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state②⑦">logical state</a></p>
    <li data-md>
     <p><code>put</code>, <code>delete</code>: O(1) for state update, O(n) for file append where n is record size</p>
    <li data-md>
     <p><code>all</code>, <code>keys</code>: O(n) where n is record count</p>
    <li data-md>
     <p><code>find</code>: O(n) where n is record count</p>
    <li data-md>
     <p><code>compact</code>: O(n log n) due to sorting</p>
   </ul>
   <h2 class="heading settled" data-level="12" id="security"><span class="secno">12. </span><span class="content">Security considerations</span><a class="self-link" href="#security"></a></h2>
   <p>JSONLT files are plain text and offer no encryption or access control beyond filesystem permissions. Applications storing sensitive data SHOULD implement encryption, access controls, or other protections at the application or filesystem level.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The following guidance helps protect against resource exhaustion when processing untrusted input:</p>
   <ul>
    <li data-md>
     <p>Limit maximum line length (for example, to the implementation’s documented record size limit from <a href="#size-complexity">§ 11 Size and complexity</a>) to prevent memory exhaustion from maliciously large records.</p>
    <li data-md>
     <p>Limit nesting depth when parsing JSON (for example, to the documented maximum depth) to prevent stack overflow.</p>
    <li data-md>
     <p>Impose limits on total file size and record count.</p>
    <li data-md>
     <p>Rate-limit or size-limit append operations in multi-user environments.</p>
   </ul>
   <p>Path traversal: A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser⑤⓪">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator④①">conforming generator</a> SHOULD sanitize or validate file paths to prevent directory traversal attacks.</p>
   <p>Symbolic links: When the table path is a symbolic link, a <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator④②">conforming generator</a> performing compaction SHOULD either follow the link (writing the compacted file to the link target) or reject the operation with an error. Compaction SHOULD NOT replace a symbolic link with a regular file. Implementations SHOULD document their symbolic link handling.</p>
   <h2 class="heading settled" data-level="13" id="privacy"><span class="secno">13. </span><span class="content">Privacy considerations</span><a class="self-link" href="#privacy"></a></h2>
   <p>This specification defines a data format with no inherent privacy implications. Applications using this format are responsible for handling any sensitive data they choose to encode in accordance with applicable privacy requirements.</p>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser⑤①">conforming parser</a> or <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator④③">conforming generator</a> SHOULD NOT log or expose record contents in error messages or debugging output unless explicitly configured to do so.</p>
   <h2 class="heading settled" data-level="14" id="i18n"><span class="secno">14. </span><span class="content">Internationalization considerations</span><a class="self-link" href="#i18n"></a></h2>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator④④">conforming generator</a> SHALL encode JSONLT files as UTF-8, supporting the full Unicode character set.</p>
   <p>Key comparison is based on Unicode code points without normalization. Applications requiring normalization-insensitive key matching SHOULD normalize keys to NFC before storage.</p>
   <p>String values may contain any valid Unicode content, escaped according to <a data-link-type="biblio" href="#biblio-rfc8259" title="The JavaScript Object Notation (JSON) Data Interchange Format">[RFC8259]</a> string escaping rules.</p>
   <h2 class="heading settled" data-level="15" id="a11y"><span class="secno">15. </span><span class="content">Accessibility considerations</span><a class="self-link" href="#a11y"></a></h2>
   <p>This specification defines a data format with no direct user interface implications. Applications presenting data in this format are responsible for accessible rendering.</p>
   <h2 class="heading settled" data-level="16" id="extensions"><span class="secno">16. </span><span class="content">Extension mechanism</span><a class="self-link" href="#extensions"></a></h2>
   <p>Field names beginning with <code>$</code> are reserved for this specification and future extensions. A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator④⑤">conforming generator</a> SHALL reject records containing field names beginning with <code>$</code>.</p>
   <p>Future versions of this specification MAY define additional <code>$</code>-prefixed fields in records (beyond the currently-defined <code>$deleted</code>). For forward compatibility, a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser⑤②">conforming parser</a> SHOULD preserve unrecognized <code>$</code>-prefixed fields when reading files, rather than stripping them. This allows files written by newer implementations to be read (and re-written during compaction) by older implementations without data loss. If an unrecognized <code>$</code>-prefixed field conflicts with this specification’s semantics (for example, an unknown field in a <a data-link-type="dfn" href="#dfn-tombstone" id="ref-for-dfn-tombstone⑤">tombstone</a>), a <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser⑤③">conforming parser</a> MAY reject the file.</p>
   <p>The <a data-link-type="dfn" href="#dfn-header" id="ref-for-dfn-header①⑥">header</a>’s <code>meta</code> field provides a space for application-defined metadata that does not conflict with the specification.</p>
   <h2 class="heading settled" data-level="17" id="appendix-implementation"><span class="secno">17. </span><span class="content">Implementation mapping</span><a class="self-link" href="#appendix-implementation"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>This appendix provides guidance on mapping the abstract types and constructs defined in this specification to concrete implementations in various programming languages. The notation and type system are designed to be language-agnostic; implementations can adapt them to idiomatic constructs in their target language.</p>
   <h3 class="heading settled" data-level="17.1" id="impl-basic-types"><span class="secno">17.1. </span><span class="content">Basic types</span><a class="self-link" href="#impl-basic-types"></a></h3>
   <p><strong>Integer</strong>: Map to the platform’s standard integer type. Implementations need to support the full range of JSON-safe integers (−(2<sup>53</sup>)+1 to (2<sup>53</sup>)−1, that is, ±9,007,199,254,740,991). Larger integer types are acceptable; smaller types that cannot represent this range are not conforming.</p>
   <p><strong>String</strong>: Map to the platform’s standard UTF-8 string type. All string comparisons are based on Unicode code points.</p>
   <p><strong>Boolean</strong>: Map to the platform’s standard boolean type (<code>true</code>/<code>false</code>, <code>True</code>/<code>False</code>, etc.).</p>
   <h3 class="heading settled" data-level="17.2" id="impl-compound-types"><span class="secno">17.2. </span><span class="content">Compound types</span><a class="self-link" href="#impl-compound-types"></a></h3>
   <p><strong>List&lt;T></strong>: Map to the platform’s standard ordered sequence type (array, list, vector, slice, etc.). The element type T is mapped according to these same rules.</p>
   <p><strong>Tuple</strong>: Map to the platform’s tuple type if available. Languages without native tuples can use arrays or custom structures. A tuple of (String, Integer) represents a compound key with two elements.</p>
   <p><strong>Map</strong>: The <a data-link-type="dfn" href="#dfn-logical-state" id="ref-for-dfn-logical-state②⑧">logical state</a> is a map from keys to records. Map to the platform’s standard associative container (dictionary, hash map, object, etc.). Implementations can use ordered maps if key ordering is important for iteration.</p>
   <h3 class="heading settled" data-level="17.3" id="impl-null"><span class="secno">17.3. </span><span class="content">Null and optional values</span><a class="self-link" href="#impl-null"></a></h3>
   <p><strong>T | Null</strong>: Represents a value that may be absent. Map to the platform’s standard optional or nullable type:</p>
   <ul>
    <li data-md>
     <p>Languages with null: Use <code>null</code>, <code>nil</code>, or <code>None</code></p>
    <li data-md>
     <p>Languages with option types: Use <code>Option&lt;T></code>, <code>Maybe T</code>, or equivalent</p>
    <li data-md>
     <p>Languages with result types: can use result types for operations that can fail</p>
   </ul>
   <h3 class="heading settled" data-level="17.4" id="impl-predicates"><span class="secno">17.4. </span><span class="content">Predicates</span><a class="self-link" href="#impl-predicates"></a></h3>
   <p>The <code>find</code> and <code>findOne</code> operations accept a predicate function. Map to the platform’s standard callable type:</p>
   <ul>
    <li data-md>
     <p>First-class functions or closures</p>
    <li data-md>
     <p>Lambda expressions</p>
    <li data-md>
     <p>Callable objects or interfaces</p>
   </ul>
   <p>The predicate receives a Record and returns a Boolean indicating whether the record matches.</p>
   <h3 class="heading settled" data-level="17.5" id="impl-thread-safety"><span class="secno">17.5. </span><span class="content">Thread safety</span><a class="self-link" href="#impl-thread-safety"></a></h3>
   <p>Thread safety for concurrent access within a single process is an implementation concern and is not specified normatively. Implementations SHOULD document their thread safety properties and MAY provide options for enabling or disabling internal locking. Implementations MAY use synchronization mechanisms such as mutex locks, read-write locks, or atomic operations based on the target platform’s threading model.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This specification addresses inter-process concurrency through file locking (<a href="#file-locking">§ 10.1 File locking</a>) because file integrity is an interoperability concern—two processes need to coordinate to avoid corrupting shared files. Intra-process thread safety, by contrast, is an internal implementation detail that does not affect file format interoperability.</p>
   <h2 class="heading settled" data-level="18" id="appendix-profile-requirements"><span class="secno">18. </span><span class="content">Profile requirement summary</span><a class="self-link" href="#appendix-profile-requirements"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>This appendix provides a summary of normative requirements by conformance profile for quick reference. Requirements are identified by the section containing them.</p>
   <h3 class="heading settled" data-level="18.1" id="profile-parser"><span class="secno">18.1. </span><span class="content">Parser requirements</span><a class="self-link" href="#profile-parser"></a></h3>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser⑤④">conforming parser</a> SHALL:</p>
   <ul>
    <li data-md>
     <p>Treat invalid key values as errors (<a href="#key">§ 4.1 Key</a>)</p>
    <li data-md>
     <p>Treat invalid <code>$deleted</code> values as <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error①②">parse errors</a> (<a href="#tombstone">§ 4.4 Tombstone</a>)</p>
    <li data-md>
     <p>Reject files with unsupported version numbers (<a href="#header">§ 4.6 Header</a>)</p>
    <li data-md>
     <p>Treat duplicate <code>$schema</code> and <code>schema</code> as <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error①③">parse errors</a> (<a href="#header">§ 4.6 Header</a>)</p>
    <li data-md>
     <p>Treat files without headers as version 1 (<a href="#header">§ 4.6 Header</a>)</p>
    <li data-md>
     <p>Treat whitespace-only lines as <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error①④">parse errors</a> (<a href="#line-structure">§ 5.3 Line structure</a>)</p>
    <li data-md>
     <p>Treat duplicate JSON keys as <a data-link-type="dfn" href="#parse-error" id="ref-for-parse-error①⑤">parse errors</a> (<a href="#line-structure">§ 5.3 Line structure</a>)</p>
    <li data-md>
     <p>Implement file locking for concurrent access (<a href="#file-locking">§ 10.1 File locking</a>)</p>
   </ul>
   <p>A <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser⑤⑤">conforming parser</a> SHOULD:</p>
   <ul>
    <li data-md>
     <p>Preserve unrecognized <code>$</code>-prefixed fields for forward compatibility (<a href="#conformance-parser">§ 3.1 Parser</a>)</p>
    <li data-md>
     <p>Preserve unknown header fields for forward compatibility (<a href="#header">§ 4.6 Header</a>)</p>
    <li data-md>
     <p>Strip BOMs encountered (<a href="#encoding">§ 5.1 Encoding</a>)</p>
    <li data-md>
     <p>Strip CR characters preceding LF (<a href="#line-structure">§ 5.3 Line structure</a>)</p>
    <li data-md>
     <p>Skip empty lines (<a href="#line-structure">§ 5.3 Line structure</a>)</p>
    <li data-md>
     <p>Accept files not ending with newline if final line is valid JSON (<a href="#line-structure">§ 5.3 Line structure</a>)</p>
    <li data-md>
     <p>Treat tombstones with extra fields as valid (<a href="#tombstone">§ 4.4 Tombstone</a>)</p>
   </ul>
   <h3 class="heading settled" data-level="18.2" id="profile-generator"><span class="secno">18.2. </span><span class="content">Generator requirements</span><a class="self-link" href="#profile-generator"></a></h3>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator④⑥">conforming generator</a> SHALL:</p>
   <ul>
    <li data-md>
     <p>Produce output conforming to <a href="#physical-format">§ 5 Physical format</a> (<a href="#conformance-generator">§ 3.2 Generator</a>)</p>
    <li data-md>
     <p>Use <a data-link-type="dfn" href="#dfn-deterministic-serialization" id="ref-for-dfn-deterministic-serialization⑥">deterministic serialization</a> (<a href="#conformance-generator">§ 3.2 Generator</a>)</p>
    <li data-md>
     <p>Reject records with <code>$</code>-prefixed fields (<a href="#conformance-generator">§ 3.2 Generator</a>)</p>
    <li data-md>
     <p>Not produce a BOM (<a href="#encoding">§ 5.1 Encoding</a>)</p>
    <li data-md>
     <p>Ensure files end with newline (<a href="#line-structure">§ 5.3 Line structure</a>)</p>
    <li data-md>
     <p>Not produce CR characters (<a href="#line-structure">§ 5.3 Line structure</a>)</p>
    <li data-md>
     <p>Not produce empty lines (<a href="#line-structure">§ 5.3 Line structure</a>)</p>
    <li data-md>
     <p>Not produce duplicate JSON keys (<a href="#line-structure">§ 5.3 Line structure</a>)</p>
    <li data-md>
     <p>Sort object keys lexicographically (<a href="#deterministic-serialization">§ 5.4 Deterministic serialization</a>)</p>
    <li data-md>
     <p>Use standard JSON string escaping (<a href="#string-values">§ 5.5 String values</a>)</p>
    <li data-md>
     <p>Encode files as UTF-8 (<a href="#i18n">§ 14 Internationalization considerations</a>)</p>
    <li data-md>
     <p>Use atomic file replacement or report error (<a href="#algo-compact">§ 9.11 Compacting a table</a>)</p>
    <li data-md>
     <p>Implement file locking for concurrent access (<a href="#file-locking">§ 10.1 File locking</a>)</p>
    <li data-md>
     <p>Reject records containing unpaired surrogate code points (<a href="#string-values">§ 5.5 String values</a>)</p>
   </ul>
   <p>A <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator④⑦">conforming generator</a> SHOULD:</p>
   <ul>
    <li data-md>
     <p>Not escape characters that do not require escaping (<a href="#string-values">§ 5.5 String values</a>)</p>
   </ul>
   <h3 class="heading settled" data-level="18.3" id="profile-both"><span class="secno">18.3. </span><span class="content">Both profiles</span><a class="self-link" href="#profile-both"></a></h3>
   <p>Both <a data-link-type="dfn" href="#conforming-parser" id="ref-for-conforming-parser⑤⑥">conforming parser</a> and <a data-link-type="dfn" href="#conforming-generator" id="ref-for-conforming-generator④⑧">conforming generator</a> SHALL:</p>
   <ul>
    <li data-md>
     <p>Treat key specifier mismatches as errors (<a href="#header">§ 4.6 Header</a>)</p>
    <li data-md>
     <p>Signal errors as defined in <a href="#exceptions">§ 6 Exceptions</a></p>
    <li data-md>
     <p>Support minimum key length of 1024 bytes (<a href="#size-complexity">§ 11 Size and complexity</a>)</p>
    <li data-md>
     <p>Support minimum record size of 1 MiB (<a href="#size-complexity">§ 11 Size and complexity</a>)</p>
    <li data-md>
     <p>Support minimum JSON nesting depth of 64 levels (<a href="#size-complexity">§ 11 Size and complexity</a>)</p>
    <li data-md>
     <p>Support minimum tuple key element count of 16 (<a href="#size-complexity">§ 11 Size and complexity</a>)</p>
    <li data-md>
     <p>Signal <a data-link-type="dfn" href="#limit-error" id="ref-for-limit-error⑧">limit errors</a> when limits are exceeded (<a href="#size-complexity">§ 11 Size and complexity</a>)</p>
   </ul>
   <p>Both profiles MAY:</p>
   <ul>
    <li data-md>
     <p>Normalize keys to NFC (if documented and applied consistently) (<a href="#key-equality">§ 4.1.1 Key equality</a>)</p>
   </ul>
   <h2 class="heading settled" data-level="19" id="acks"><span class="secno">19. </span><span class="content">Acknowledgments</span><a class="self-link" href="#acks"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>This specification was developed with input from contributors who reviewed drafts and provided feedback. The design was informed by related work including <a data-link-type="biblio" href="#biblio-beads" title="Beads: Distributed, git-backed graph issue tracker for AI agents">[BEADS]</a>, which uses JSONL for git-backed structured storage.</p>
   <p>The notation conventions used in the <a href="#api">§ 7 API</a> section were inspired by <a data-link-type="biblio" href="#biblio-rfc9622" title="A TAPS Interface to Transport Services">[RFC9622]</a>, which provides a model for describing abstract interfaces in a language-agnostic manner.</p>
   <h3 class="heading settled" data-level="19.1" id="ai-assistance"><span class="secno">19.1. </span><span class="content">AI assistance disclosure</span><a class="self-link" href="#ai-assistance"></a></h3>
   <p>The development of this specification involved the use of AI language models, specifically Claude (Anthropic). AI tools contributed to the following aspects of this work:</p>
   <ul>
    <li data-md>
     <p>Drafting and refining specification prose</p>
    <li data-md>
     <p>Reviewing document structure and consistency</p>
    <li data-md>
     <p>Generating test case scenarios</p>
    <li data-md>
     <p>Exploring edge cases and potential ambiguities in the design</p>
   </ul>
   <p>All normative requirements, technical design decisions, and final specification text were determined by human authors. AI-generated content was reviewed, edited, and validated against the specification’s design goals. The authors take full responsibility for the technical accuracy and correctness of this document.</p>
   <p>This disclosure is provided in the interest of transparency regarding modern specification development practices.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="heading no-num no-ref settled" id="conformance"><span class="content">
    Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p>
            Conformance requirements are expressed with a combination of descriptive assertions and RFC 2119 terminology.
            The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
            in the normative parts of this document
            are to be interpreted as described in RFC 2119.
            However, for readability,
            these words do not appear in all uppercase letters in this specification.

        </p>
   <p>
            All of the text of this specification is normative
            except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a>

        </p>
   <p>
            Examples in this specification are introduced with the words “for example”
            or are set apart from the normative text with <code>class="example"</code>, like this:

        </p>
   <div class="example" id="example-example"><a class="self-link" href="#example-example"></a>
            This is an example of an informative example.
        </div>
   <p>
            Informative notes begin with the word “Note”
            and are set apart from the normative text with <code>class="note"</code>, like this:

        </p>
   <p class="note" role="note">
            Note, this is an informative note.</p>
  </div>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don't scroll to compensate for the ToC if we're above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don't know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn't exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn't standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don't have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we're at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can't find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="heading no-num no-ref settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="heading no-num no-ref settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#abort-a-transaction">abort a transaction</a><span>, in § 8.6</span>
   <li><a href="#begin-a-transaction">begin a transaction</a><span>, in § 8.6</span>
   <li><a href="#dfn-buffer">buffer</a><span>, in § 4.9</span>
   <li><a href="#check-for-a-record">check for a record</a><span>, in § 9.2</span>
   <li><a href="#clear-all-records">clear all records</a><span>, in § 9.10</span>
   <li><a href="#commit-a-transaction">commit a transaction</a><span>, in § 8.6</span>
   <li><a href="#compact-a-table">compact a table</a><span>, in § 9.11</span>
   <li><a href="#compute-the-logical-state">compute the logical state</a><span>, in § 8.3</span>
   <li><a href="#conflict-error">conflict error</a><span>, in § 6.6</span>
   <li><a href="#conforming-generator">conforming generator</a><span>, in § 3.2</span>
   <li><a href="#conforming-parser">conforming parser</a><span>, in § 3.1</span>
   <li><a href="#count-records">count records</a><span>, in § 9.5</span>
   <li><a href="#delete">delete</a><span>, in § 4.5</span>
   <li><a href="#delete-a-record">delete a record</a><span>, in § 9.9</span>
   <li><a href="#determine-the-operation-type">determine the operation type</a><span>, in § 8.2</span>
   <li><a href="#dfn-deterministic-serialization">Deterministic serialization</a><span>, in § 5.4</span>
   <li><a href="#extract-a-key">extract a key</a><span>, in § 8.1</span>
   <li><a href="#find-one-record">find one record</a><span>, in § 9.7</span>
   <li><a href="#find-records">find records</a><span>, in § 9.6</span>
   <li><a href="#get-all-keys">get all keys</a><span>, in § 9.4</span>
   <li><a href="#get-all-records">get all records</a><span>, in § 9.3</span>
   <li><a href="#get-a-record">get a record</a><span>, in § 9.1</span>
   <li><a href="#dfn-header">header</a><span>, in § 4.6</span>
   <li><a href="#integer">integer</a><span>, in § 4.1</span>
   <li><a href="#io-error">IO error</a><span>, in § 6.3</span>
   <li><a href="#json-object">JSON object</a><span>, in § 2</span>
   <li><a href="#dfn-key">key</a><span>, in § 4.1</span>
   <li><a href="#key-element">key element</a><span>, in § 4.1</span>
   <li><a href="#key-element">key elements</a><span>, in § 4.1</span>
   <li><a href="#key-error">key error</a><span>, in § 6.2</span>
   <li><a href="#key-field">key field</a><span>, in § 4.2</span>
   <li><a href="#key-field">key fields</a><span>, in § 4.2</span>
   <li><a href="#key-length">key length</a><span>, in § 11</span>
   <li><a href="#dfn-key-specifier">key specifier</a><span>, in § 4.2</span>
   <li><a href="#key-specifier-match">key specifier match</a><span>, in § 4.2</span>
   <li><a href="#key-specifier-match">key specifiers match</a><span>, in § 4.2</span>
   <li><a href="#limit-error">limit error</a><span>, in § 6.5</span>
   <li><a href="#lock-error">lock error</a><span>, in § 6.4</span>
   <li><a href="#dfn-logical-state">logical state</a><span>, in § 4.7</span>
   <li><a href="#open-a-table">open a table</a><span>, in § 8.4</span>
   <li><a href="#dfn-operation">operation</a><span>, in § 4.5</span>
   <li><a href="#parse-error">parse error</a><span>, in § 6.1</span>
   <li><a href="#perform-a-read-operation-within-a-transaction">perform a read operation within a transaction</a><span>, in § 8.6</span>
   <li><a href="#perform-a-write-operation-within-a-transaction">perform a write operation within a transaction</a><span>, in § 8.6</span>
   <li><a href="#put-a-record">put a record</a><span>, in § 9.8</span>
   <li><a href="#read-a-table-file">read a table file</a><span>, in § 8.5</span>
   <li><a href="#dfn-record">record</a><span>, in § 4.3</span>
   <li><a href="#record-size">record size</a><span>, in § 11</span>
   <li><a href="#return-failure">return failure</a><span>, in § 8</span>
   <li><a href="#scalar-key">scalar key</a><span>, in § 4.1</span>
   <li><a href="#dfn-snapshot">snapshot</a><span>, in § 4.9</span>
   <li><a href="#dfn-table">table</a><span>, in § 4.8</span>
   <li><a href="#dfn-tombstone">tombstone</a><span>, in § 4.4</span>
   <li><a href="#dfn-transaction">transaction</a><span>, in § 4.9</span>
   <li><a href="#tuple">tuple</a><span>, in § 4.1</span>
   <li><a href="#upsert">upsert</a><span>, in § 4.5</span>
   <li><a href="#valid">valid</a><span>, in § 4.2</span>
   <li><a href="#valid-key">valid key</a><span>, in § 4.1</span>
   <li><a href="#valid-key-element">valid key element</a><span>, in § 4.1</span>
  </ul>
  <h3 class="heading no-num no-ref settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3de9e659">byte sequence</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="3fca5a9e">map</span>
     <li><span class="dfn-paneled" id="0698d556">string</span>
    </ul>
  </ul>
  <h2 class="heading no-num no-ref settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="heading no-num no-ref settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-jsonl">[JSONL]
   <dd>Ian Ward. <a href="https://jsonlines.org/"><cite>JSON Lines</cite></a>. Accessed December 2025. URL: <a href="https://jsonlines.org/">https://jsonlines.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. URL: <a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
   <dt id="biblio-rfc8174">[RFC8174]
   <dd>B. Leiba. <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. URL: <a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
   <dt id="biblio-rfc8259">[RFC8259]
   <dd>T. Bray. <a href="https://www.rfc-editor.org/rfc/rfc8259"><cite>The JavaScript Object Notation (JSON) Data Interchange Format</cite></a>. URL: <a href="https://www.rfc-editor.org/rfc/rfc8259">https://www.rfc-editor.org/rfc/rfc8259</a>
  </dl>
  <h3 class="heading no-num no-ref settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-beads">[BEADS]
   <dd>Steve Yegge. <a href="https://github.com/steveyegge/beads"><cite>Beads: Distributed, git-backed graph issue tracker for AI agents</cite></a>. URL: <a href="https://github.com/steveyegge/beads">https://github.com/steveyegge/beads</a>
   <dt id="biblio-json-schema">[JSON-SCHEMA]
   <dd>A. Wright; et al. <a href="https://json-schema.org/draft/2020-12/json-schema-core"><cite>JSON Schema: A Media Type for Describing JSON Documents</cite></a>. URL: <a href="https://json-schema.org/draft/2020-12/json-schema-core">https://json-schema.org/draft/2020-12/json-schema-core</a>
   <dt id="biblio-rfc6838">[RFC6838]
   <dd>N. Freed; J. Klensin; T. Hansen. <a href="https://www.rfc-editor.org/rfc/rfc6838"><cite>Media Type Specifications and Registration Procedures</cite></a>. URL: <a href="https://www.rfc-editor.org/rfc/rfc6838">https://www.rfc-editor.org/rfc/rfc6838</a>
   <dt id="biblio-rfc8785">[RFC8785]
   <dd>A. Rundgren; B. Jordan; S. Erdtman. <a href="https://www.rfc-editor.org/rfc/rfc8785"><cite>JSON Canonicalization Scheme (JCS)</cite></a>. URL: <a href="https://www.rfc-editor.org/rfc/rfc8785">https://www.rfc-editor.org/rfc/rfc8785</a>
   <dt id="biblio-rfc9622">[RFC9622]
   <dd>B. Trammell; et al. <a href="https://www.rfc-editor.org/rfc/rfc9622"><cite>A TAPS Interface to Transport Services</cite></a>. URL: <a href="https://www.rfc-editor.org/rfc/rfc9622">https://www.rfc-editor.org/rfc/rfc9622</a>
  </dl>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"0698d556": {"dfnID":"0698d556","dfnText":"string","external":true,"refSections":[{"refs":[{"id":"ref-for-string"}],"title":"2. Terminology"},{"refs":[{"id":"ref-for-string\u2460"},{"id":"ref-for-string\u2461"},{"id":"ref-for-string\u2462"},{"id":"ref-for-string\u2463"},{"id":"ref-for-string\u2464"},{"id":"ref-for-string\u2465"}],"title":"4.1. Key"},{"refs":[{"id":"ref-for-string\u2466"}],"title":"4.2. Key specifier"},{"refs":[{"id":"ref-for-string\u2467"},{"id":"ref-for-string\u2468"}],"title":"9.9. Deleting a record"},{"refs":[{"id":"ref-for-string\u2460\u24ea"}],"title":"11. Size and complexity"}],"url":"https://infra.spec.whatwg.org/#string"},
"3de9e659": {"dfnID":"3de9e659","dfnText":"byte sequence","external":true,"refSections":[{"refs":[{"id":"ref-for-byte-sequence"}],"title":"2. Terminology"},{"refs":[{"id":"ref-for-byte-sequence\u2460"}],"title":"8.5. Reading a table file"}],"url":"https://infra.spec.whatwg.org/#byte-sequence"},
"3fca5a9e": {"dfnID":"3fca5a9e","dfnText":"map","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-map"}],"title":"2. Terminology"},{"refs":[{"id":"ref-for-ordered-map\u2460"}],"title":"4.7. Logical state"},{"refs":[{"id":"ref-for-ordered-map\u2461"}],"title":"8.3. Computing the logical state"},{"refs":[{"id":"ref-for-ordered-map\u2462"}],"title":"9.10. Clearing all records"}],"url":"https://infra.spec.whatwg.org/#ordered-map"},
"649608b9": {"dfnID":"649608b9","dfnText":"list","external":true,"refSections":[{"refs":[{"id":"ref-for-list"}],"title":"2. Terminology"},{"refs":[{"id":"ref-for-list\u2460"}],"title":"4.9. Transaction"},{"refs":[{"id":"ref-for-list\u2461"}],"title":"8.5. Reading a table file"},{"refs":[{"id":"ref-for-list\u2462"}],"title":"9.10. Clearing all records"}],"url":"https://infra.spec.whatwg.org/#list"},
"abort-a-transaction": {"dfnID":"abort-a-transaction","dfnText":"abort a transaction","external":false,"refSections":[{"refs":[{"id":"ref-for-abort-a-transaction"}],"title":"7.5. Transaction operations"}],"url":"#abort-a-transaction"},
"begin-a-transaction": {"dfnID":"begin-a-transaction","dfnText":"begin a transaction","external":false,"refSections":[{"refs":[{"id":"ref-for-begin-a-transaction"}],"title":"7.5. Transaction operations"}],"url":"#begin-a-transaction"},
"check-for-a-record": {"dfnID":"check-for-a-record","dfnText":"check for a record","external":false,"refSections":[{"refs":[{"id":"ref-for-check-for-a-record"}],"title":"7.3. Read operations"},{"refs":[{"id":"ref-for-check-for-a-record\u2460"}],"title":"8.6. Transaction operations"}],"url":"#check-for-a-record"},
"clear-all-records": {"dfnID":"clear-all-records","dfnText":"clear all records","external":false,"refSections":[{"refs":[{"id":"ref-for-clear-all-records"}],"title":"7.4. Write operations"}],"url":"#clear-all-records"},
"commit-a-transaction": {"dfnID":"commit-a-transaction","dfnText":"commit a transaction","external":false,"refSections":[{"refs":[{"id":"ref-for-commit-a-transaction"}],"title":"7.5. Transaction operations"},{"refs":[{"id":"ref-for-commit-a-transaction\u2460"}],"title":"8.6. Transaction operations"}],"url":"#commit-a-transaction"},
"compact-a-table": {"dfnID":"compact-a-table","dfnText":"compact a table","external":false,"refSections":[{"refs":[{"id":"ref-for-compact-a-table"}],"title":"7.6. Maintenance operations"}],"url":"#compact-a-table"},
"compute-the-logical-state": {"dfnID":"compute-the-logical-state","dfnText":"compute the logical state","external":false,"refSections":[{"refs":[{"id":"ref-for-compute-the-logical-state"}],"title":"3.1. Parser"},{"refs":[{"id":"ref-for-compute-the-logical-state\u2460"}],"title":"4.5. Operation"},{"refs":[{"id":"ref-for-compute-the-logical-state\u2461"}],"title":"4.7. Logical state"},{"refs":[{"id":"ref-for-compute-the-logical-state\u2462"}],"title":"8.4. Opening a table"}],"url":"#compute-the-logical-state"},
"conflict-error": {"dfnID":"conflict-error","dfnText":"conflict error","external":false,"refSections":[{"refs":[{"id":"ref-for-conflict-error"},{"id":"ref-for-conflict-error\u2460"}],"title":"4.9. Transaction"},{"refs":[{"id":"ref-for-conflict-error\u2461"}],"title":"6.6. Transaction errors (TransactionError)"},{"refs":[{"id":"ref-for-conflict-error\u2462"}],"title":"8.6. Transaction operations"}],"url":"#conflict-error"},
"conforming-generator": {"dfnID":"conforming-generator","dfnText":"conforming generator","external":false,"refSections":[{"refs":[{"id":"ref-for-conforming-generator"},{"id":"ref-for-conforming-generator\u2460"},{"id":"ref-for-conforming-generator\u2461"}],"title":"3.2. Generator"},{"refs":[{"id":"ref-for-conforming-generator\u2462"}],"title":"3.3. Claiming conformance"},{"refs":[{"id":"ref-for-conforming-generator\u2463"},{"id":"ref-for-conforming-generator\u2464"},{"id":"ref-for-conforming-generator\u2465"}],"title":"4.1. Key"},{"refs":[{"id":"ref-for-conforming-generator\u2466"}],"title":"4.1.1. Key equality"},{"refs":[{"id":"ref-for-conforming-generator\u2467"},{"id":"ref-for-conforming-generator\u2468"}],"title":"4.2. Key specifier"},{"refs":[{"id":"ref-for-conforming-generator\u2460\u24ea"}],"title":"4.3. Record"},{"refs":[{"id":"ref-for-conforming-generator\u2460\u2460"},{"id":"ref-for-conforming-generator\u2460\u2461"}],"title":"4.4. Tombstone"},{"refs":[{"id":"ref-for-conforming-generator\u2460\u2462"}],"title":"4.6. Header"},{"refs":[{"id":"ref-for-conforming-generator\u2460\u2463"}],"title":"4.9. Transaction"},{"refs":[{"id":"ref-for-conforming-generator\u2460\u2464"}],"title":"5.1. Encoding"},{"refs":[{"id":"ref-for-conforming-generator\u2460\u2465"},{"id":"ref-for-conforming-generator\u2460\u2466"},{"id":"ref-for-conforming-generator\u2460\u2467"},{"id":"ref-for-conforming-generator\u2460\u2468"},{"id":"ref-for-conforming-generator\u2461\u24ea"}],"title":"5.3. Line structure"},{"refs":[{"id":"ref-for-conforming-generator\u2461\u2460"},{"id":"ref-for-conforming-generator\u2461\u2461"},{"id":"ref-for-conforming-generator\u2461\u2462"}],"title":"5.4. Deterministic serialization"},{"refs":[{"id":"ref-for-conforming-generator\u2461\u2463"},{"id":"ref-for-conforming-generator\u2461\u2464"},{"id":"ref-for-conforming-generator\u2461\u2465"}],"title":"5.5. String values"},{"refs":[{"id":"ref-for-conforming-generator\u2461\u2466"}],"title":"6. Exceptions"},{"refs":[{"id":"ref-for-conforming-generator\u2461\u2467"}],"title":"6.2. Key errors (KeyError)"},{"refs":[{"id":"ref-for-conforming-generator\u2461\u2468"}],"title":"6.3. File errors (IOError)"},{"refs":[{"id":"ref-for-conforming-generator\u2462\u24ea"}],"title":"6.4. Lock errors (LockError)"},{"refs":[{"id":"ref-for-conforming-generator\u2462\u2460"},{"id":"ref-for-conforming-generator\u2462\u2461"}],"title":"6.5. Limit errors (LimitError)"},{"refs":[{"id":"ref-for-conforming-generator\u2462\u2462"}],"title":"6.6. Transaction errors (TransactionError)"},{"refs":[{"id":"ref-for-conforming-generator\u2462\u2463"}],"title":"7. API"},{"refs":[{"id":"ref-for-conforming-generator\u2462\u2464"}],"title":"7.1. Table constructor"},{"refs":[{"id":"ref-for-conforming-generator\u2462\u2465"}],"title":"9.11. Compacting a table"},{"refs":[{"id":"ref-for-conforming-generator\u2462\u2466"}],"title":"10.1. File locking"},{"refs":[{"id":"ref-for-conforming-generator\u2462\u2467"}],"title":"10.2. Auto-reload behavior"},{"refs":[{"id":"ref-for-conforming-generator\u2462\u2468"},{"id":"ref-for-conforming-generator\u2463\u24ea"}],"title":"11. Size and complexity"},{"refs":[{"id":"ref-for-conforming-generator\u2463\u2460"},{"id":"ref-for-conforming-generator\u2463\u2461"}],"title":"12. Security considerations"},{"refs":[{"id":"ref-for-conforming-generator\u2463\u2462"}],"title":"13. Privacy considerations"},{"refs":[{"id":"ref-for-conforming-generator\u2463\u2463"}],"title":"14. Internationalization considerations"},{"refs":[{"id":"ref-for-conforming-generator\u2463\u2464"}],"title":"16. Extension mechanism"},{"refs":[{"id":"ref-for-conforming-generator\u2463\u2465"},{"id":"ref-for-conforming-generator\u2463\u2466"}],"title":"18.2. Generator requirements"},{"refs":[{"id":"ref-for-conforming-generator\u2463\u2467"}],"title":"18.3. Both profiles"}],"url":"#conforming-generator"},
"conforming-parser": {"dfnID":"conforming-parser","dfnText":"conforming parser","external":false,"refSections":[{"refs":[{"id":"ref-for-conforming-parser"},{"id":"ref-for-conforming-parser\u2460"},{"id":"ref-for-conforming-parser\u2461"},{"id":"ref-for-conforming-parser\u2462"},{"id":"ref-for-conforming-parser\u2463"}],"title":"3.1. Parser"},{"refs":[{"id":"ref-for-conforming-parser\u2464"}],"title":"3.2. Generator"},{"refs":[{"id":"ref-for-conforming-parser\u2465"}],"title":"3.3. Claiming conformance"},{"refs":[{"id":"ref-for-conforming-parser\u2466"},{"id":"ref-for-conforming-parser\u2467"},{"id":"ref-for-conforming-parser\u2468"},{"id":"ref-for-conforming-parser\u2460\u24ea"}],"title":"4.1. Key"},{"refs":[{"id":"ref-for-conforming-parser\u2460\u2460"}],"title":"4.1.1. Key equality"},{"refs":[{"id":"ref-for-conforming-parser\u2460\u2461"},{"id":"ref-for-conforming-parser\u2460\u2462"}],"title":"4.2. Key specifier"},{"refs":[{"id":"ref-for-conforming-parser\u2460\u2463"}],"title":"4.3. Record"},{"refs":[{"id":"ref-for-conforming-parser\u2460\u2464"},{"id":"ref-for-conforming-parser\u2460\u2465"},{"id":"ref-for-conforming-parser\u2460\u2466"}],"title":"4.4. Tombstone"},{"refs":[{"id":"ref-for-conforming-parser\u2460\u2467"},{"id":"ref-for-conforming-parser\u2460\u2468"},{"id":"ref-for-conforming-parser\u2461\u24ea"},{"id":"ref-for-conforming-parser\u2461\u2460"},{"id":"ref-for-conforming-parser\u2461\u2461"},{"id":"ref-for-conforming-parser\u2461\u2462"}],"title":"4.6. Header"},{"refs":[{"id":"ref-for-conforming-parser\u2461\u2463"}],"title":"4.9. Transaction"},{"refs":[{"id":"ref-for-conforming-parser\u2461\u2464"}],"title":"5.1. Encoding"},{"refs":[{"id":"ref-for-conforming-parser\u2461\u2465"},{"id":"ref-for-conforming-parser\u2461\u2466"},{"id":"ref-for-conforming-parser\u2461\u2467"},{"id":"ref-for-conforming-parser\u2461\u2468"},{"id":"ref-for-conforming-parser\u2462\u24ea"},{"id":"ref-for-conforming-parser\u2462\u2460"},{"id":"ref-for-conforming-parser\u2462\u2461"},{"id":"ref-for-conforming-parser\u2462\u2462"},{"id":"ref-for-conforming-parser\u2462\u2463"}],"title":"5.3. Line structure"},{"refs":[{"id":"ref-for-conforming-parser\u2462\u2464"}],"title":"5.5. String values"},{"refs":[{"id":"ref-for-conforming-parser\u2462\u2465"}],"title":"5.6. Operation encoding"},{"refs":[{"id":"ref-for-conforming-parser\u2462\u2466"}],"title":"6. Exceptions"},{"refs":[{"id":"ref-for-conforming-parser\u2462\u2467"}],"title":"6.1. Parse errors (ParseError)"},{"refs":[{"id":"ref-for-conforming-parser\u2462\u2468"}],"title":"6.2. Key errors (KeyError)"},{"refs":[{"id":"ref-for-conforming-parser\u2463\u24ea"}],"title":"6.3. File errors (IOError)"},{"refs":[{"id":"ref-for-conforming-parser\u2463\u2460"}],"title":"6.4. Lock errors (LockError)"},{"refs":[{"id":"ref-for-conforming-parser\u2463\u2461"},{"id":"ref-for-conforming-parser\u2463\u2462"}],"title":"6.5. Limit errors (LimitError)"},{"refs":[{"id":"ref-for-conforming-parser\u2463\u2463"}],"title":"6.6. Transaction errors (TransactionError)"},{"refs":[{"id":"ref-for-conforming-parser\u2463\u2464"}],"title":"7. API"},{"refs":[{"id":"ref-for-conforming-parser\u2463\u2465"}],"title":"7.1. Table constructor"},{"refs":[{"id":"ref-for-conforming-parser\u2463\u2466"}],"title":"10.2. Auto-reload behavior"},{"refs":[{"id":"ref-for-conforming-parser\u2463\u2467"},{"id":"ref-for-conforming-parser\u2463\u2468"}],"title":"11. Size and complexity"},{"refs":[{"id":"ref-for-conforming-parser\u2464\u24ea"}],"title":"12. Security considerations"},{"refs":[{"id":"ref-for-conforming-parser\u2464\u2460"}],"title":"13. Privacy considerations"},{"refs":[{"id":"ref-for-conforming-parser\u2464\u2461"},{"id":"ref-for-conforming-parser\u2464\u2462"}],"title":"16. Extension mechanism"},{"refs":[{"id":"ref-for-conforming-parser\u2464\u2463"},{"id":"ref-for-conforming-parser\u2464\u2464"}],"title":"18.1. Parser requirements"},{"refs":[{"id":"ref-for-conforming-parser\u2464\u2465"}],"title":"18.3. Both profiles"}],"url":"#conforming-parser"},
"count-records": {"dfnID":"count-records","dfnText":"count records","external":false,"refSections":[{"refs":[{"id":"ref-for-count-records"}],"title":"7.3. Read operations"},{"refs":[{"id":"ref-for-count-records\u2460"}],"title":"8.6. Transaction operations"}],"url":"#count-records"},
"delete": {"dfnID":"delete","dfnText":"delete","external":false,"refSections":[{"refs":[{"id":"ref-for-delete"},{"id":"ref-for-delete\u2460"}],"title":"4.5. Operation"},{"refs":[{"id":"ref-for-delete\u2461"},{"id":"ref-for-delete\u2462"}],"title":"5.6. Operation encoding"},{"refs":[{"id":"ref-for-delete\u2463"}],"title":"8.2. Determining the operation type"},{"refs":[{"id":"ref-for-delete\u2464"}],"title":"8.3. Computing the logical state"}],"url":"#delete"},
"delete-a-record": {"dfnID":"delete-a-record","dfnText":"delete a record","external":false,"refSections":[{"refs":[{"id":"ref-for-delete-a-record"}],"title":"7.4. Write operations"},{"refs":[{"id":"ref-for-delete-a-record\u2460"}],"title":"8.6. Transaction operations"}],"url":"#delete-a-record"},
"determine-the-operation-type": {"dfnID":"determine-the-operation-type","dfnText":"determine the operation type","external":false,"refSections":[{"refs":[{"id":"ref-for-determine-the-operation-type"}],"title":"4.5. Operation"},{"refs":[{"id":"ref-for-determine-the-operation-type\u2460"}],"title":"5.6. Operation encoding"},{"refs":[{"id":"ref-for-determine-the-operation-type\u2461"}],"title":"8.3. Computing the logical state"}],"url":"#determine-the-operation-type"},
"dfn-buffer": {"dfnID":"dfn-buffer","dfnText":"buffer","external":false,"refSections":[{"refs":[{"id":"ref-for-dfn-buffer"},{"id":"ref-for-dfn-buffer\u2460"},{"id":"ref-for-dfn-buffer\u2461"}],"title":"4.9. Transaction"},{"refs":[{"id":"ref-for-dfn-buffer\u2462"},{"id":"ref-for-dfn-buffer\u2463"}],"title":"8.6. Transaction operations"}],"url":"#dfn-buffer"},
"dfn-deterministic-serialization": {"dfnID":"dfn-deterministic-serialization","dfnText":"Deterministic serialization","external":false,"refSections":[{"refs":[{"id":"ref-for-dfn-deterministic-serialization"}],"title":"3.2. Generator"},{"refs":[{"id":"ref-for-dfn-deterministic-serialization\u2460"}],"title":"9.8. Putting a record"},{"refs":[{"id":"ref-for-dfn-deterministic-serialization\u2461"}],"title":"9.9. Deleting a record"},{"refs":[{"id":"ref-for-dfn-deterministic-serialization\u2462"},{"id":"ref-for-dfn-deterministic-serialization\u2463"}],"title":"9.11. Compacting a table"},{"refs":[{"id":"ref-for-dfn-deterministic-serialization\u2464"}],"title":"11. Size and complexity"},{"refs":[{"id":"ref-for-dfn-deterministic-serialization\u2465"}],"title":"18.2. Generator requirements"}],"url":"#dfn-deterministic-serialization"},
"dfn-header": {"dfnID":"dfn-header","dfnText":"header","external":false,"refSections":[{"refs":[{"id":"ref-for-dfn-header"},{"id":"ref-for-dfn-header\u2460"},{"id":"ref-for-dfn-header\u2461"}],"title":"4.6. Header"},{"refs":[{"id":"ref-for-dfn-header\u2462"}],"title":"5.6. Operation encoding"},{"refs":[{"id":"ref-for-dfn-header\u2463"},{"id":"ref-for-dfn-header\u2464"},{"id":"ref-for-dfn-header\u2465"},{"id":"ref-for-dfn-header\u2466"}],"title":"6.1. Parse errors (ParseError)"},{"refs":[{"id":"ref-for-dfn-header\u2467"}],"title":"7.1. Table constructor"},{"refs":[{"id":"ref-for-dfn-header\u2468"},{"id":"ref-for-dfn-header\u2460\u24ea"},{"id":"ref-for-dfn-header\u2460\u2460"},{"id":"ref-for-dfn-header\u2460\u2461"}],"title":"8.4. Opening a table"},{"refs":[{"id":"ref-for-dfn-header\u2460\u2462"},{"id":"ref-for-dfn-header\u2460\u2463"}],"title":"9.10. Clearing all records"},{"refs":[{"id":"ref-for-dfn-header\u2460\u2464"}],"title":"9.11. Compacting a table"},{"refs":[{"id":"ref-for-dfn-header\u2460\u2465"}],"title":"16. Extension mechanism"}],"url":"#dfn-header"},
"dfn-key": {"dfnID":"dfn-key","dfnText":"key","external":false,"refSections":[{"refs":[{"id":"ref-for-dfn-key"}],"title":"2.1. Notation"},{"refs":[{"id":"ref-for-dfn-key\u2460"},{"id":"ref-for-dfn-key\u2461"},{"id":"ref-for-dfn-key\u2462"}],"title":"4.1. Key"},{"refs":[{"id":"ref-for-dfn-key\u2463"},{"id":"ref-for-dfn-key\u2464"}],"title":"4.2. Key specifier"},{"refs":[{"id":"ref-for-dfn-key\u2465"}],"title":"4.3. Record"},{"refs":[{"id":"ref-for-dfn-key\u2466"},{"id":"ref-for-dfn-key\u2467"}],"title":"6.2. Key errors (KeyError)"},{"refs":[{"id":"ref-for-dfn-key\u2468"}],"title":"6.5. Limit errors (LimitError)"},{"refs":[{"id":"ref-for-dfn-key\u2460\u24ea"},{"id":"ref-for-dfn-key\u2460\u2460"}],"title":"7.3. Read operations"},{"refs":[{"id":"ref-for-dfn-key\u2460\u2461"},{"id":"ref-for-dfn-key\u2460\u2462"}],"title":"7.4. Write operations"},{"refs":[{"id":"ref-for-dfn-key\u2460\u2463"}],"title":"8.1. Extracting a key"},{"refs":[{"id":"ref-for-dfn-key\u2460\u2464"}],"title":"11. Size and complexity"}],"url":"#dfn-key"},
"dfn-key-specifier": {"dfnID":"dfn-key-specifier","dfnText":"key specifier","external":false,"refSections":[{"refs":[{"id":"ref-for-dfn-key-specifier"},{"id":"ref-for-dfn-key-specifier\u2460"},{"id":"ref-for-dfn-key-specifier\u2461"},{"id":"ref-for-dfn-key-specifier\u2462"},{"id":"ref-for-dfn-key-specifier\u2463"},{"id":"ref-for-dfn-key-specifier\u2464"},{"id":"ref-for-dfn-key-specifier\u2465"},{"id":"ref-for-dfn-key-specifier\u2466"}],"title":"4.2. Key specifier"},{"refs":[{"id":"ref-for-dfn-key-specifier\u2467"}],"title":"4.3. Record"},{"refs":[{"id":"ref-for-dfn-key-specifier\u2468"}],"title":"4.4. Tombstone"},{"refs":[{"id":"ref-for-dfn-key-specifier\u2460\u24ea"},{"id":"ref-for-dfn-key-specifier\u2460\u2460"}],"title":"4.6. Header"},{"refs":[{"id":"ref-for-dfn-key-specifier\u2460\u2461"}],"title":"4.8. Table"},{"refs":[{"id":"ref-for-dfn-key-specifier\u2460\u2462"}],"title":"5.3. Line structure"},{"refs":[{"id":"ref-for-dfn-key-specifier\u2460\u2463"}],"title":"5.6. Operation encoding"},{"refs":[{"id":"ref-for-dfn-key-specifier\u2460\u2464"},{"id":"ref-for-dfn-key-specifier\u2460\u2465"},{"id":"ref-for-dfn-key-specifier\u2460\u2466"}],"title":"6.2. Key errors (KeyError)"},{"refs":[{"id":"ref-for-dfn-key-specifier\u2460\u2467"}],"title":"7.1. Table constructor"},{"refs":[{"id":"ref-for-dfn-key-specifier\u2460\u2468"}],"title":"7.4. Write operations"},{"refs":[{"id":"ref-for-dfn-key-specifier\u2461\u24ea"},{"id":"ref-for-dfn-key-specifier\u2461\u2460"}],"title":"8.4. Opening a table"},{"refs":[{"id":"ref-for-dfn-key-specifier\u2461\u2461"}],"title":"9.8. Putting a record"},{"refs":[{"id":"ref-for-dfn-key-specifier\u2461\u2462"},{"id":"ref-for-dfn-key-specifier\u2461\u2463"},{"id":"ref-for-dfn-key-specifier\u2461\u2464"},{"id":"ref-for-dfn-key-specifier\u2461\u2465"},{"id":"ref-for-dfn-key-specifier\u2461\u2466"},{"id":"ref-for-dfn-key-specifier\u2461\u2467"},{"id":"ref-for-dfn-key-specifier\u2461\u2468"},{"id":"ref-for-dfn-key-specifier\u2462\u24ea"},{"id":"ref-for-dfn-key-specifier\u2462\u2460"}],"title":"9.9. Deleting a record"}],"url":"#dfn-key-specifier"},
"dfn-logical-state": {"dfnID":"dfn-logical-state","dfnText":"logical state","external":false,"refSections":[{"refs":[{"id":"ref-for-dfn-logical-state"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-dfn-logical-state\u2460"}],"title":"4.5. Operation"},{"refs":[{"id":"ref-for-dfn-logical-state\u2461"}],"title":"4.8. Table"},{"refs":[{"id":"ref-for-dfn-logical-state\u2462"},{"id":"ref-for-dfn-logical-state\u2463"},{"id":"ref-for-dfn-logical-state\u2464"}],"title":"4.9. Transaction"},{"refs":[{"id":"ref-for-dfn-logical-state\u2465"}],"title":"5.6. Operation encoding"},{"refs":[{"id":"ref-for-dfn-logical-state\u2466"}],"title":"8.4. Opening a table"},{"refs":[{"id":"ref-for-dfn-logical-state\u2467"},{"id":"ref-for-dfn-logical-state\u2468"},{"id":"ref-for-dfn-logical-state\u2460\u24ea"},{"id":"ref-for-dfn-logical-state\u2460\u2460"}],"title":"8.6. Transaction operations"},{"refs":[{"id":"ref-for-dfn-logical-state\u2460\u2461"}],"title":"9.1. Getting a record"},{"refs":[{"id":"ref-for-dfn-logical-state\u2460\u2462"}],"title":"9.2. Checking for a record"},{"refs":[{"id":"ref-for-dfn-logical-state\u2460\u2463"}],"title":"9.3. Getting all records"},{"refs":[{"id":"ref-for-dfn-logical-state\u2460\u2464"}],"title":"9.4. Getting all keys"},{"refs":[{"id":"ref-for-dfn-logical-state\u2460\u2465"}],"title":"9.5. Counting records"},{"refs":[{"id":"ref-for-dfn-logical-state\u2460\u2466"}],"title":"9.6. Finding records"},{"refs":[{"id":"ref-for-dfn-logical-state\u2460\u2467"}],"title":"9.7. Finding one record"},{"refs":[{"id":"ref-for-dfn-logical-state\u2460\u2468"}],"title":"9.8. Putting a record"},{"refs":[{"id":"ref-for-dfn-logical-state\u2461\u24ea"},{"id":"ref-for-dfn-logical-state\u2461\u2460"},{"id":"ref-for-dfn-logical-state\u2461\u2461"}],"title":"9.9. Deleting a record"},{"refs":[{"id":"ref-for-dfn-logical-state\u2461\u2462"}],"title":"9.10. Clearing all records"},{"refs":[{"id":"ref-for-dfn-logical-state\u2461\u2463"},{"id":"ref-for-dfn-logical-state\u2461\u2464"}],"title":"9.11. Compacting a table"},{"refs":[{"id":"ref-for-dfn-logical-state\u2461\u2465"},{"id":"ref-for-dfn-logical-state\u2461\u2466"}],"title":"11. Size and complexity"},{"refs":[{"id":"ref-for-dfn-logical-state\u2461\u2467"}],"title":"17.2. Compound types"}],"url":"#dfn-logical-state"},
"dfn-operation": {"dfnID":"dfn-operation","dfnText":"operation","external":false,"refSections":[{"refs":[{"id":"ref-for-dfn-operation"}],"title":"4.6. Header"},{"refs":[{"id":"ref-for-dfn-operation\u2460"}],"title":"4.9. Transaction"},{"refs":[{"id":"ref-for-dfn-operation\u2461"}],"title":"5.6. Operation encoding"},{"refs":[{"id":"ref-for-dfn-operation\u2462"}],"title":"8.5. Reading a table file"}],"url":"#dfn-operation"},
"dfn-record": {"dfnID":"dfn-record","dfnText":"record","external":false,"refSections":[{"refs":[{"id":"ref-for-dfn-record"}],"title":"2.1. Notation"},{"refs":[{"id":"ref-for-dfn-record\u2460"}],"title":"4.1. Key"},{"refs":[{"id":"ref-for-dfn-record\u2461"},{"id":"ref-for-dfn-record\u2462"}],"title":"4.2. Key specifier"},{"refs":[{"id":"ref-for-dfn-record\u2463"}],"title":"4.3. Record"},{"refs":[{"id":"ref-for-dfn-record\u2464"}],"title":"4.4. Tombstone"},{"refs":[{"id":"ref-for-dfn-record\u2465"}],"title":"4.5. Operation"},{"refs":[{"id":"ref-for-dfn-record\u2466"}],"title":"5.6. Operation encoding"},{"refs":[{"id":"ref-for-dfn-record\u2467"},{"id":"ref-for-dfn-record\u2468"}],"title":"6.2. Key errors (KeyError)"},{"refs":[{"id":"ref-for-dfn-record\u2460\u24ea"}],"title":"6.5. Limit errors (LimitError)"},{"refs":[{"id":"ref-for-dfn-record\u2460\u2460"},{"id":"ref-for-dfn-record\u2460\u2461"}],"title":"7.3. Read operations"},{"refs":[{"id":"ref-for-dfn-record\u2460\u2462"},{"id":"ref-for-dfn-record\u2460\u2463"}],"title":"7.4. Write operations"},{"refs":[{"id":"ref-for-dfn-record\u2460\u2464"}],"title":"8.5. Reading a table file"},{"refs":[{"id":"ref-for-dfn-record\u2460\u2465"}],"title":"11. Size and complexity"}],"url":"#dfn-record"},
"dfn-snapshot": {"dfnID":"dfn-snapshot","dfnText":"snapshot","external":false,"refSections":[{"refs":[{"id":"ref-for-dfn-snapshot"},{"id":"ref-for-dfn-snapshot\u2460"},{"id":"ref-for-dfn-snapshot\u2461"}],"title":"4.9. Transaction"},{"refs":[{"id":"ref-for-dfn-snapshot\u2462"},{"id":"ref-for-dfn-snapshot\u2463"}],"title":"8.6. Transaction operations"}],"url":"#dfn-snapshot"},
"dfn-table": {"dfnID":"dfn-table","dfnText":"table","external":false,"refSections":[{"refs":[{"id":"ref-for-dfn-table"}],"title":"4.1. Key"},{"refs":[{"id":"ref-for-dfn-table\u2460"}],"title":"4.5. Operation"},{"refs":[{"id":"ref-for-dfn-table\u2461"},{"id":"ref-for-dfn-table\u2462"}],"title":"4.8. Table"},{"refs":[{"id":"ref-for-dfn-table\u2463"},{"id":"ref-for-dfn-table\u2464"}],"title":"4.9. Transaction"},{"refs":[{"id":"ref-for-dfn-table\u2465"}],"title":"7.1. Table constructor"},{"refs":[{"id":"ref-for-dfn-table\u2466"},{"id":"ref-for-dfn-table\u2467"},{"id":"ref-for-dfn-table\u2468"}],"title":"7.3. Read operations"},{"refs":[{"id":"ref-for-dfn-table\u2460\u24ea"}],"title":"7.4. Write operations"},{"refs":[{"id":"ref-for-dfn-table\u2460\u2460"}],"title":"8.4. Opening a table"},{"refs":[{"id":"ref-for-dfn-table\u2460\u2461"},{"id":"ref-for-dfn-table\u2460\u2462"}],"title":"8.6. Transaction operations"},{"refs":[{"id":"ref-for-dfn-table\u2460\u2463"}],"title":"9.1. Getting a record"},{"refs":[{"id":"ref-for-dfn-table\u2460\u2464"}],"title":"9.2. Checking for a record"},{"refs":[{"id":"ref-for-dfn-table\u2460\u2465"}],"title":"9.3. Getting all records"},{"refs":[{"id":"ref-for-dfn-table\u2460\u2466"}],"title":"9.4. Getting all keys"},{"refs":[{"id":"ref-for-dfn-table\u2460\u2467"}],"title":"9.5. Counting records"},{"refs":[{"id":"ref-for-dfn-table\u2460\u2468"}],"title":"9.6. Finding records"},{"refs":[{"id":"ref-for-dfn-table\u2461\u24ea"}],"title":"9.7. Finding one record"},{"refs":[{"id":"ref-for-dfn-table\u2461\u2460"}],"title":"9.8. Putting a record"},{"refs":[{"id":"ref-for-dfn-table\u2461\u2461"}],"title":"9.9. Deleting a record"},{"refs":[{"id":"ref-for-dfn-table\u2461\u2462"}],"title":"9.10. Clearing all records"}],"url":"#dfn-table"},
"dfn-tombstone": {"dfnID":"dfn-tombstone","dfnText":"tombstone","external":false,"refSections":[{"refs":[{"id":"ref-for-dfn-tombstone"},{"id":"ref-for-dfn-tombstone\u2460"}],"title":"4.4. Tombstone"},{"refs":[{"id":"ref-for-dfn-tombstone\u2461"}],"title":"4.5. Operation"},{"refs":[{"id":"ref-for-dfn-tombstone\u2462"}],"title":"5.6. Operation encoding"},{"refs":[{"id":"ref-for-dfn-tombstone\u2463"}],"title":"8.5. Reading a table file"},{"refs":[{"id":"ref-for-dfn-tombstone\u2464"}],"title":"16. Extension mechanism"}],"url":"#dfn-tombstone"},
"dfn-transaction": {"dfnID":"dfn-transaction","dfnText":"transaction","external":false,"refSections":[{"refs":[{"id":"ref-for-dfn-transaction"}],"title":"3.3. Claiming conformance"},{"refs":[{"id":"ref-for-dfn-transaction\u2460"},{"id":"ref-for-dfn-transaction\u2461"},{"id":"ref-for-dfn-transaction\u2462"},{"id":"ref-for-dfn-transaction\u2463"},{"id":"ref-for-dfn-transaction\u2464"},{"id":"ref-for-dfn-transaction\u2465"}],"title":"4.9. Transaction"},{"refs":[{"id":"ref-for-dfn-transaction\u2466"},{"id":"ref-for-dfn-transaction\u2467"}],"title":"6.6. Transaction errors (TransactionError)"},{"refs":[{"id":"ref-for-dfn-transaction\u2468"}],"title":"8.6. Transaction operations"},{"refs":[{"id":"ref-for-dfn-transaction\u2460\u24ea"}],"title":"9.7. Finding one record"},{"refs":[{"id":"ref-for-dfn-transaction\u2460\u2460"}],"title":"10.2. Auto-reload behavior"}],"url":"#dfn-transaction"},
"extract-a-key": {"dfnID":"extract-a-key","dfnText":"extract a key","external":false,"refSections":[{"refs":[{"id":"ref-for-extract-a-key"}],"title":"4.2. Key specifier"},{"refs":[{"id":"ref-for-extract-a-key\u2460"}],"title":"8.3. Computing the logical state"},{"refs":[{"id":"ref-for-extract-a-key\u2461"}],"title":"8.6. Transaction operations"},{"refs":[{"id":"ref-for-extract-a-key\u2462"}],"title":"9.8. Putting a record"}],"url":"#extract-a-key"},
"find-one-record": {"dfnID":"find-one-record","dfnText":"find one record","external":false,"refSections":[{"refs":[{"id":"ref-for-find-one-record"}],"title":"7.3. Read operations"},{"refs":[{"id":"ref-for-find-one-record\u2460"}],"title":"8.6. Transaction operations"},{"refs":[{"id":"ref-for-find-one-record\u2461"}],"title":"9.7. Finding one record"}],"url":"#find-one-record"},
"find-records": {"dfnID":"find-records","dfnText":"find records","external":false,"refSections":[{"refs":[{"id":"ref-for-find-records"}],"title":"7.3. Read operations"},{"refs":[{"id":"ref-for-find-records\u2460"}],"title":"8.6. Transaction operations"},{"refs":[{"id":"ref-for-find-records\u2461"}],"title":"9.7. Finding one record"}],"url":"#find-records"},
"get-a-record": {"dfnID":"get-a-record","dfnText":"get a record","external":false,"refSections":[{"refs":[{"id":"ref-for-get-a-record"}],"title":"7.3. Read operations"},{"refs":[{"id":"ref-for-get-a-record\u2460"}],"title":"8.6. Transaction operations"}],"url":"#get-a-record"},
"get-all-keys": {"dfnID":"get-all-keys","dfnText":"get all keys","external":false,"refSections":[{"refs":[{"id":"ref-for-get-all-keys"}],"title":"7.3. Read operations"},{"refs":[{"id":"ref-for-get-all-keys\u2460"}],"title":"8.6. Transaction operations"}],"url":"#get-all-keys"},
"get-all-records": {"dfnID":"get-all-records","dfnText":"get all records","external":false,"refSections":[{"refs":[{"id":"ref-for-get-all-records"}],"title":"7.3. Read operations"},{"refs":[{"id":"ref-for-get-all-records\u2460"}],"title":"8.6. Transaction operations"}],"url":"#get-all-records"},
"integer": {"dfnID":"integer","dfnText":"integer","external":false,"refSections":[{"refs":[{"id":"ref-for-integer"},{"id":"ref-for-integer\u2460"},{"id":"ref-for-integer\u2461"},{"id":"ref-for-integer\u2462"},{"id":"ref-for-integer\u2463"}],"title":"4.1. Key"},{"refs":[{"id":"ref-for-integer\u2464"}],"title":"8.1. Extracting a key"},{"refs":[{"id":"ref-for-integer\u2465"}],"title":"11. Size and complexity"}],"url":"#integer"},
"io-error": {"dfnID":"io-error","dfnText":"IO error","external":false,"refSections":[{"refs":[{"id":"ref-for-io-error"}],"title":"6.3. File errors (IOError)"}],"url":"#io-error"},
"json-object": {"dfnID":"json-object","dfnText":"JSON object","external":false,"refSections":[{"refs":[{"id":"ref-for-json-object"}],"title":"4.3. Record"},{"refs":[{"id":"ref-for-json-object\u2460"}],"title":"4.4. Tombstone"},{"refs":[{"id":"ref-for-json-object\u2461"}],"title":"4.6. Header"},{"refs":[{"id":"ref-for-json-object\u2462"}],"title":"5.3. Line structure"}],"url":"#json-object"},
"key-element": {"dfnID":"key-element","dfnText":"key element","external":false,"refSections":[{"refs":[{"id":"ref-for-key-element"}],"title":"4.1. Key"},{"refs":[{"id":"ref-for-key-element\u2460"}],"title":"4.3. Record"},{"refs":[{"id":"ref-for-key-element\u2461"}],"title":"8.1. Extracting a key"}],"url":"#key-element"},
"key-error": {"dfnID":"key-error","dfnText":"key error","external":false,"refSections":[{"refs":[{"id":"ref-for-key-error"}],"title":"6.2. Key errors (KeyError)"}],"url":"#key-error"},
"key-field": {"dfnID":"key-field","dfnText":"key field","external":false,"refSections":[{"refs":[{"id":"ref-for-key-field"},{"id":"ref-for-key-field\u2460"}],"title":"4.4. Tombstone"},{"refs":[{"id":"ref-for-key-field\u2461"},{"id":"ref-for-key-field\u2462"},{"id":"ref-for-key-field\u2463"},{"id":"ref-for-key-field\u2464"},{"id":"ref-for-key-field\u2465"}],"title":"6.2. Key errors (KeyError)"}],"url":"#key-field"},
"key-length": {"dfnID":"key-length","dfnText":"key length","external":false,"refSections":[{"refs":[{"id":"ref-for-key-length"}],"title":"3.3. Claiming conformance"},{"refs":[{"id":"ref-for-key-length\u2460"}],"title":"6.5. Limit errors (LimitError)"},{"refs":[{"id":"ref-for-key-length\u2461"}],"title":"9.8. Putting a record"},{"refs":[{"id":"ref-for-key-length\u2462"},{"id":"ref-for-key-length\u2463"}],"title":"11. Size and complexity"}],"url":"#key-length"},
"key-specifier-match": {"dfnID":"key-specifier-match","dfnText":"match","external":false,"refSections":[{"refs":[{"id":"ref-for-key-specifier-match"},{"id":"ref-for-key-specifier-match\u2460"}],"title":"4.6. Header"},{"refs":[{"id":"ref-for-key-specifier-match\u2461"}],"title":"6.2. Key errors (KeyError)"},{"refs":[{"id":"ref-for-key-specifier-match\u2462"}],"title":"8.4. Opening a table"}],"url":"#key-specifier-match"},
"limit-error": {"dfnID":"limit-error","dfnText":"limit error","external":false,"refSections":[{"refs":[{"id":"ref-for-limit-error"}],"title":"4.1. Key"},{"refs":[{"id":"ref-for-limit-error\u2460"},{"id":"ref-for-limit-error\u2461"}],"title":"6.5. Limit errors (LimitError)"},{"refs":[{"id":"ref-for-limit-error\u2462"}],"title":"8.5. Reading a table file"},{"refs":[{"id":"ref-for-limit-error\u2463"},{"id":"ref-for-limit-error\u2464"}],"title":"9.8. Putting a record"},{"refs":[{"id":"ref-for-limit-error\u2465"},{"id":"ref-for-limit-error\u2466"}],"title":"11. Size and complexity"},{"refs":[{"id":"ref-for-limit-error\u2467"}],"title":"18.3. Both profiles"}],"url":"#limit-error"},
"lock-error": {"dfnID":"lock-error","dfnText":"lock error","external":false,"refSections":[{"refs":[{"id":"ref-for-lock-error"}],"title":"6.4. Lock errors (LockError)"}],"url":"#lock-error"},
"open-a-table": {"dfnID":"open-a-table","dfnText":"open a table","external":false,"refSections":[{"refs":[{"id":"ref-for-open-a-table"}],"title":"7.1. Table constructor"}],"url":"#open-a-table"},
"parse-error": {"dfnID":"parse-error","dfnText":"parse error","external":false,"refSections":[{"refs":[{"id":"ref-for-parse-error"}],"title":"4.4. Tombstone"},{"refs":[{"id":"ref-for-parse-error\u2460"},{"id":"ref-for-parse-error\u2461"}],"title":"4.6. Header"},{"refs":[{"id":"ref-for-parse-error\u2462"},{"id":"ref-for-parse-error\u2463"}],"title":"5.3. Line structure"},{"refs":[{"id":"ref-for-parse-error\u2464"}],"title":"6.1. Parse errors (ParseError)"},{"refs":[{"id":"ref-for-parse-error\u2465"}],"title":"8. Algorithms"},{"refs":[{"id":"ref-for-parse-error\u2466"}],"title":"8.2. Determining the operation type"},{"refs":[{"id":"ref-for-parse-error\u2467"},{"id":"ref-for-parse-error\u2468"}],"title":"8.3. Computing the logical state"},{"refs":[{"id":"ref-for-parse-error\u2460\u24ea"},{"id":"ref-for-parse-error\u2460\u2460"}],"title":"8.5. Reading a table file"},{"refs":[{"id":"ref-for-parse-error\u2460\u2461"},{"id":"ref-for-parse-error\u2460\u2462"},{"id":"ref-for-parse-error\u2460\u2463"},{"id":"ref-for-parse-error\u2460\u2464"}],"title":"18.1. Parser requirements"}],"url":"#parse-error"},
"perform-a-read-operation-within-a-transaction": {"dfnID":"perform-a-read-operation-within-a-transaction","dfnText":"perform a read operation within a transaction","external":false,"refSections":[{"refs":[{"id":"ref-for-perform-a-read-operation-within-a-transaction"}],"title":"7.5. Transaction operations"}],"url":"#perform-a-read-operation-within-a-transaction"},
"perform-a-write-operation-within-a-transaction": {"dfnID":"perform-a-write-operation-within-a-transaction","dfnText":"perform a write operation within a transaction","external":false,"refSections":[{"refs":[{"id":"ref-for-perform-a-write-operation-within-a-transaction"}],"title":"7.5. Transaction operations"}],"url":"#perform-a-write-operation-within-a-transaction"},
"put-a-record": {"dfnID":"put-a-record","dfnText":"put a record","external":false,"refSections":[{"refs":[{"id":"ref-for-put-a-record"}],"title":"7.4. Write operations"},{"refs":[{"id":"ref-for-put-a-record\u2460"}],"title":"8.6. Transaction operations"}],"url":"#put-a-record"},
"read-a-table-file": {"dfnID":"read-a-table-file","dfnText":"read a table file","external":false,"refSections":[{"refs":[{"id":"ref-for-read-a-table-file"}],"title":"3.1. Parser"},{"refs":[{"id":"ref-for-read-a-table-file\u2460"}],"title":"8.4. Opening a table"}],"url":"#read-a-table-file"},
"record-size": {"dfnID":"record-size","dfnText":"record size","external":false,"refSections":[{"refs":[{"id":"ref-for-record-size"}],"title":"3.3. Claiming conformance"},{"refs":[{"id":"ref-for-record-size\u2460"}],"title":"6.5. Limit errors (LimitError)"},{"refs":[{"id":"ref-for-record-size\u2461"}],"title":"9.8. Putting a record"},{"refs":[{"id":"ref-for-record-size\u2462"}],"title":"11. Size and complexity"}],"url":"#record-size"},
"return-failure": {"dfnID":"return-failure","dfnText":"return failure","external":false,"refSections":[{"refs":[{"id":"ref-for-return-failure"}],"title":"8.1. Extracting a key"}],"url":"#return-failure"},
"scalar-key": {"dfnID":"scalar-key","dfnText":"scalar key","external":false,"refSections":[{"refs":[{"id":"ref-for-scalar-key"},{"id":"ref-for-scalar-key\u2460"}],"title":"4.2. Key specifier"}],"url":"#scalar-key"},
"tuple": {"dfnID":"tuple","dfnText":"tuple","external":false,"refSections":[{"refs":[{"id":"ref-for-tuple"},{"id":"ref-for-tuple\u2460"},{"id":"ref-for-tuple\u2461"},{"id":"ref-for-tuple\u2462"},{"id":"ref-for-tuple\u2463"},{"id":"ref-for-tuple\u2464"},{"id":"ref-for-tuple\u2465"}],"title":"4.1. Key"},{"refs":[{"id":"ref-for-tuple\u2466"},{"id":"ref-for-tuple\u2467"},{"id":"ref-for-tuple\u2468"}],"title":"4.2. Key specifier"},{"refs":[{"id":"ref-for-tuple\u2460\u24ea"},{"id":"ref-for-tuple\u2460\u2460"}],"title":"6.2. Key errors (KeyError)"},{"refs":[{"id":"ref-for-tuple\u2460\u2461"}],"title":"6.5. Limit errors (LimitError)"},{"refs":[{"id":"ref-for-tuple\u2460\u2462"}],"title":"8.1. Extracting a key"},{"refs":[{"id":"ref-for-tuple\u2460\u2463"},{"id":"ref-for-tuple\u2460\u2464"},{"id":"ref-for-tuple\u2460\u2465"},{"id":"ref-for-tuple\u2460\u2466"},{"id":"ref-for-tuple\u2460\u2467"},{"id":"ref-for-tuple\u2460\u2468"}],"title":"9.9. Deleting a record"},{"refs":[{"id":"ref-for-tuple\u2461\u24ea"},{"id":"ref-for-tuple\u2461\u2460"}],"title":"11. Size and complexity"}],"url":"#tuple"},
"upsert": {"dfnID":"upsert","dfnText":"upsert","external":false,"refSections":[{"refs":[{"id":"ref-for-upsert"},{"id":"ref-for-upsert\u2460"}],"title":"4.5. Operation"},{"refs":[{"id":"ref-for-upsert\u2461"},{"id":"ref-for-upsert\u2462"},{"id":"ref-for-upsert\u2463"},{"id":"ref-for-upsert\u2464"}],"title":"5.6. Operation encoding"},{"refs":[{"id":"ref-for-upsert\u2465"}],"title":"8.2. Determining the operation type"},{"refs":[{"id":"ref-for-upsert\u2466"}],"title":"8.3. Computing the logical state"}],"url":"#upsert"},
"valid": {"dfnID":"valid","dfnText":"valid","external":false,"refSections":[{"refs":[{"id":"ref-for-valid"},{"id":"ref-for-valid\u2460"}],"title":"8.4. Opening a table"}],"url":"#valid"},
"valid-key": {"dfnID":"valid-key","dfnText":"valid key","external":false,"refSections":[],"url":"#valid-key"},
"valid-key-element": {"dfnID":"valid-key-element","dfnText":"valid key element","external":false,"refSections":[{"refs":[{"id":"ref-for-valid-key-element"}],"title":"4.1. Key"}],"url":"#valid-key-element"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#abort-a-transaction": {"displayText":"abort a transaction","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"abort a transaction","type":"dfn","url":"#abort-a-transaction"},
"#begin-a-transaction": {"displayText":"begin a transaction","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"begin a transaction","type":"dfn","url":"#begin-a-transaction"},
"#check-for-a-record": {"displayText":"check for a record","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"check for a record","type":"dfn","url":"#check-for-a-record"},
"#clear-all-records": {"displayText":"clear all records","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"clear all records","type":"dfn","url":"#clear-all-records"},
"#commit-a-transaction": {"displayText":"commit a transaction","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"commit a transaction","type":"dfn","url":"#commit-a-transaction"},
"#compact-a-table": {"displayText":"compact a table","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"compact a table","type":"dfn","url":"#compact-a-table"},
"#compute-the-logical-state": {"displayText":"compute the logical state","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"compute the logical state","type":"dfn","url":"#compute-the-logical-state"},
"#conflict-error": {"displayText":"conflict error","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"conflict error","type":"dfn","url":"#conflict-error"},
"#conforming-generator": {"displayText":"conforming generator","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"conforming generator","type":"dfn","url":"#conforming-generator"},
"#conforming-parser": {"displayText":"conforming parser","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"conforming parser","type":"dfn","url":"#conforming-parser"},
"#count-records": {"displayText":"count records","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"count records","type":"dfn","url":"#count-records"},
"#delete": {"displayText":"delete","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"delete","type":"dfn","url":"#delete"},
"#delete-a-record": {"displayText":"delete a record","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"delete a record","type":"dfn","url":"#delete-a-record"},
"#determine-the-operation-type": {"displayText":"determine the operation type","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"determine the operation type","type":"dfn","url":"#determine-the-operation-type"},
"#dfn-buffer": {"displayText":"buffer","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"buffer","type":"dfn","url":"#dfn-buffer"},
"#dfn-deterministic-serialization": {"displayText":"deterministic serialization","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"deterministic serialization","type":"dfn","url":"#dfn-deterministic-serialization"},
"#dfn-header": {"displayText":"header","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"header","type":"dfn","url":"#dfn-header"},
"#dfn-key": {"displayText":"key","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"key","type":"dfn","url":"#dfn-key"},
"#dfn-key-specifier": {"displayText":"key specifier","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"key specifier","type":"dfn","url":"#dfn-key-specifier"},
"#dfn-logical-state": {"displayText":"logical state","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"logical state","type":"dfn","url":"#dfn-logical-state"},
"#dfn-operation": {"displayText":"operation","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"operation","type":"dfn","url":"#dfn-operation"},
"#dfn-record": {"displayText":"record","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"record","type":"dfn","url":"#dfn-record"},
"#dfn-snapshot": {"displayText":"snapshot","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"snapshot","type":"dfn","url":"#dfn-snapshot"},
"#dfn-table": {"displayText":"table","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"table","type":"dfn","url":"#dfn-table"},
"#dfn-tombstone": {"displayText":"tombstone","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"tombstone","type":"dfn","url":"#dfn-tombstone"},
"#dfn-transaction": {"displayText":"transaction","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"transaction","type":"dfn","url":"#dfn-transaction"},
"#extract-a-key": {"displayText":"extract a key","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"extract a key","type":"dfn","url":"#extract-a-key"},
"#find-one-record": {"displayText":"find one record","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"find one record","type":"dfn","url":"#find-one-record"},
"#find-records": {"displayText":"find records","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"find records","type":"dfn","url":"#find-records"},
"#get-a-record": {"displayText":"get a record","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"get a record","type":"dfn","url":"#get-a-record"},
"#get-all-keys": {"displayText":"get all keys","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"get all keys","type":"dfn","url":"#get-all-keys"},
"#get-all-records": {"displayText":"get all records","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"get all records","type":"dfn","url":"#get-all-records"},
"#integer": {"displayText":"integer","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"integer","type":"dfn","url":"#integer"},
"#io-error": {"displayText":"io error","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"io error","type":"dfn","url":"#io-error"},
"#json-object": {"displayText":"json object","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"json object","type":"dfn","url":"#json-object"},
"#key-element": {"displayText":"key elements","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"key elements","type":"dfn","url":"#key-element"},
"#key-error": {"displayText":"key error","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"key error","type":"dfn","url":"#key-error"},
"#key-field": {"displayText":"key fields","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"key fields","type":"dfn","url":"#key-field"},
"#key-length": {"displayText":"key length","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"key length","type":"dfn","url":"#key-length"},
"#key-specifier-match": {"displayText":"key specifier match","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"key specifier match","type":"dfn","url":"#key-specifier-match"},
"#limit-error": {"displayText":"limit error","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"limit error","type":"dfn","url":"#limit-error"},
"#lock-error": {"displayText":"lock error","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"lock error","type":"dfn","url":"#lock-error"},
"#open-a-table": {"displayText":"open a table","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"open a table","type":"dfn","url":"#open-a-table"},
"#parse-error": {"displayText":"parse error","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"parse error","type":"dfn","url":"#parse-error"},
"#perform-a-read-operation-within-a-transaction": {"displayText":"perform a read operation within a transaction","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"perform a read operation within a transaction","type":"dfn","url":"#perform-a-read-operation-within-a-transaction"},
"#perform-a-write-operation-within-a-transaction": {"displayText":"perform a write operation within a transaction","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"perform a write operation within a transaction","type":"dfn","url":"#perform-a-write-operation-within-a-transaction"},
"#put-a-record": {"displayText":"put a record","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"put a record","type":"dfn","url":"#put-a-record"},
"#read-a-table-file": {"displayText":"read a table file","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"read a table file","type":"dfn","url":"#read-a-table-file"},
"#record-size": {"displayText":"record size","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"record size","type":"dfn","url":"#record-size"},
"#return-failure": {"displayText":"return failure","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"return failure","type":"dfn","url":"#return-failure"},
"#scalar-key": {"displayText":"scalar key","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"scalar key","type":"dfn","url":"#scalar-key"},
"#tuple": {"displayText":"tuple","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"tuple","type":"dfn","url":"#tuple"},
"#upsert": {"displayText":"upsert","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"upsert","type":"dfn","url":"#upsert"},
"#valid": {"displayText":"valid","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"valid","type":"dfn","url":"#valid"},
"#valid-key-element": {"displayText":"valid key element","export":true,"for_":[],"level":"","normative":true,"shortname":"jsonlt","spec":"jsonlt","status":"local","text":"valid key element","type":"dfn","url":"#valid-key-element"},
"https://infra.spec.whatwg.org/#byte-sequence": {"displayText":"byte sequence","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"byte sequence","type":"dfn","url":"https://infra.spec.whatwg.org/#byte-sequence"},
"https://infra.spec.whatwg.org/#list": {"displayText":"list","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"list","type":"dfn","url":"https://infra.spec.whatwg.org/#list"},
"https://infra.spec.whatwg.org/#ordered-map": {"displayText":"map","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"map","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-map"},
"https://infra.spec.whatwg.org/#string": {"displayText":"string","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"string","type":"dfn","url":"https://infra.spec.whatwg.org/#string"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
        // Give the original term if it's being displayed in a different way.
        // But allow casing differences, they're insignificant.
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.displayText)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const refHintKey = link.getAttribute("data-refhint-key");
    let key = url;
    if(refHintKey) {
        key = refHintKey + "_" + url;
    }
    const ref = refsData[key];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>